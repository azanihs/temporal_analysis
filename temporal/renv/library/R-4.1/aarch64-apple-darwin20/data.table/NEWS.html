
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>data.table v1.14.2 &#8212; Temporal and sequential analysis - LASI 2022</title>
    
  <link href="../../../../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../../../../" id="documentation_options" src="../../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../../_static/jquery.js"></script>
    <script src="../../../../../../_static/underscore.js"></script>
    <script src="../../../../../../_static/doctools.js"></script>
    <script src="../../../../../../_static/togglebutton.js"></script>
    <script src="../../../../../../_static/clipboard.min.js"></script>
    <script src="../../../../../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../../../../_static/solar_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Temporal and sequential analysis - LASI 2022</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../Lecture1.html">
   Lecture 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../Lecture2.html">
   Lecture 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../Lecture3.html">
   Lecture 3
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Labs
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../Lab1.html">
   Lab 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../Lab2.html">
   Lab 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../Lab3.html">
   Lab 3
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Quan Nguyen<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../../../../_sources/temporal/renv/library/R-4.1/aarch64-apple-darwin20/data.table/NEWS.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/quan3010/temporal_analysis"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/quan3010/temporal_analysis/issues/new?title=Issue%20on%20page%20%2Ftemporal/renv/library/R-4.1/aarch64-apple-darwin20/data.table/NEWS.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   data.table v1.14.2
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notes">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-14-0-21-feb-2021">
   data.table v1.14.0  (21 Feb 2021)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#potentially-breaking-changes">
     POTENTIALLY BREAKING CHANGES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bug-fixes">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-13-6-30-dec-2020">
   data.table v1.13.6  (30 Dec 2020)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-13-4-08-dec-2020">
   data.table v1.13.4  (08 Dec 2020)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-13-2-19-oct-2020">
   data.table v1.13.2  (19 Oct 2020)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-13-0-24-jul-2020">
   data.table v1.13.0  (24 Jul 2020)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     POTENTIALLY BREAKING CHANGES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#new-features">
     NEW FEATURES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-12-8-09-dec-2019">
   data.table v1.12.8  (09 Dec 2019)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     NEW FEATURES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id12">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-12-6-18-oct-2019">
   data.table v1.12.6  (18 Oct 2019)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id14">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id15">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-12-4-03-oct-2019">
   data.table v1.12.4  (03 Oct 2019)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     NEW FEATURES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id17">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id18">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-12-2-07-apr-2019">
   data.table v1.12.2  (07 Apr 2019)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id19">
     NEW FEATURES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id20">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id21">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-12-0-13-jan-2019">
   data.table v1.12.0  (13 Jan 2019)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id22">
     NEW FEATURES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id23">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id24">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-11-8-30-sep-2018">
   data.table v1.11.8  (30 Sep 2018)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id25">
     NEW FEATURES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id26">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id27">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-11-6-19-sep-2018">
   data.table v1.11.6  (19 Sep 2018)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id28">
     NEW FEATURES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id29">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id30">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-11-4-27-may-2018">
   data.table v1.11.4  (27 May 2018)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-11-2-08-may-2018">
   data.table v1.11.2  (08 May 2018)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-11-0-01-may-2018">
   data.table v1.11.0  (01 May 2018)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notice-of-intended-future-potential-breaking-changes">
     NOTICE OF INTENDED FUTURE POTENTIAL BREAKING CHANGES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id31">
     NEW FEATURES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id32">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id33">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-10-4-3-20-oct-2017">
   data.table v1.10.4-3  (20 Oct 2017)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-10-4-2-12-oct-2017">
   data.table v1.10.4-2  (12 Oct 2017)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-10-4-1-09-oct-2017">
   data.table v1.10.4-1  (09 Oct 2017)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-10-4-01-feb-2017">
   data.table v1.10.4  (01 Feb 2017)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id34">
     BUG FIXES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-10-2-31-jan-2017">
   data.table v1.10.2  (31 Jan 2017)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id35">
     NEW FEATURES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id36">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id37">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-10-0-03-dec-2016">
   data.table v1.10.0  (03 Dec 2016)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id38">
     BUG FIXES
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id39">
     NOTES
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-table-v1-9-8-nov-2016-back-to-v1-2-aug-2008-has-been-moved-to-news-0-md">
   data.table v1.9.8 (Nov 2016) back to v1.2 (Aug 2008) has been moved to NEWS.0.md
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><strong>If you are viewing this file on CRAN, please check <a class="reference external" href="https://github.com/Rdatatable/data.table/blob/master/NEWS.md">latest news on GitHub</a> where the formatting is also better.</strong></p>
<p><strong>Benchmarks are regularly updated: <a class="reference external" href="https://h2oai.github.io/db-benchmark/">here</a></strong></p>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-14-2">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/24?closed=1">v1.14.2</a><a class="headerlink" href="#data-table-v1-14-2" title="Permalink to this headline">¶</a></h1>
<div class="section" id="notes">
<h2>NOTES<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>clang 13.0.0 (Sep 2021) requires the system header <code class="docutils literal notranslate"><span class="pre">omp.h</span></code> to be included before R’s headers, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5122">#5122</a>. Many thanks to Prof Ripley for testing and providing a patch file.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-14-0-21-feb-2021">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/23?closed=1">v1.14.0</a>  (21 Feb 2021)<a class="headerlink" href="#data-table-v1-14-0-21-feb-2021" title="Permalink to this headline">¶</a></h1>
<div class="section" id="potentially-breaking-changes">
<h2>POTENTIALLY BREAKING CHANGES<a class="headerlink" href="#potentially-breaking-changes" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>In v1.13.0 (July 2020) native parsing of datetime was added to <code class="docutils literal notranslate"><span class="pre">fread</span></code> by Michael Chirico which dramatically improved performance. Before then datetime was read as type character by default which was slow. Since v1.13.0, UTC-marked datetime (e.g. <code class="docutils literal notranslate"><span class="pre">2020-07-24T10:11:12.134Z</span></code> where the final <code class="docutils literal notranslate"><span class="pre">Z</span></code> is present) has been read automatically as POSIXct and quickly. We provided the migration option <code class="docutils literal notranslate"><span class="pre">datatable.old.fread.datetime.character</span></code> to revert to the previous slow character behavior. We also added the <code class="docutils literal notranslate"><span class="pre">tz=</span></code> argument to control unmarked datetime; i.e. where the <code class="docutils literal notranslate"><span class="pre">Z</span></code> (or equivalent UTC postfix) is missing in the data. The default <code class="docutils literal notranslate"><span class="pre">tz=&quot;&quot;</span></code> reads unmarked datetime as character as before, slowly. We gave you the ability to set <code class="docutils literal notranslate"><span class="pre">tz=&quot;UTC&quot;</span></code> to turn on the new behavior and read unmarked datetime as UTC, quickly. R sessions that are running in UTC by setting the TZ environment variable, as is good practice and common in production, have also been reading unmarked datetime as UTC since v1.13.0, much faster. Note 1 of v1.13.0 (below in this file) ended <code class="docutils literal notranslate"><span class="pre">In</span> <span class="pre">addition</span> <span class="pre">to</span> <span class="pre">convenience,</span> <span class="pre">fread</span> <span class="pre">is</span> <span class="pre">now</span> <span class="pre">significantly</span> <span class="pre">faster</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">presence</span> <span class="pre">of</span> <span class="pre">dates,</span> <span class="pre">UTC-marked</span> <span class="pre">datetimes,</span> <span class="pre">and</span> <span class="pre">unmarked</span> <span class="pre">datetime</span> <span class="pre">when</span> <span class="pre">tz=&quot;UTC&quot;</span> <span class="pre">is</span> <span class="pre">provided.</span></code>.</p>
<p>At <code class="docutils literal notranslate"><span class="pre">rstudio::global(2021)</span></code>, Neal Richardson, Director of Engineering at Ursa Labs, compared Arrow CSV performance to <code class="docutils literal notranslate"><span class="pre">data.table</span></code> CSV performance, <a class="reference external" href="https://www.rstudio.com/resources/rstudioglobal-2021/bigger-data-with-ease-using-apache-arrow/">Bigger Data With Ease Using Apache Arrow</a>. He opened by comparing to <code class="docutils literal notranslate"><span class="pre">data.table</span></code> as his main point. Arrow was presented as 3 times faster than <code class="docutils literal notranslate"><span class="pre">data.table</span></code>. He talked at length about this result. However, no reproducible code was provided and we were not contacted in advance in case we had any comments. He mentioned New York Taxi data in his talk which is a dataset known to us as containing unmarked datetime. <a class="reference external" href="https://twitter.com/MattDowle/status/1360073970498875394">Rebuttal</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">tz=</span></code>’s default is now changed from <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;UTC&quot;</span></code>. If you have been using <code class="docutils literal notranslate"><span class="pre">tz=</span></code> explicitly then there should be no change. The change to read UTC-marked datetime as POSIXct rather than character already happened in v1.13.0. The change now is that unmarked datetimes are now read as UTC too by default without needing to set <code class="docutils literal notranslate"><span class="pre">tz=&quot;UTC&quot;</span></code>. None of the 1,017 CRAN packages directly using <code class="docutils literal notranslate"><span class="pre">data.table</span></code> are affected. As before, the migration option <code class="docutils literal notranslate"><span class="pre">datatable.old.fread.datetime.character</span></code> can still be set to TRUE to revert to the old character behavior. This migration option is temporary and will be removed in the near future.</p>
<p>The community was consulted in <a class="reference external" href="https://twitter.com/MattDowle/status/1358011599336931328">this tweet</a> before release.</p>
</li>
</ol>
</div>
<div class="section" id="bug-fixes">
<h2>BUG FIXES<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">fread()</span></code> discards a single line footer, the warning message which includes the discarded text now displays any non-ASCII characters correctly on Windows, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4747">#4747</a>. Thanks to &#64;shrektan for reporting and the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fintersect()</span></code> now retains the order of the first argument as reasonably expected, rather than retaining the order of the second argument, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4716">#4716</a>. Thanks to Michel Lang for reporting, and Ben Schwen for the PR.</p></li>
</ol>
</div>
<div class="section" id="id1">
<h2>NOTES<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Compiling from source no longer requires <code class="docutils literal notranslate"><span class="pre">zlib</span></code> header files to be available, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4844">#4844</a>. The output suggests installing <code class="docutils literal notranslate"><span class="pre">zlib</span></code> headers, and how (e.g. <code class="docutils literal notranslate"><span class="pre">zlib1g-dev</span></code> on Ubuntu) as before, but now proceeds with <code class="docutils literal notranslate"><span class="pre">gzip</span></code> compression disabled in <code class="docutils literal notranslate"><span class="pre">fwrite</span></code>. Upon calling <code class="docutils literal notranslate"><span class="pre">fwrite(DT,</span> <span class="pre">&quot;file.csv.gz&quot;)</span></code> at runtime, an error message suggests to reinstall <code class="docutils literal notranslate"><span class="pre">data.table</span></code> with <code class="docutils literal notranslate"><span class="pre">zlib</span></code> headers available. This does not apply to users on Windows or Mac who install the pre-compiled binary package from CRAN.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">r-datatable.com</span></code> continues to be the short, canonical and long-standing URL which forwards to the current homepage. The homepage domain has changed a few times over the years but those using <code class="docutils literal notranslate"><span class="pre">r-datatable.com</span></code> did not need to change their links. For example, we use <code class="docutils literal notranslate"><span class="pre">r-datatable.com</span></code> in messages (and translated messages) in preference to the word ‘homepage’ to save users time in searching for the current homepage. The web forwarding was provided by Domain Monster but they do not support <code class="docutils literal notranslate"><span class="pre">https://r-datatable.com</span></code>, only <code class="docutils literal notranslate"><span class="pre">http://r-datatable.com</span></code>, despite the homepage being forwarded to being <code class="docutils literal notranslate"><span class="pre">https:</span></code> for many years. Meanwhile, CRAN submission checks now require all URLs to be <code class="docutils literal notranslate"><span class="pre">https:</span></code>, rejecting <code class="docutils literal notranslate"><span class="pre">http:</span></code>. Therefore we have moved to <a class="reference external" href="https://www.gandi.net">gandi.net</a> who do support <code class="docutils literal notranslate"><span class="pre">https:</span></code> web forwarding and so <a class="reference external" href="https://r-datatable.com">https://r-datatable.com</a> now forwards correctly. Thanks to Dirk Eddelbuettel for suggesting Gandi. Further, Gandi allows the web-forward to be marked 301 (permanent) or 302 (temporary). Since the very point of <code class="docutils literal notranslate"><span class="pre">https://r-datatable.com</span></code> is to be a forward, 302 is appropriate in this case. This enables us to link to it in DESCRIPTION, README, and this NEWS item. Otherwise, CRAN submission checks would require the 301 forward to be followed; i.e. the forward replaced with where it points to and the package resubmitted. Thanks to Uwe Ligges for explaining this distinction.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-13-6-30-dec-2020">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/22?closed=1">v1.13.6</a>  (30 Dec 2020)<a class="headerlink" href="#data-table-v1-13-6-30-dec-2020" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>BUG FIXES<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>Grouping could throw an error <code class="docutils literal notranslate"><span class="pre">Failed</span> <span class="pre">to</span> <span class="pre">allocate</span> <span class="pre">counts</span> <span class="pre">or</span> <span class="pre">TMP</span></code> with more than 1e9 rows even with sufficient RAM due to an integer overflow, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4295">#4295</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4818">#4818</a>. Thanks to &#64;renkun-ken and &#64;jangorecki for reporting, and &#64;shrektan for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code>’s mutithreaded <code class="docutils literal notranslate"><span class="pre">gzip</span></code> compression failed on Solaris with Z_STREAM_ERROR, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4099">#4099</a>. Since this feature was released in Oct 2019 (see item 3 in v1.12.4 below in this news file) there have been no known problems with it on Linux, Windows or Mac. For Solaris, we have been successively adding more and more detailed tracing to the output in each release, culminating in tracing <code class="docutils literal notranslate"><span class="pre">zlib</span></code> internals at byte level by reading <code class="docutils literal notranslate"><span class="pre">zlib</span></code>’s source. The problem did not manifest itself on <a class="reference external" href="https://builder.r-hub.io/">R-hub</a>’s Solaris instances, so we had to work via CRAN output. If <code class="docutils literal notranslate"><span class="pre">zlib</span></code>’s <code class="docutils literal notranslate"><span class="pre">z_stream</span></code> structure is declared inside a parallel region but before a parallel for, it appears that the particular OpenMP implementation used by CRAN’s Solaris moves the structure to a new address on entering the parallel for. Ordinarily this memory move would not matter, however, <code class="docutils literal notranslate"><span class="pre">zlib</span></code> internals have a self reference pointer to the parent, and check that the pointers match. This mismatch caused the -2 (Z_STREAM_ERROR). Allocating an array of structures, one for each thread, before the parallel region avoids the memory move with no cost.</p>
<p>It should be carefully noted that we cannot be sure it really is a problem unique to CRAN’s Solaris. Even if it seems that way after one year of observations. For example, it could be compiler flags, or particular memory circumstances, either of which could occur on other operating systems too. However, we are unaware of why it would make sense for the OpenMP implementation to move the structure at that point. Any optimizations such as aligning the set of structures to cache line boundaries could be performed at the start of the parallel region, not after the parallel for. If anyone reading this knows more, please let us know.</p>
</li>
</ol>
</div>
<div class="section" id="id3">
<h2>NOTES<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>The last release took place at the same time as several breaking changes were made to R-devel. The CRAN submissions process runs against latest daily R-devel so we had to keep up with those latest changes by making several resubmissions. Then each resubmission reruns against the new latest R-devel again. Overall it took 7 days. For example, we added the new <code class="docutils literal notranslate"><span class="pre">environments=FALSE</span></code> to our <code class="docutils literal notranslate"><span class="pre">all.equal</span></code> call. Then about 4 hours after 1.13.4 was accepted, the <code class="docutils literal notranslate"><span class="pre">s</span></code> was dropped and we now need to resubmit with <code class="docutils literal notranslate"><span class="pre">environment=FALSE</span></code>. In any case, we have suggested that the default should be FALSE first to give packages some notice, as opposed to generating errors in the CRAN submissions process within hours. Then the default for <code class="docutils literal notranslate"><span class="pre">environment=</span></code> could be TRUE in 6 months time after packages have had some time to update in advance of the default change. Readers of this NEWS file will be familiar with <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s approach to change control and know that we do this ourselves.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-13-4-08-dec-2020">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/21?closed=1">v1.13.4</a>  (08 Dec 2020)<a class="headerlink" href="#data-table-v1-13-4-08-dec-2020" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id4">
<h2>BUG FIXES<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">as.matrix(&lt;empty</span> <span class="pre">DT&gt;)</span></code> now retains the column type for the empty matrix result, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4762">#4762</a>. Thus, for example, <code class="docutils literal notranslate"><span class="pre">min(DT[0])</span></code> where DT’s columns are numeric, is now consistent with non-empty all-NA input and returns <code class="docutils literal notranslate"><span class="pre">Inf</span></code> with R’s warning <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">non-missing</span> <span class="pre">arguments</span> <span class="pre">to</span> <span class="pre">min;</span> <span class="pre">returning</span> <span class="pre">Inf</span></code> rather than R’s error <code class="docutils literal notranslate"><span class="pre">only</span> <span class="pre">defined</span> <span class="pre">on</span> <span class="pre">a</span> <span class="pre">data</span> <span class="pre">frame</span> <span class="pre">with</span> <span class="pre">all</span> <span class="pre">numeric[-alike]</span> <span class="pre">variables</span></code>. Thanks to &#64;mb706 for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fsort()</span></code> could crash when compiled using <code class="docutils literal notranslate"><span class="pre">clang-11</span></code> (Oct 2020), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4786">#4786</a>. Multithreaded debugging revealed that threads are no longer assigned iterations monotonically by the dynamic schedule. Although never guaranteed by the OpenMP standard, in practice monotonicity could be relied on as far as we knew, until now. We rely on monotonicity in the <code class="docutils literal notranslate"><span class="pre">fsort</span></code> implementation. Happily, a schedule modifier <code class="docutils literal notranslate"><span class="pre">monotonic:dynamic</span></code> was added in OpenMP 4.5 (Nov 2015) which we now use if available (e.g. gcc 6+, clang 3.9+). If you have an old compiler which does not support OpenMP 4.5, it’s probably the case that the unmodified dynamic schedule is monotonic anyway, so <code class="docutils literal notranslate"><span class="pre">fsort</span></code> now checks that threads are receiving iterations monotonically and emits a graceful error if not. It may be that <code class="docutils literal notranslate"><span class="pre">clang</span></code> prior to version 11, and <code class="docutils literal notranslate"><span class="pre">gcc</span></code> too, exhibit the same crash. It was just that <code class="docutils literal notranslate"><span class="pre">clang-11</span></code> was the first report. To know which version of OpenMP <code class="docutils literal notranslate"><span class="pre">data.table</span></code> is using, <code class="docutils literal notranslate"><span class="pre">getDTthreads(verbose=TRUE)</span></code> now reports the <code class="docutils literal notranslate"><span class="pre">YYYYMM</span></code> value <code class="docutils literal notranslate"><span class="pre">_OPENMP</span></code>; e.g. 201511 corresponds to v4.5, and 201811 corresponds to v5.0. Oddly, the <code class="docutils literal notranslate"><span class="pre">x.y</span></code> version number is not provided by the OpenMP API. OpenMP 4.5 may be enabled in some compilers using <code class="docutils literal notranslate"><span class="pre">-fopenmp-version=45</span></code>. Otherwise, if you need to upgrade compiler, <a class="reference external" href="https://www.openmp.org/resources/openmp-compilers-tools/">https://www.openmp.org/resources/openmp-compilers-tools/</a> may be helpful.</p></li>
<li><p>Columns containing functions that don’t inherit the class <code class="docutils literal notranslate"><span class="pre">'function'</span></code> would fail to group, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4814">#4814</a>. Thanks &#64;mb706 for reporting, &#64;ecoRoland2 for helping investigate, and &#64;Coorsaa for a follow-up example involving environments.</p></li>
</ol>
</div>
<div class="section" id="id5">
<h2>NOTES<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Continuous daily testing by CRAN using latest daily R-devel revealed, within one day of the change to R-devel, that a future version of R would break one of our tests, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4769">#4769</a>. The characters “-alike” were added into one of R’s error messages, so our too-strict test which expected the error <code class="docutils literal notranslate"><span class="pre">only</span> <span class="pre">defined</span> <span class="pre">on</span> <span class="pre">a</span> <span class="pre">data</span> <span class="pre">frame</span> <span class="pre">with</span> <span class="pre">all</span> <span class="pre">numeric</span> <span class="pre">variables</span></code> will fail when it sees the new error message <code class="docutils literal notranslate"><span class="pre">only</span> <span class="pre">defined</span> <span class="pre">on</span> <span class="pre">a</span> <span class="pre">data</span> <span class="pre">frame</span> <span class="pre">with</span> <span class="pre">all</span> <span class="pre">numeric-alike</span> <span class="pre">variables</span></code>. We have relaxed the pattern the test looks for to <code class="docutils literal notranslate"><span class="pre">data.*frame.*numeric</span></code> well in advance of the future version of R being released. Readers are reminded that CRAN is not just a host for packages. It is also a giant test suite for R-devel. For more information, <a class="reference external" href="https://www.h2o.ai/blog/behind-the-scenes-of-cran/">behind the scenes of cran, 2016</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.Date.IDate</span></code> is no longer exported as a function to solve a new error in R-devel <code class="docutils literal notranslate"><span class="pre">S3</span> <span class="pre">method</span> <span class="pre">lookup</span> <span class="pre">found</span> <span class="pre">'as.Date.IDate'</span> <span class="pre">on</span> <span class="pre">search</span> <span class="pre">path</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4777">#4777</a>. The S3 method is still exported; i.e. <code class="docutils literal notranslate"><span class="pre">as.Date(x)</span></code> will still invoke the <code class="docutils literal notranslate"><span class="pre">as.Date.IDate</span></code> method when <code class="docutils literal notranslate"><span class="pre">x</span></code> is class <code class="docutils literal notranslate"><span class="pre">IDate</span></code>. The function had been exported, in addition to exporting the method, to solve a compatibility issue with <code class="docutils literal notranslate"><span class="pre">zoo</span></code> (and <code class="docutils literal notranslate"><span class="pre">xts</span></code> which uses <code class="docutils literal notranslate"><span class="pre">zoo</span></code>) because <code class="docutils literal notranslate"><span class="pre">zoo</span></code> exports <code class="docutils literal notranslate"><span class="pre">as.Date</span></code> which masks <code class="docutils literal notranslate"><span class="pre">base::as.Date</span></code>. Happily, since zoo 1.8-1 (Jan 2018) made a change to its <code class="docutils literal notranslate"><span class="pre">as.IDate</span></code>, the workaround is no longer needed.</p></li>
<li><p>Thanks to &#64;fredguinog for testing <code class="docutils literal notranslate"><span class="pre">fcase</span></code> in development before 1.13.0 was released and finding a segfault, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4378">#4378</a>. It was found separately by the <code class="docutils literal notranslate"><span class="pre">rchk</span></code> tool (which uses static code analysis) in release procedures and fixed before <code class="docutils literal notranslate"><span class="pre">fcase</span></code> was released, but the reproducible example has now been added to the test suite for completeness. Thanks also to &#64;shrektan for investigating, proposing a very similar fix at C level, and a different reproducible example which has also been added to the test suite.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-13-2-19-oct-2020">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/19?closed=1">v1.13.2</a>  (19 Oct 2020)<a class="headerlink" href="#data-table-v1-13-2-19-oct-2020" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id6">
<h2>BUG FIXES<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">test.data.table()</span></code> could fail the 2nd time it is run by a user in the same R session on Windows due to not resetting locale properly after testing Chinese translation, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4630">#4630</a>. Thanks to Cole Miller for investigating and fixing.</p></li>
<li><p>A regression in v1.13.0 resulted in installation on Mac often failing with <code class="docutils literal notranslate"><span class="pre">shared</span> <span class="pre">object</span> <span class="pre">'datatable.so'</span> <span class="pre">not</span> <span class="pre">found</span></code>, and FreeBSD always failing with <code class="docutils literal notranslate"><span class="pre">expr:</span> <span class="pre">illegal</span> <span class="pre">option</span> <span class="pre">--</span> <span class="pre">l</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4652">#4652</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4640">#4640</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4650">#4650</a>. Thanks to many for assistance including Simon Urbanek, Brian Ripley, Wes Morgan, and &#64;ale07alvarez. There were no installation problems on Windows or Linux.</p></li>
<li><p>Operating on columns of type <code class="docutils literal notranslate"><span class="pre">list</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">dt[,</span> <span class="pre">listCol[[1]],</span> <span class="pre">by=id]</span></code>, suffered a performance regression in v1.13.0, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4646">#4646</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4658">#4658</a>. Thanks to &#64;fabiocs8 and &#64;sandoronodi for the detailed reports, and to Cole Miller for substantial debugging, investigation and proposals at C level which enabled the root cause to be fixed. Related, and also fixed, was a segfault revealed by package POUMM, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4746">#4746</a>, when grouping a list column where each item has an attribute; e.g., <code class="docutils literal notranslate"><span class="pre">coda::mcmc.list</span></code>. Detected thanks to CRAN’s ASAN checks, and thanks to Venelin Mitov for assistance in tracing the memory fault. Thanks also to Hongyuan Jia and &#64;ben-schwen for assistance in debugging the fix in dev to pass reverse dependency testing which highlighted, before release, that package <code class="docutils literal notranslate"><span class="pre">eplusr</span></code> would fail. Its good usage has been added to <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s test suite.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(&quot;1.2\n&quot;,</span> <span class="pre">colClasses='integer')</span></code> (note no columns names in the data) would segfault when creating a warning message, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4644">#4644</a>. It now warns with <code class="docutils literal notranslate"><span class="pre">Attempt</span> <span class="pre">to</span> <span class="pre">override</span> <span class="pre">column</span> <span class="pre">1</span> <span class="pre">of</span> <span class="pre">inherent</span> <span class="pre">type</span> <span class="pre">'float64'</span> <span class="pre">down</span> <span class="pre">to</span> <span class="pre">'int32'</span> <span class="pre">ignored.</span></code> When column names are present however, the warning message includes the name as before; i.e., <code class="docutils literal notranslate"><span class="pre">fread(&quot;A\n1.2\n&quot;,</span> <span class="pre">colClasses='integer')</span></code> produces <code class="docutils literal notranslate"><span class="pre">Attempt</span> <span class="pre">to</span> <span class="pre">override</span> <span class="pre">column</span> <span class="pre">1</span> <span class="pre">&lt;&lt;A&gt;&gt;</span> <span class="pre">of</span> <span class="pre">inherent</span> <span class="pre">type</span> <span class="pre">'float64'</span> <span class="pre">down</span> <span class="pre">to</span> <span class="pre">'int32'</span> <span class="pre">ignored.</span></code>. Thanks to Kun Ren for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dplyr::mutate(setDT(as.list(1:64)),</span> <span class="pre">V1=11)</span></code> threw error <code class="docutils literal notranslate"><span class="pre">can't</span> <span class="pre">set</span> <span class="pre">ALTREP</span> <span class="pre">truelength</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4734">#4734</a>. Thanks to &#64;etryn for the reproducible example, and to Cole Miller for refinements.</p></li>
</ol>
</div>
<div class="section" id="id7">
<h2>NOTES<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">bit64</span></code> v4.0.2 and <code class="docutils literal notranslate"><span class="pre">bit</span></code> v4.0.3, both released on 30th July, correctly broke <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s tests. Like other packages on our <code class="docutils literal notranslate"><span class="pre">Suggest</span></code> list, we check <code class="docutils literal notranslate"><span class="pre">data.table</span></code> works with <code class="docutils literal notranslate"><span class="pre">bit64</span></code> in our tests. The first break was because <code class="docutils literal notranslate"><span class="pre">all.equal</span></code> always returned <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> in previous versions of <code class="docutils literal notranslate"><span class="pre">bit64</span></code>. Now that <code class="docutils literal notranslate"><span class="pre">all.equal</span></code> works for <code class="docutils literal notranslate"><span class="pre">integer64</span></code>, the incorrect test comparison was revealed. If you use <code class="docutils literal notranslate"><span class="pre">bit64</span></code>, or <code class="docutils literal notranslate"><span class="pre">nanotime</span></code> which uses <code class="docutils literal notranslate"><span class="pre">bit64</span></code>, it is highly recommended to upgrade to the latest <code class="docutils literal notranslate"><span class="pre">bit64</span></code> version. Thanks to Cole Miller for the PR to accommodate <code class="docutils literal notranslate"><span class="pre">bit64</span></code>’s update.</p>
<p>The second break caused by <code class="docutils literal notranslate"><span class="pre">bit</span></code> was the addition of a <code class="docutils literal notranslate"><span class="pre">copy</span></code> function. We did not ask, but the <code class="docutils literal notranslate"><span class="pre">bit</span></code> package kindly offered to change to a different name since <code class="docutils literal notranslate"><span class="pre">data.table::copy</span></code> is long standing. <code class="docutils literal notranslate"><span class="pre">bit</span></code> v4.0.4 released 4th August renamed <code class="docutils literal notranslate"><span class="pre">copy</span></code> to <code class="docutils literal notranslate"><span class="pre">copy_vector</span></code>. Otherwise, users of <code class="docutils literal notranslate"><span class="pre">data.table</span></code> would have needed to prefix every occurrence of <code class="docutils literal notranslate"><span class="pre">copy</span></code> with <code class="docutils literal notranslate"><span class="pre">data.table::copy</span></code> if they use <code class="docutils literal notranslate"><span class="pre">bit64</span></code> too, since <code class="docutils literal notranslate"><span class="pre">bit64</span></code> depends on (rather than importing) <code class="docutils literal notranslate"><span class="pre">bit</span></code>. Again, this impacted <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s tests which mimic a user’s environment; not <code class="docutils literal notranslate"><span class="pre">data.table</span></code> itself per se.</p>
<p>We have requested that CRAN policy be modified to require that reverse dependency testing include packages which <code class="docutils literal notranslate"><span class="pre">Suggest</span></code> the package. Had this been the case, reverse dependency testing of <code class="docutils literal notranslate"><span class="pre">bit64</span></code> would have caught the impact on <code class="docutils literal notranslate"><span class="pre">data.table</span></code> before release.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">?.NGRP</span></code> now displays the help page as intended, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4649">#4946</a>. Thanks to &#64;KyleHaynes for posting the issue, and Cole Miller for the fix. <code class="docutils literal notranslate"><span class="pre">.NGRP</span></code> is a symbol new in v1.13.0; see below in this file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test.data.table()</span></code> failed in non-English locales such as <code class="docutils literal notranslate"><span class="pre">LC_TIME=fr_FR.UTF-8</span></code> due to <code class="docutils literal notranslate"><span class="pre">Jan</span></code> vs <code class="docutils literal notranslate"><span class="pre">janv.</span></code> in tests 168 and 2042, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3450">#3450</a>. Thanks to &#64;shrektan for reporting, and &#64;tdhock for making the tests locale-aware.</p></li>
<li><p>User-supplied <code class="docutils literal notranslate"><span class="pre">PKG_LIBS</span></code> and <code class="docutils literal notranslate"><span class="pre">PKG_CFLAGS</span></code> are now retained and the suggestion in <a class="reference external" href="https://mac.r-project.org/openmp/">https://mac.r-project.org/openmp/</a> i.e.,
<code class="docutils literal notranslate"><span class="pre">PKG_CPPFLAGS='-Xclang</span> <span class="pre">-fopenmp'</span> <span class="pre">PKG_LIBS=-lomp</span> <span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">INSTALL</span> <span class="pre">data.table_&lt;ver&gt;.tar.gz</span></code>
has a better chance of working on Mac.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-13-0-24-jul-2020">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/17?closed=1">v1.13.0</a>  (24 Jul 2020)<a class="headerlink" href="#data-table-v1-13-0-24-jul-2020" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id8">
<h2>POTENTIALLY BREAKING CHANGES<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">fread</span></code> now supports native parsing of <code class="docutils literal notranslate"><span class="pre">%Y-%m-%d</span></code>, and <a class="reference external" href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> <code class="docutils literal notranslate"><span class="pre">%Y-%m-%dT%H:%M:%OS%z</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4464">#4464</a>. Dates are returned as <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s <code class="docutils literal notranslate"><span class="pre">integer</span></code>-backed <code class="docutils literal notranslate"><span class="pre">IDate</span></code> class (see <code class="docutils literal notranslate"><span class="pre">?IDate</span></code>), and datetimes are returned as <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> provided either <code class="docutils literal notranslate"><span class="pre">Z</span></code> or the offset from <code class="docutils literal notranslate"><span class="pre">UTC</span></code> is present; e.g. <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> outputs UTC by default including the final <code class="docutils literal notranslate"><span class="pre">Z</span></code>. Reminder that <code class="docutils literal notranslate"><span class="pre">IDate</span></code> inherits from R’s <code class="docutils literal notranslate"><span class="pre">Date</span></code> and is identical other than it uses the <code class="docutils literal notranslate"><span class="pre">integer</span></code> type where (oddly) R uses the <code class="docutils literal notranslate"><span class="pre">double</span></code> type for dates (8 bytes instead of 4). <code class="docutils literal notranslate"><span class="pre">fread()</span></code> gains a <code class="docutils literal notranslate"><span class="pre">tz</span></code> argument to control datetime values that are missing a Z or UTC-offset (now referred to as <em>unmarked</em> datetimes); e.g. as written by <code class="docutils literal notranslate"><span class="pre">write.csv</span></code>. By default <code class="docutils literal notranslate"><span class="pre">tz=&quot;&quot;</span></code> means, as in R, read the unmarked datetime in local time. Unless the timezone of the R session is UTC (e.g. the TZ environment variable is set to <code class="docutils literal notranslate"><span class="pre">&quot;UTC&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> on non-Windows), unmarked datetime will then by read by <code class="docutils literal notranslate"><span class="pre">fread</span></code> as character, as before. If you have been using <code class="docutils literal notranslate"><span class="pre">colClasses=&quot;POSIXct&quot;</span></code> that will still work using R’s <code class="docutils literal notranslate"><span class="pre">as.POSIXct()</span></code> which will interpret the unmarked datetime in local time, as before, and still slowly. You can tell <code class="docutils literal notranslate"><span class="pre">fread</span></code> to read unmarked datetime as UTC, and quickly, by passing <code class="docutils literal notranslate"><span class="pre">tz=&quot;UTC&quot;</span></code> which may be appropriate in many circumstances. Note that the default behaviour of R to read and write csv using unmarked datetime can lead to different research results when the csv file has been saved in one timezone and read in another due to observations being shifted to a different date. If you have been using <code class="docutils literal notranslate"><span class="pre">colClasses=&quot;POSIXct&quot;</span></code> for UTC-marked datetime (e.g. as written by <code class="docutils literal notranslate"><span class="pre">fwrite</span></code> including the final <code class="docutils literal notranslate"><span class="pre">Z</span></code>) then it will automatically speed up with no changes needed.</p>
<p>Since this is a potentially breaking change, i.e. existing code may depend on dates and datetimes being read as type character as before, a temporary option is provided to restore the old behaviour: <code class="docutils literal notranslate"><span class="pre">options(datatable.old.fread.datetime.character=TRUE)</span></code>. However, in most cases, we expect existing code to still work with no changes.</p>
<p>The minor version number is bumped from 12 to 13, i.e. <code class="docutils literal notranslate"><span class="pre">v1.13.0</span></code>, where the <code class="docutils literal notranslate"><span class="pre">.0</span></code> conveys ‘be-aware’ as is common practice. As with any new feature, there may be bugs to fix and changes to defaults required in future. In addition to convenience, <code class="docutils literal notranslate"><span class="pre">fread</span></code> is now significantly faster in the presence of dates, UTC-marked datetimes, and unmarked datetime when tz=”UTC” is provided.</p>
</li>
</ol>
</div>
<div class="section" id="new-features">
<h2>NEW FEATURES<a class="headerlink" href="#new-features" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">%chin%</span></code> and <code class="docutils literal notranslate"><span class="pre">chmatch(x,</span> <span class="pre">table)</span></code> are faster when <code class="docutils literal notranslate"><span class="pre">x</span></code> is length 1, <code class="docutils literal notranslate"><span class="pre">table</span></code> is long, and <code class="docutils literal notranslate"><span class="pre">x</span></code> occurs near the start of <code class="docutils literal notranslate"><span class="pre">table</span></code>. Thanks to Michael Chirico for the suggestion, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4117#discussion_r358378409">#4117</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CsubsetDT</span></code> C function is now exported for use by other packages, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3751">#3751</a>. Thanks to Leonardo Silvestri for the request and the PR. This uses R’s <code class="docutils literal notranslate"><span class="pre">R_RegisterCCallable</span></code> and <code class="docutils literal notranslate"><span class="pre">R_GetCCallable</span></code> mechanism, <a class="reference external" href="https://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Linking-to-native-routines-in-other-packages">R-exts§5.4.3</a> and <a class="reference external" href="https://rdatatable.gitlab.io/data.table/reference/cdt.html"><code class="docutils literal notranslate"><span class="pre">?cdt</span></code></a>. Note that organization of our C interface will be changed in future.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">print</span></code> method for <code class="docutils literal notranslate"><span class="pre">data.table</span></code> gains <code class="docutils literal notranslate"><span class="pre">trunc.cols</span></code> argument (and corresponding option <code class="docutils literal notranslate"><span class="pre">datatable.print.trunc.cols</span></code>, default <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1497">#1497</a>, part of <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1523">#1523</a>. This prints only as many columns as fit in the console without wrapping to new lines (e.g., the first 5 of 80 columns) and a message that states the count and names of the variables not shown. When <code class="docutils literal notranslate"><span class="pre">class=TRUE</span></code> the message also contains the classes of the variables. <code class="docutils literal notranslate"><span class="pre">data.table</span></code> has always automatically truncated <em>rows</em> of a table for efficiency (e.g. printing 10 rows instead of 10 million); in the future, we may do the same for <em>columns</em> (e.g., 10 columns instead of 20,000) by changing the default for this argument. Thanks to &#64;nverno for the initial suggestion and to &#64;TysonStanley for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setnames(DT,</span> <span class="pre">new=new_names)</span></code> (i.e. explicitly named <code class="docutils literal notranslate"><span class="pre">new=</span></code> argument) now works as expected rather than an error message requesting that <code class="docutils literal notranslate"><span class="pre">old=</span></code> be supplied too, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4041">#4041</a>. Thanks &#64;Kodiologist for the suggestion.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nafill</span></code> and <code class="docutils literal notranslate"><span class="pre">setnafill</span></code> gain <code class="docutils literal notranslate"><span class="pre">nan</span></code> argument to say whether <code class="docutils literal notranslate"><span class="pre">NaN</span></code> should be considered the same as <code class="docutils literal notranslate"><span class="pre">NA</span></code> for filling purposes, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4020">#4020</a>. Prior versions had an implicit value of <code class="docutils literal notranslate"><span class="pre">nan=NaN</span></code>; the default is now <code class="docutils literal notranslate"><span class="pre">nan=NA</span></code>, i.e., <code class="docutils literal notranslate"><span class="pre">NaN</span></code> is treated as if it’s missing. Thanks &#64;AnonymousBoba for the suggestion. Also, while <code class="docutils literal notranslate"><span class="pre">nafill</span></code> still respects <code class="docutils literal notranslate"><span class="pre">getOption('datatable.verbose')</span></code>, the <code class="docutils literal notranslate"><span class="pre">verbose</span></code> argument has been removed.</p></li>
<li><p>New function <code class="docutils literal notranslate"><span class="pre">fcase(...,default)</span></code> implemented in C by Morgan Jacob, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3823">#3823</a>, is inspired by SQL <code class="docutils literal notranslate"><span class="pre">CASE</span> <span class="pre">WHEN</span></code> which is a common tool in SQL for e.g. building labels or cutting age groups based on conditions. <code class="docutils literal notranslate"><span class="pre">fcase</span></code> is comparable to R function <code class="docutils literal notranslate"><span class="pre">dplyr::case_when</span></code> however it evaluates its arguments in a lazy way (i.e. only when needed) as shown below. Please see <code class="docutils literal notranslate"><span class="pre">?fcase</span></code> for more details.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lazy evaluation</span>
<span class="n">x</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span>
<span class="n">data.table</span><span class="o">::</span><span class="nf">fcase</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">&lt;</span> <span class="m">5L</span><span class="p">,</span> <span class="m">1L</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">&gt;=</span> <span class="m">5L</span><span class="p">,</span> <span class="m">3L</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">==</span> <span class="m">5L</span><span class="p">,</span> <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;provided value is an unexpected one!&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1"># [1] 1 1 1 1 3 3 3 3 3 3</span>

<span class="n">dplyr</span><span class="o">::</span><span class="nf">case_when</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">&lt;</span> <span class="m">5L</span> <span class="o">~</span> <span class="m">1L</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">&gt;=</span> <span class="m">5L</span> <span class="o">~</span> <span class="m">3L</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">==</span> <span class="m">5L</span> <span class="o">~</span> <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;provided value is an unexpected one!&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1"># Error in eval_tidy(pair$rhs, env = default_env) :</span>
<span class="c1">#  provided value is an unexpected one!</span>

<span class="c1"># Benchmark</span>
<span class="n">x</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span> <span class="m">3e7</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="c1"># 114 MB</span>
<span class="n">microbenchmark</span><span class="o">::</span><span class="nf">microbenchmark</span><span class="p">(</span>
<span class="n">dplyr</span><span class="o">::</span><span class="nf">case_when</span><span class="p">(</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">10L</span> <span class="o">~</span> <span class="m">0L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">20L</span> <span class="o">~</span> <span class="m">10L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">30L</span> <span class="o">~</span> <span class="m">20L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">40L</span> <span class="o">~</span> <span class="m">30L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">50L</span> <span class="o">~</span> <span class="m">40L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">60L</span> <span class="o">~</span> <span class="m">50L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&gt;</span> <span class="m">60L</span> <span class="o">~</span> <span class="m">60L</span>
<span class="p">),</span>
<span class="n">data.table</span><span class="o">::</span><span class="nf">fcase</span><span class="p">(</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">10L</span><span class="p">,</span> <span class="m">0L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">20L</span><span class="p">,</span> <span class="m">10L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">30L</span><span class="p">,</span> <span class="m">20L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">40L</span><span class="p">,</span> <span class="m">30L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">50L</span><span class="p">,</span> <span class="m">40L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&lt;</span> <span class="m">60L</span><span class="p">,</span> <span class="m">50L</span><span class="p">,</span>
  <span class="n">x</span> <span class="o">&gt;</span> <span class="m">60L</span><span class="p">,</span> <span class="m">60L</span>
<span class="p">),</span>
<span class="n">times</span> <span class="o">=</span> <span class="m">5L</span><span class="p">,</span>
<span class="n">unit</span> <span class="o">=</span> <span class="s">&quot;s&quot;</span><span class="p">)</span>
<span class="c1"># Unit: seconds</span>
<span class="c1">#               expr   min    lq  mean   median    uq    max neval</span>
<span class="c1"># dplyr::case_when   11.57 11.71 12.22    11.82 12.00  14.02     5</span>
<span class="c1"># data.table::fcase   1.49  1.55  1.67     1.71  1.73   1.86     5</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.SDcols=is.numeric</span></code> now works; i.e., <code class="docutils literal notranslate"><span class="pre">SDcols=</span></code> accepts a function which is used to select the columns of <code class="docutils literal notranslate"><span class="pre">.SD</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3950">#3950</a>. Any function (even <em>ad hoc</em>) that returns scalar <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>/<code class="docutils literal notranslate"><span class="pre">FALSE</span></code> for each column will do; e.g., <code class="docutils literal notranslate"><span class="pre">.SDcols=!is.character</span></code> will return <em>non</em>-character columns (<em>a la</em> <code class="docutils literal notranslate"><span class="pre">Negate()</span></code>). Note that <code class="docutils literal notranslate"><span class="pre">.SDcols=patterns(...)</span></code> can still be used for filtering based on the column names.</p></li>
<li><p>Compiler support for OpenMP is now detected during installation, which allows <code class="docutils literal notranslate"><span class="pre">data.table</span></code> to compile from source (in single threaded mode) on macOS which, frustratingly, does not include OpenMP support by default, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2161">#2161</a>, unlike Windows and Linux. A helpful message is emitted during installation from source, and on package startup as before. Many thanks to &#64;jimhester for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> now supports columns of type <code class="docutils literal notranslate"><span class="pre">expression</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/546">#546</a>. Thanks &#64;jangorecki for the report.</p></li>
<li><p>The dimensions of objects in a <code class="docutils literal notranslate"><span class="pre">list</span></code> column are now displayed, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3671">#3671</a>. Thanks to &#64;randomgambit for the request, and Tyson Barrett for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frank</span></code> gains <code class="docutils literal notranslate"><span class="pre">ties.method='last'</span></code>, paralleling the same in <code class="docutils literal notranslate"><span class="pre">base::order</span></code> which has been available since R 3.3.0 (April 2016), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1689">#1689</a>. Thanks &#64;abudis for the encouragement to accommodate this.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">keep.rownames</span></code> argument in <code class="docutils literal notranslate"><span class="pre">as.data.table.xts</span></code> now accepts a string, which can be used for specifying the column name of the index of the xts input, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4232">#4232</a>. Thanks to &#64;shrektan for the request and the PR.</p></li>
<li><p>New symbol <code class="docutils literal notranslate"><span class="pre">.NGRP</span></code> available in <code class="docutils literal notranslate"><span class="pre">j</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1206">#1206</a>. <code class="docutils literal notranslate"><span class="pre">.GRP</span></code> (the group number) was already available taking values from <code class="docutils literal notranslate"><span class="pre">1</span></code> to <code class="docutils literal notranslate"><span class="pre">.NGRP</span></code>. The number of groups, <code class="docutils literal notranslate"><span class="pre">.NGRP</span></code>, might be useful in <code class="docutils literal notranslate"><span class="pre">j</span></code> to calculate a percentage of groups processed so far, or to do something different for the last or penultimate group, for example.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">round()</span></code> and <code class="docutils literal notranslate"><span class="pre">trunc()</span></code> to extend functionality of <code class="docutils literal notranslate"><span class="pre">ITime</span></code>. <code class="docutils literal notranslate"><span class="pre">round()</span></code> and <code class="docutils literal notranslate"><span class="pre">trunc()</span></code> can be used with argument units: “hours” or “minutes”. Thanks to &#64;JensPederM for the suggestion and PR.</p></li>
<li><p>A new throttle feature has been introduced to speed up small data tasks that are repeated in a loop, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3175">#3175</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3438">#3438</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3205">#3205</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3735">#3735</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3739">#3739</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4284">#4284</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4527">#4527</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4294">#4294</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1120">#1120</a>. The default throttle of 1024 means that a single thread will be used when nrow&lt;=1024, two threads when nrow&lt;=2048, etc. To change the default, use <code class="docutils literal notranslate"><span class="pre">setDTthreads(throttle=)</span></code>. Or use the new environment variable <code class="docutils literal notranslate"><span class="pre">R_DATATABLE_THROTTLE</span></code>. If you use <code class="docutils literal notranslate"><span class="pre">Sys.setenv()</span></code> in a running R session to change this environment variable, be sure to run an empty <code class="docutils literal notranslate"><span class="pre">setDTthreads()</span></code> call afterwards for the change to take effect; see <code class="docutils literal notranslate"><span class="pre">?setDTthreads</span></code>. The word <em>throttle</em> is used to convey that the number of threads is restricted (throttled) for small data tasks. Reducing throttle to 1 will turn off throttling and should revert behaviour to past versions (i.e. using many threads even for small data). Increasing throttle to, say, 65536 will utilize multi-threading only for larger datasets. The value 1024 is a guess. We welcome feedback and test results indicating what the best default should be.</p></li>
</ol>
</div>
<div class="section" id="id9">
<h2>BUG FIXES<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>A NULL timezone on POSIXct was interpreted by <code class="docutils literal notranslate"><span class="pre">as.IDate</span></code> and <code class="docutils literal notranslate"><span class="pre">as.ITime</span></code> as UTC rather than the session’s default timezone (<code class="docutils literal notranslate"><span class="pre">tz=&quot;&quot;</span></code>) , <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4085">#4085</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[i]</span></code> could segfault when <code class="docutils literal notranslate"><span class="pre">i</span></code> is a zero-column <code class="docutils literal notranslate"><span class="pre">data.table</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4060">#4060</a>. Thanks &#64;shrektan for reporting and fixing.</p></li>
<li><p>Dispatch of <code class="docutils literal notranslate"><span class="pre">first</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code> functions now properly works again for <code class="docutils literal notranslate"><span class="pre">xts</span></code> objects, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4053">#4053</a>. Thanks to &#64;ethanbsmith for reporting.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">.SD</span></code> is returned as-is during grouping, it is now unlocked for downstream usage, part of <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4159">#4159</a>. Thanks also to &#64;mllg for detecting a problem with the initial fix here during the dev release <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4173">#4173</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GForce</span></code> is deactivated for <code class="docutils literal notranslate"><span class="pre">[[</span></code> on non-atomic input, part of <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4159">#4159</a>. Thanks &#64;hongyuanjia and &#64;ColeMiller1 for helping debug an issue in dev with the original fix before release, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4612">#4612</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">all.equal(DT,</span> <span class="pre">y)</span></code> no longer errors when <code class="docutils literal notranslate"><span class="pre">y</span></code> is not a data.table, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4042">#4042</a>. Thanks to &#64;d-sci for reporting and the PR.</p></li>
<li><p>A length 1 <code class="docutils literal notranslate"><span class="pre">colClasses=NA_character_</span></code> would cause <code class="docutils literal notranslate"><span class="pre">fread</span></code> to incorrectly coerce all columns to character, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4237">#4237</a>.</p></li>
<li><p>An <code class="docutils literal notranslate"><span class="pre">fwrite</span></code> error message could include a garbled number and cause test 1737.5 to fail, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3492">#3492</a>. Thanks to &#64;QuLogic for debugging the issue on ARMv7hl, and the PR fixing it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread</span></code> improves handling of very small (&lt;1e-300) or very large (&gt;1e+300) floating point numbers on non-x86 architectures (specifically ppc64le and armv7hl). Thanks to &#64;QuLogic for reporting and fixing, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4165">PR#4165</a>.</p></li>
<li><p>When updating by reference, the use of <code class="docutils literal notranslate"><span class="pre">get</span></code> could result in columns being re-ordered silently, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4089">#4089</a>. Thanks to &#64;dmongin for reporting and Cole Miller for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">copy()</span></code> now overallocates deeply nested lists of <code class="docutils literal notranslate"><span class="pre">data.table</span></code>s, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4205">#4205</a>. Thanks to &#64;d-sci for reporting and the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> no longer errors when coercing complex vectors to character vectors, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4202">#4202</a>. Thanks to &#64;sritchie73 for reporting and the PR.</p></li>
<li><p>A relatively rare case of segfault when combining non-equi joins with <code class="docutils literal notranslate"><span class="pre">by=.EACHI</span></code> is now fixed, closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4388">#4388</a>.</p></li>
<li><p>Selecting key columns could incur a large speed penalty, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4498">#4498</a>. Thanks to &#64;Jesper on Stack Overflow for the report.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">all.equal(DT1,</span> <span class="pre">DT2,</span> <span class="pre">ignore.row.order=TRUE)</span></code> could return TRUE incorrectly in the presence of NAs, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4422">#4422</a>.</p></li>
<li><p>Non-equi joins now automatically set <code class="docutils literal notranslate"><span class="pre">allow.cartesian=TRUE</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4489">4489</a>. Thanks to &#64;Henrik-P for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[Y,</span> <span class="pre">on=character(0)]</span></code> and <code class="docutils literal notranslate"><span class="pre">merge(X,</span> <span class="pre">Y,</span> <span class="pre">by.x=character(0),</span> <span class="pre">by.y=character(0))</span></code> no longer crash, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4272">#4272</a>. Thanks to &#64;tlapak for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">by=col1:col4</span></code> gave an incorrect result if <code class="docutils literal notranslate"><span class="pre">key(DT)==c(&quot;col1&quot;,&quot;col4&quot;)</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4285">#4285</a>. Thanks to &#64;cbilot for reporting, and Cole Miller for the PR.</p></li>
<li><p>Matrices resulting from logical operators or comparisons on <code class="docutils literal notranslate"><span class="pre">data.table</span></code>s, e.g. in <code class="docutils literal notranslate"><span class="pre">dta</span> <span class="pre">==</span> <span class="pre">dtb</span></code>, can no longer have their colnames changed by reference later, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4323">#4323</a>. Thanks to &#64;eyherabh for reporting and &#64;tlapak for the PR.</p></li>
<li><p>The environment variable <code class="docutils literal notranslate"><span class="pre">R_DATATABLE_NUM_THREADS</span></code> was being limited by <code class="docutils literal notranslate"><span class="pre">R_DATATABLE_NUM_PROCS_PERCENT</span></code> (by default 50%), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4514">#4514</a>. It is now consistent with <code class="docutils literal notranslate"><span class="pre">setDTthreads()</span></code> and only limited by the full number of logical CPUs. For example, on a machine with 8 logical CPUs, <code class="docutils literal notranslate"><span class="pre">R_DATATABLE_NUM_THREADS=6</span></code> now results in 6 threads rather than 4 (50% of 8).</p></li>
</ol>
</div>
<div class="section" id="id10">
<h2>NOTES<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>Retrospective license change permission was sought from and granted by 4 contributors who were missed in <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2456">PR#2456</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4140">#4140</a>. We had used <a class="reference external" href="https://github.com/Rdatatable/data.table/graphs/contributors">GitHub’s contributor page</a> which omits 3 of these due to invalid email addresses, unlike GitLab’s contributor page which includes the ids. The 4th omission was a PR to a script which should not have been excluded; a script is code too. We are sorry these contributors were not properly credited before. They have now been added to the contributors list as displayed on CRAN. All the contributors of code to data.table hold its copyright jointly; your contributions belong to you. You contributed to data.table when it had a particular license at that time, and you contributed on that basis. This is why in the last license change, all contributors of code were consulted and each had a veto.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.IDate</span></code>, <code class="docutils literal notranslate"><span class="pre">as.ITime</span></code>, <code class="docutils literal notranslate"><span class="pre">second</span></code>, <code class="docutils literal notranslate"><span class="pre">minute</span></code>, and <code class="docutils literal notranslate"><span class="pre">hour</span></code> now recognize UTC equivalents for speed: GMT, GMT-0, GMT+0, GMT0, Etc/GMT, and Etc/UTC, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4116">#4116</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set2key</span></code>, <code class="docutils literal notranslate"><span class="pre">set2keyv</span></code>, and <code class="docutils literal notranslate"><span class="pre">key2</span></code> have been removed, as they have been warning since v1.9.8 (Nov 2016) and halting with helpful message since v1.11.0 (May 2018). When they were introduced in version 1.9.4 (Oct 2014) they were marked as ‘experimental’ and quickly superseded by <code class="docutils literal notranslate"><span class="pre">setindex</span></code> and <code class="docutils literal notranslate"><span class="pre">indices</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.table</span></code> now supports messaging in simplified Chinese (locale <code class="docutils literal notranslate"><span class="pre">zh_CN</span></code>). This was the result of a monumental collaboration to translate <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s roughly 1400 warnings, errors, and verbose messages (about 16,000 words/100,000 characters) over the course of two months from volunteer translators in at least 4 time zones, most of whom are first-time <code class="docutils literal notranslate"><span class="pre">data.table</span></code> contributors and many of whom are first-time OSS contributors!</p>
<p>A big thanks goes out to &#64;fengqifang, &#64;hongyuanjia, &#64;biobai, &#64;zhiiiyang, &#64;Leo-Lee15, &#64;soappp9527, &#64;amy17519, &#64;Zachary-Wu, &#64;caiquanyou, &#64;dracodoc, &#64;JulianYlli12, &#64;renkun-ken, &#64;Xueliang24, &#64;koohoko, &#64;KingdaShi, &#64;gaospecial, &#64;shrektan, &#64;sunshine1126, &#64;shawnchen1996, &#64;yc0802, &#64;HesperusArcher, and &#64;Emberwhirl, all of whom took time from their busy schedules to translate and review others’ translations. Especial thanks goes to &#64;zhiiiyang and &#64;hongyuanjia who went above and beyond in helping to push the project over the finish line, and to &#64;GuangchuangYu who helped to organize the volunteer pool.</p>
<p><code class="docutils literal notranslate"><span class="pre">data.table</span></code> joins <code class="docutils literal notranslate"><span class="pre">lubridate</span></code> and <code class="docutils literal notranslate"><span class="pre">nlme</span></code> as the only of the top 200 most-downloaded community packages on CRAN to offer non-English messaging, and is the only of the top 50 packages to offer complete support of all messaging. We hope this is a first step in broadening the reach and accessibility of the R ecosystem to more users globally and look forward to working with other maintainers looking to bolster the portability of their packages by offering advice on learnings from this undertaking.</p>
<p>We would be remiss not to mention the laudable lengths to which the R core team goes to maintain the <em>much</em> larger repository (about 6,000 messages in more than 10 languages) of translations for R itself.</p>
<p>We will evaluate the feasibility (in terms of maintenance difficulty and CRAN package size limits) of offering support for other languages in later releases.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fifelse</span></code> and <code class="docutils literal notranslate"><span class="pre">fcase</span></code> now notify users that S4 objects (except <code class="docutils literal notranslate"><span class="pre">nanotime</span></code>) are not supported <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4135">#4135</a>. Thanks to &#64;torema-ed for bringing it to our attention and Morgan Jacob for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frank(...,</span> <span class="pre">ties.method=&quot;random&quot;,</span> <span class="pre">na.last=NA)</span></code> now returns the same random ordering that <code class="docutils literal notranslate"><span class="pre">base::rank</span></code> does, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4243">#4243</a>.</p></li>
<li><p>The error message when mistakenly using <code class="docutils literal notranslate"><span class="pre">:=</span></code> in <code class="docutils literal notranslate"><span class="pre">i</span></code> instead of <code class="docutils literal notranslate"><span class="pre">j</span></code> has been much improved, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4227">#4227</a>. Thanks to Hugh Parsonage for the detailed suggestion.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">DT</span> <span class="o">=</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">DT</span><span class="p">[</span><span class="n">B</span><span class="o">:=</span><span class="m">3</span><span class="p">]</span>
<span class="n">Error</span><span class="o">:</span> <span class="n">Operator</span> <span class="o">:=</span> <span class="n">detected</span> <span class="n">in</span> <span class="n">i</span><span class="p">,</span> <span class="n">the</span> <span class="n">first</span> <span class="n">argument</span> <span class="n">inside</span> <span class="n">DT</span><span class="p">[</span><span class="kc">...</span><span class="p">],</span> <span class="n">but</span> <span class="n">is</span> <span class="n">only</span> <span class="n">valid</span> <span class="n">in</span>
       <span class="n">the</span> <span class="n">second</span> <span class="n">argument</span><span class="p">,</span> <span class="n">j.</span> <span class="n">Most</span> <span class="n">often</span><span class="p">,</span> <span class="n">this</span> <span class="n">happens</span> <span class="n">when</span> <span class="n">forgetting</span> <span class="n">the</span> <span class="n">first</span> <span class="nf">comma</span>
<span class="nf">       </span><span class="p">(</span><span class="n">e.g.</span> <span class="n">DT</span><span class="p">[</span><span class="n">newvar</span><span class="o">:=</span><span class="m">5</span><span class="p">]</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">DT</span><span class="p">[,</span> <span class="n">new_var</span><span class="o">:=</span><span class="m">5</span><span class="p">])</span><span class="n">.</span> <span class="n">Please</span> <span class="n">double</span><span class="o">-</span><span class="n">check</span> <span class="n">the</span>
       <span class="n">syntax.</span> <span class="n">Run</span> <span class="nf">traceback</span><span class="p">(),</span> <span class="n">and</span> <span class="nf">debugger</span><span class="p">()</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="n">line</span> <span class="n">number.</span>
<span class="o">&gt;</span> <span class="n">DT</span><span class="p">[,</span> <span class="n">B</span><span class="o">:=</span><span class="m">3</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="n">DT</span>
       <span class="n">A</span>     <span class="n">B</span>
   <span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">num</span><span class="o">&gt;</span>
<span class="m">1</span><span class="o">:</span>     <span class="m">1</span>     <span class="m">3</span>
<span class="m">2</span><span class="o">:</span>     <span class="m">2</span>     <span class="m">3</span>
</pre></div>
</div>
</li>
<li><p>Added more explanation/examples to <code class="docutils literal notranslate"><span class="pre">?data.table</span></code> for how to use <code class="docutils literal notranslate"><span class="pre">.BY</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1363">#1363</a>.</p></li>
<li><p>Changes upstream in R have been accomodated; e.g. <code class="docutils literal notranslate"><span class="pre">c.POSIXct</span></code> now raises <code class="docutils literal notranslate"><span class="pre">'origin'</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">supplied</span></code> which impacted <code class="docutils literal notranslate"><span class="pre">foverlaps</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4428">#4428</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.table::update.dev.pkg()</span></code> now unloads the <code class="docutils literal notranslate"><span class="pre">data.table</span></code> namespace to alleviate a DLL lock issue on Windows, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4403">#4403</a>. Thanks to &#64;drag5 for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.table</span></code> packages binaries built by R version 3 (R3) should only be installed in R3, and similarly <code class="docutils literal notranslate"><span class="pre">data.table</span></code> package binaries built by R4 should only be installed in R4. Otherwise, <code class="docutils literal notranslate"><span class="pre">package</span> <span class="pre">‘data.table’</span> <span class="pre">was</span> <span class="pre">built</span> <span class="pre">under</span> <span class="pre">R</span> <span class="pre">version...</span></code> warning will occur which should not be ignored. This is due to a very welcome change to <code class="docutils literal notranslate"><span class="pre">rbind</span></code> and <code class="docutils literal notranslate"><span class="pre">cbind</span></code> in R 4.0.0 which enabled us to remove workarounds, see news item in v1.12.6 below in this file. To continue to support both R3 and R4, <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s NAMESPACE file contains a condition on the R major version (3 or 4) and this is what gives rise to the requirement that the major version used to build <code class="docutils literal notranslate"><span class="pre">data.table</span></code> must match the major version used to install it. Thanks to &#64;vinhdizzo for reporting, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4528">#4528</a>.</p></li>
<li><p>Internal function <code class="docutils literal notranslate"><span class="pre">shallow()</span></code> no longer makes a deep copy of secondary indices. This eliminates a relatively small time and memory overhead when indices are present that added up significantly when performing many operations, such as joins, in a loop or when joining in <code class="docutils literal notranslate"><span class="pre">j</span></code> by group, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4311">#4311</a>. Many thanks to &#64;renkun-ken for the report, and &#64;tlapak for the investigation and PR.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">datatable.old.unique.by.key</span></code> option has been removed as per the 4 year schedule detailed in note 10 of v1.12.4 (Oct 2019), note 10 of v1.11.0 (May 2018), and note 1 of v1.9.8 (Nov 2016). It has been generating a helpful warning for 2 years, and helpful error for 1 year.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-12-8-09-dec-2019">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/15?closed=1">v1.12.8</a>  (09 Dec 2019)<a class="headerlink" href="#data-table-v1-12-8-09-dec-2019" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id11">
<h2>NEW FEATURES<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">{...;</span> <span class="pre">.(A,B)}]</span></code> (i.e. when <code class="docutils literal notranslate"><span class="pre">.()</span></code> is the final item of a multi-statement <code class="docutils literal notranslate"><span class="pre">{...}</span></code>) now auto-names the columns <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> (just like <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">.(A,B)]</span></code>) rather than <code class="docutils literal notranslate"><span class="pre">V1</span></code> and <code class="docutils literal notranslate"><span class="pre">V2</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2478">#2478</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/609">#609</a>. Similarly, <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">if</span> <span class="pre">(.N&gt;1)</span> <span class="pre">.(B),</span> <span class="pre">by=A]</span></code> now auto-names the column <code class="docutils literal notranslate"><span class="pre">B</span></code> rather than <code class="docutils literal notranslate"><span class="pre">V1</span></code>. Explicit names are unaffected; e.g. <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">{...</span> <span class="pre">y=</span> <span class="pre">...;</span> <span class="pre">.(A=C+y)},</span> <span class="pre">by=...]</span></code> named the column <code class="docutils literal notranslate"><span class="pre">A</span></code> before, and still does. Thanks also to &#64;renkun-ken for his go-first strong testing which caught an issue not caught by the test suite or by revdep testing, related to NULL being the last item, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4061">#4061</a>.</p></li>
</ol>
</div>
<div class="section" id="id12">
<h2>BUG FIXES<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frollapply</span></code> could segfault and exceed R’s C protect limits, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3993">#3993</a>. Thanks to &#64;DavisVaughan for reporting and fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">sum(grp),</span> <span class="pre">by=grp]</span></code> (i.e. aggregating the same column being grouped) could error with <code class="docutils literal notranslate"><span class="pre">object</span> <span class="pre">'grp'</span> <span class="pre">not</span> <span class="pre">found</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3103">#3103</a>. Thanks to &#64;cbailiss for reporting.</p></li>
</ol>
</div>
<div class="section" id="id13">
<h2>NOTES<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Links in the manual were creating warnings when installing HTML, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4000">#4000</a>. Thanks to Morgan Jacob.</p></li>
<li><p>Adjustments for R-devel (R 4.0.0) which now has reference counting turned on, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4058">#4058</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4093">#4093</a>. This motivated early release to CRAN because every day CRAN tests every package using the previous day’s changes in R-devel; a much valued feature of the R ecosystem. It helps R-core if packages can pass changes in R-devel as soon as possible. Thanks to Luke Tierney for the notice, and for implementing reference counting which we look forward to very much.</p></li>
<li><p>C internals have been standardized to use <code class="docutils literal notranslate"><span class="pre">PRI[u|d]64</span></code> to print <code class="docutils literal notranslate"><span class="pre">[u]int64_t</span></code>. This solves new warnings from <code class="docutils literal notranslate"><span class="pre">gcc-8</span></code> on Windows with <code class="docutils literal notranslate"><span class="pre">%lld</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4062">#4062</a>, in many cases already working around <code class="docutils literal notranslate"><span class="pre">snprintf</span></code> on Windows not supporting <code class="docutils literal notranslate"><span class="pre">%zu</span></code>. Release procedures have been augmented to prevent any internal use of <code class="docutils literal notranslate"><span class="pre">llu</span></code>, <code class="docutils literal notranslate"><span class="pre">lld</span></code>, <code class="docutils literal notranslate"><span class="pre">zu</span></code> or <code class="docutils literal notranslate"><span class="pre">zd</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test.data.table()</span></code> gains <code class="docutils literal notranslate"><span class="pre">showProgress=interactive()</span></code> to suppress the thousands of <code class="docutils literal notranslate"><span class="pre">Running</span> <span class="pre">test</span> <span class="pre">id</span> <span class="pre">&lt;num&gt;</span> <span class="pre">...</span></code> lines displayed by CRAN checks when there are warnings or errors.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-12-6-18-oct-2019">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/18?closed=1">v1.12.6</a>  (18 Oct 2019)<a class="headerlink" href="#data-table-v1-12-6-18-oct-2019" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id14">
<h2>BUG FIXES<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">shift()</span></code> on a <code class="docutils literal notranslate"><span class="pre">nanotime</span></code> with the default <code class="docutils literal notranslate"><span class="pre">fill=NA</span></code> now fills a <code class="docutils literal notranslate"><span class="pre">nanotime</span></code> missing value correctly, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3945">#3945</a>. Thanks to &#64;mschubmehl for reporting and fixing in PR <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3942">#3942</a>.</p></li>
<li><p>Compilation failed on CRAN’s MacOS due to an older version of <code class="docutils literal notranslate"><span class="pre">zlib.h/zconf.h</span></code> which did not have <code class="docutils literal notranslate"><span class="pre">z_const</span></code> defined, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3939">#3939</a>. Other open-source projects unrelated to R have experienced this problem on MacOS too. We have followed the common practice of removing <code class="docutils literal notranslate"><span class="pre">z_const</span></code> to support the older <code class="docutils literal notranslate"><span class="pre">zlib</span></code> versions, and data.table’s release procedures have gained a <code class="docutils literal notranslate"><span class="pre">grep</span></code> to ensure <code class="docutils literal notranslate"><span class="pre">z_const</span></code> isn’t used again by accident in future. The library <code class="docutils literal notranslate"><span class="pre">zlib</span></code> is used for <code class="docutils literal notranslate"><span class="pre">fwrite</span></code>’s new feature of multithreaded compression on-the-fly; see item 3 of 1.12.4 below.</p></li>
<li><p>A runtime error in <code class="docutils literal notranslate"><span class="pre">fwrite</span></code>’s compression, but only observed so far on Solaris 10 32bit with zlib 1.2.8 (Apr 2013), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3931">#3931</a>: <code class="docutils literal notranslate"><span class="pre">Error</span> <span class="pre">-2:</span> <span class="pre">one</span> <span class="pre">or</span> <span class="pre">more</span> <span class="pre">threads</span> <span class="pre">failed</span> <span class="pre">to</span> <span class="pre">allocate</span> <span class="pre">buffers</span> <span class="pre">or</span> <span class="pre">there</span> <span class="pre">was</span> <span class="pre">a</span> <span class="pre">compression</span> <span class="pre">error.</span></code> In case it happens again, this area has been made more robust and the error more detailed. As is often the case, investigating the Solaris problem revealed secondary issues in the same area of the code. In this case, some <code class="docutils literal notranslate"><span class="pre">%d</span></code> in verbose output should have been <code class="docutils literal notranslate"><span class="pre">%lld</span></code>. This obliquity that CRAN’s Solaris provides is greatly appreciated.</p></li>
<li><p>A leak could occur in the event of an unsupported column type error, or if working memory could only partially be allocated; <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3940">#3940</a>. Found thanks to <code class="docutils literal notranslate"><span class="pre">clang</span></code>’s Leak Sanitizer (prompted by CRAN’s diligent use of latest tools), and two tests in the test suite which tested the unsupported-type error.</p></li>
</ol>
</div>
<div class="section" id="id15">
<h2>NOTES<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Many thanks to Kurt Hornik for fixing R’s S3 dispatch of <code class="docutils literal notranslate"><span class="pre">rbind</span></code> and <code class="docutils literal notranslate"><span class="pre">cbind</span></code> methods, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3948">#3948</a>. With <code class="docutils literal notranslate"><span class="pre">R&gt;=4.0.0</span></code> (current R-devel), <code class="docutils literal notranslate"><span class="pre">data.table</span></code> now registers the S3 methods <code class="docutils literal notranslate"><span class="pre">cbind.data.table</span></code> and <code class="docutils literal notranslate"><span class="pre">rbind.data.table</span></code>, and no longer applies the workaround documented in FAQ 2.24.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-12-4-03-oct-2019">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/16?closed=1">v1.12.4</a>  (03 Oct 2019)<a class="headerlink" href="#data-table-v1-12-4-03-oct-2019" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id16">
<h2>NEW FEATURES<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">rleid()</span></code> functions now support long vectors (length &gt; 2 billion).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code>:</p>
<ul class="simple">
<li><p>now skips embedded <code class="docutils literal notranslate"><span class="pre">NUL</span></code> (<code class="docutils literal notranslate"><span class="pre">\0</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3400">#3400</a>. Thanks to Marcus Davy for reporting with examples, Roy Storey for the initial PR, and Bingjie Qian for testing this feature on a very complicated real-world file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">colClasses</span></code> now supports <code class="docutils literal notranslate"><span class="pre">'complex'</span></code>, <code class="docutils literal notranslate"><span class="pre">'raw'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Date'</span></code>, <code class="docutils literal notranslate"><span class="pre">'POSIXct'</span></code>, and user-defined classes (so long as an <code class="docutils literal notranslate"><span class="pre">as.</span></code> method exists), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/491">#491</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1634">#1634</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2610">#2610</a>. Any error during coercion results in a warning and the column is left as the default type (probably <code class="docutils literal notranslate"><span class="pre">&quot;character&quot;</span></code>). Thanks to &#64;hughparsonage for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stringsAsFactors=0.10</span></code> will factorize any character column containing under <code class="docutils literal notranslate"><span class="pre">0.10*nrow</span></code> unique strings, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2025">#2025</a>. Thanks to &#64;hughparsonage for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">colClasses=list(numeric=20:30,</span> <span class="pre">numeric=&quot;ID&quot;)</span></code> will apply the <code class="docutils literal notranslate"><span class="pre">numeric</span></code> type to column numbers <code class="docutils literal notranslate"><span class="pre">20:30</span></code> as before and now also column name <code class="docutils literal notranslate"><span class="pre">&quot;ID&quot;</span></code>; i.e. all duplicate class names are now respected rather than only the first. This need may arise when specifying some columns by name and others by number, as in this example. Thanks to &#64;hughparsonage for the PR.</p></li>
<li><p>gains <code class="docutils literal notranslate"><span class="pre">yaml</span></code> (default <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>) and the ability to parse CSVY-formatted input files; i.e., csv files with metadata in a header formatted as YAML (<a class="reference external" href="https://csvy.org/">https://csvy.org/</a>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1701">#1701</a>. See <code class="docutils literal notranslate"><span class="pre">?fread</span></code> and files in <code class="docutils literal notranslate"><span class="pre">/inst/tests/csvy/</span></code> for sample formats. Please provide feedback if you find this feature useful and would like extended capabilities. For now, consider it experimental, meaning the API/arguments may change. Thanks to &#64;leeper at <a class="reference external" href="https://github.com/leeper/rio"><code class="docutils literal notranslate"><span class="pre">rio</span></code></a> for the inspiration and &#64;MichaelChirico for implementing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">select</span></code> can now be used to specify types for just the columns selected, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1426">#1426</a>. Just like <code class="docutils literal notranslate"><span class="pre">colClasses</span></code> it can be a named vector of <code class="docutils literal notranslate"><span class="pre">colname=type</span></code> pairs, or a named <code class="docutils literal notranslate"><span class="pre">list</span></code> of <code class="docutils literal notranslate"><span class="pre">type=col(s)</span></code> pairs. For example:</p></li>
</ul>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">fread</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">colD</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span>     <span class="c1"># returns 2 columns: colD,colA</span>
                     <span class="n">colA</span><span class="o">=</span><span class="s">&quot;integer64&quot;</span><span class="p">))</span>
<span class="nf">fread</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">character</span><span class="o">=</span><span class="s">&quot;colD&quot;</span><span class="p">,</span>  <span class="c1"># returns 5 columns: colD,8,9,10,colA</span>
                        <span class="n">integer</span><span class="o">=</span>  <span class="m">8</span><span class="o">:</span><span class="m">10</span><span class="p">,</span>
                        <span class="n">character</span><span class="o">=</span><span class="s">&quot;colA&quot;</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><p>gains <code class="docutils literal notranslate"><span class="pre">tmpdir=</span></code> argument which is passed to <code class="docutils literal notranslate"><span class="pre">tempfile()</span></code> whenever a temporary file is needed. Thanks to &#64;mschubmehl for the PR. As before, setting <code class="docutils literal notranslate"><span class="pre">TMPDIR</span></code> (to <code class="docutils literal notranslate"><span class="pre">/dev/shm</span></code> for example) before starting the R session still works too; see <code class="docutils literal notranslate"><span class="pre">?base::tempdir</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code>:</p>
<ul class="simple">
<li><p>now writes compressed <code class="docutils literal notranslate"><span class="pre">.gz</span></code> files directly, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2016">#2016</a>. Compression, like <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code>, is multithreaded and compresses each chunk on-the-fly (a full size intermediate file is not created). Use a “.gz” extension, or the new <code class="docutils literal notranslate"><span class="pre">compress=</span></code> option. Many thanks to Philippe Chataignon for the significant PR. For example:</p></li>
</ul>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span> <span class="o">=</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="m">100e6</span><span class="p">),</span> <span class="n">B</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="m">50e6</span><span class="p">))</span>
<span class="nf">fwrite</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="s">&quot;data.csv&quot;</span><span class="p">)</span>      <span class="c1"># 763MB; 1.3s</span>
<span class="nf">fwrite</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="s">&quot;data.csv.gz&quot;</span><span class="p">)</span>   <span class="c1">#   2MB; 1.6s</span>
<span class="nf">identical</span><span class="p">(</span><span class="nf">fread</span><span class="p">(</span><span class="s">&quot;data.csv.gz&quot;</span><span class="p">),</span> <span class="n">DT</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that compression is handled using <code class="docutils literal notranslate"><span class="pre">zlib</span></code> library. In the unlikely event of missing <code class="docutils literal notranslate"><span class="pre">zlib.h</span></code>, on a machine that is compiling <code class="docutils literal notranslate"><span class="pre">data.table</span></code> from sources, one may get <code class="docutils literal notranslate"><span class="pre">fwrite.c</span></code> compilation error <code class="docutils literal notranslate"><span class="pre">zlib.h:</span> <span class="pre">No</span> <span class="pre">such</span> <span class="pre">file</span> <span class="pre">or</span> <span class="pre">directory</span></code>. As of now, the easiest solution is to install missing library using <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">zlib1g-dev</span></code> (Debian/Ubuntu). Installing R (<code class="docutils literal notranslate"><span class="pre">r-base-dev</span></code>) depends on <code class="docutils literal notranslate"><span class="pre">zlib1g-dev</span></code> so this should be rather uncommon. If it happens to you please upvote related issue <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3872">#3872</a>.</p>
<ul class="simple">
<li><p>Gains <code class="docutils literal notranslate"><span class="pre">yaml</span></code> argument matching that of <code class="docutils literal notranslate"><span class="pre">fread</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3534">#3534</a>. See the item in <code class="docutils literal notranslate"><span class="pre">fread</span></code> for a bit more detail; here, we’d like to reiterate that feedback is appreciated in the initial phase of rollout for this feature.</p></li>
<li><p>Gains <code class="docutils literal notranslate"><span class="pre">bom</span></code> argument to add a <em>byte order mark</em> (BOM) at the beginning of the file to signal that the file is encoded in UTF-8, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3488">#3488</a>. Thanks to Stefan Fleck for requesting and Philippe Chataignon for implementing.</p></li>
<li><p>Now supports type <code class="docutils literal notranslate"><span class="pre">complex</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3690">#3690</a>.</p></li>
<li><p>Gains <code class="docutils literal notranslate"><span class="pre">scipen</span></code> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2020">#2020</a>, the number 1 most-requested feature <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3189">#3189</a>. The default is <code class="docutils literal notranslate"><span class="pre">getOption(&quot;scipen&quot;)</span></code> so that <code class="docutils literal notranslate"><span class="pre">fwrite</span></code> will now respect R’s option in the same way as <code class="docutils literal notranslate"><span class="pre">base::write.csv</span></code> and <code class="docutils literal notranslate"><span class="pre">base::format</span></code>, as expected. The parameter and option name have been kept the same as base R’s <code class="docutils literal notranslate"><span class="pre">scipen</span></code> for consistency and to aid online search. It stands for ‘scientific penalty’; i.e., the number of characters to add to the width within which non-scientific number format is used if it will fit. A high penalty essentially turns off scientific format. We believe that common practice is to use a value of 999, however, if you do use 999, because your data <em>might</em> include very long numbers such as <code class="docutils literal notranslate"><span class="pre">10^300</span></code>, <code class="docutils literal notranslate"><span class="pre">fwrite</span></code> needs to account for the worst case field width in its buffer allocation per thread. This may impact space or time. If you experience slowdowns or unacceptable memory usage, please pass <code class="docutils literal notranslate"><span class="pre">verbose=TRUE</span></code> to <code class="docutils literal notranslate"><span class="pre">fwrite</span></code>, inspect the output, and report the issue. A workaround, until we can determine the best strategy, may be to pass a smaller value to <code class="docutils literal notranslate"><span class="pre">scipen</span></code>, such as 50. We have observed that <code class="docutils literal notranslate"><span class="pre">fwrite(DT,</span> <span class="pre">scipen=50)</span></code> appears to write <code class="docutils literal notranslate"><span class="pre">10^50</span></code> accurately, unlike base R. However, this may be a happy accident and not apply generally. Further work may be needed in this area.</p></li>
</ul>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span> <span class="o">=</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">0.0001</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="m">1000000</span><span class="p">)</span>
<span class="nf">fwrite</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
<span class="c1"># a,b</span>
<span class="c1"># 1e-04,1e+06</span>
<span class="nf">fwrite</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span><span class="n">scipen</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="c1"># a,b</span>
<span class="c1"># 0.0001,1e+06</span>
<span class="nf">fwrite</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span><span class="n">scipen</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="c1"># a,b</span>
<span class="c1"># 0.0001,1000000</span>

<span class="m">10</span><span class="o">^</span><span class="m">50</span>
<span class="c1"># [1] 1e+50</span>
<span class="nf">options</span><span class="p">(</span><span class="n">scipen</span><span class="o">=</span><span class="m">50</span><span class="p">)</span>
<span class="m">10</span><span class="o">^</span><span class="m">50</span>
<span class="c1"># [1] 100000000000000007629769841091887003294964970946560</span>
<span class="nf">fwrite</span><span class="p">(</span><span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="m">10</span><span class="o">^</span><span class="m">50</span><span class="p">))</span>
<span class="c1"># A</span>
<span class="c1"># 100000000000000000000000000000000000000000000000000</span>
</pre></div>
</div>
</li>
<li><p>Assigning to one item of a list column no longer requires the RHS to be wrapped with <code class="docutils literal notranslate"><span class="pre">list</span></code> or <code class="docutils literal notranslate"><span class="pre">.()</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/950">#950</a>.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">DT</span> <span class="o">=</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="m">3</span><span class="o">:</span><span class="m">5</span><span class="p">))</span>
<span class="o">&gt;</span> <span class="n">DT</span>
       <span class="n">A</span>      <span class="n">B</span>
   <span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">list</span><span class="o">&gt;</span>
<span class="m">1</span><span class="o">:</span>     <span class="m">1</span>    <span class="m">1</span><span class="p">,</span><span class="m">2</span>
<span class="m">2</span><span class="o">:</span>     <span class="m">2</span>    <span class="n">foo</span>
<span class="m">3</span><span class="o">:</span>     <span class="m">3</span>  <span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span>
<span class="o">&gt;</span>
<span class="c1"># The following all accomplish the same assignment:</span>
<span class="o">&gt;</span> <span class="n">DT</span><span class="p">[</span><span class="m">2</span><span class="p">,</span> <span class="n">B</span><span class="o">:=</span><span class="kc">letters</span><span class="p">[</span><span class="m">9</span><span class="o">:</span><span class="m">13</span><span class="p">]]</span>           <span class="c1"># was error, now works</span>
<span class="o">&gt;</span> <span class="n">DT</span><span class="p">[</span><span class="m">2</span><span class="p">,</span> <span class="n">B</span><span class="o">:=</span><span class="nf">.</span><span class="p">(</span><span class="kc">letters</span><span class="p">[</span><span class="m">9</span><span class="o">:</span><span class="m">13</span><span class="p">])]</span>        <span class="c1"># was error, now works</span>
<span class="o">&gt;</span> <span class="n">DT</span><span class="p">[</span><span class="m">2</span><span class="p">,</span> <span class="n">B</span><span class="o">:=</span><span class="nf">.</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="kc">letters</span><span class="p">[</span><span class="m">9</span><span class="o">:</span><span class="m">13</span><span class="p">]))]</span>  <span class="c1"># .(list()) was needed, still works</span>
<span class="o">&gt;</span> <span class="n">DT</span>
       <span class="n">A</span>         <span class="n">B</span>
   <span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span>    <span class="o">&lt;</span><span class="n">list</span><span class="o">&gt;</span>
<span class="m">1</span><span class="o">:</span>     <span class="m">1</span>       <span class="m">1</span><span class="p">,</span><span class="m">2</span>
<span class="m">2</span><span class="o">:</span>     <span class="m">2</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">m</span>
<span class="m">3</span><span class="o">:</span>     <span class="m">3</span>     <span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">print.data.table()</span></code> gains an option to display the timezone of <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> columns when available, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2842">#2842</a>. Thanks to Michael Chirico for reporting and Felipe Parages for the PR.</p></li>
<li><p>New functions <code class="docutils literal notranslate"><span class="pre">nafill</span></code> and <code class="docutils literal notranslate"><span class="pre">setnafill</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/854">#854</a>. Thanks to Matthieu Gomez for the request and Jan Gorecki for implementing.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span> <span class="o">=</span> <span class="nf">setDT</span><span class="p">(</span><span class="nf">lapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">9e6</span><span class="p">),</span> <span class="nf">rep</span><span class="p">(</span><span class="kc">NA_real_</span><span class="p">,</span> <span class="m">1e6</span><span class="p">)))))</span>
<span class="nf">format</span><span class="p">(</span><span class="nf">object.size</span><span class="p">(</span><span class="n">DT</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s">&quot;GB&quot;</span><span class="p">)</span>  <span class="c1">## 7.5 Gb</span>
<span class="n">zoo</span><span class="o">::</span><span class="nf">na.locf</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>  <span class="c1">## zoo           53.518s</span>
<span class="nf">setDTthreads</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>
<span class="nf">nafill</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="s">&quot;locf&quot;</span><span class="p">)</span>             <span class="c1">## DT 1 thread    7.562s</span>
<span class="nf">setDTthreads</span><span class="p">(</span><span class="m">0L</span><span class="p">)</span>
<span class="nf">nafill</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="s">&quot;locf&quot;</span><span class="p">)</span>             <span class="c1">## DT 40 threads  0.605s</span>
<span class="nf">setnafill</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="s">&quot;locf&quot;</span><span class="p">)</span>          <span class="c1">## DT in-place    0.367s</span>
</pre></div>
</div>
</li>
<li><p>New variable <code class="docutils literal notranslate"><span class="pre">.Last.updated</span></code> (similar to R’s <code class="docutils literal notranslate"><span class="pre">.Last.value</span></code>) contains the number of rows affected by the most recent <code class="docutils literal notranslate"><span class="pre">:=</span></code> or <code class="docutils literal notranslate"><span class="pre">set()</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1885">#1885</a>. For details see <code class="docutils literal notranslate"><span class="pre">?.Last.updated</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">between()</span></code> and <code class="docutils literal notranslate"><span class="pre">%between%</span></code> are faster for <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3519">#3519</a>, and now support the <code class="docutils literal notranslate"><span class="pre">.()</span></code> alias, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2315">#2315</a>. Thanks to &#64;Henrik-P for the reports. There is now also support for <code class="docutils literal notranslate"><span class="pre">bit64</span></code>’s <code class="docutils literal notranslate"><span class="pre">integer64</span></code> class and more robust coercion of types, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3517">#3517</a>. <code class="docutils literal notranslate"><span class="pre">between()</span></code> gains <code class="docutils literal notranslate"><span class="pre">check=</span></code> which checks <code class="docutils literal notranslate"><span class="pre">any(lower&gt;upper)</span></code>; off by default for speed in particular for type character.</p></li>
<li><p>New convenience functions <code class="docutils literal notranslate"><span class="pre">%ilike%</span></code> and <code class="docutils literal notranslate"><span class="pre">%flike%</span></code> which map to new <code class="docutils literal notranslate"><span class="pre">like()</span></code> arguments <code class="docutils literal notranslate"><span class="pre">ignore.case</span></code> and <code class="docutils literal notranslate"><span class="pre">fixed</span></code> respectively, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3333">#3333</a>. <code class="docutils literal notranslate"><span class="pre">%ilike%</span></code> is for case-insensitive pattern matching. <code class="docutils literal notranslate"><span class="pre">%flike%</span></code> is for more efficient matching of fixed strings. Thanks to &#64;andreasLD for providing most of the core code.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on=.NATURAL</span></code> (or alternatively <code class="docutils literal notranslate"><span class="pre">X[on=Y]</span></code> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3621">#3621</a>) joins two tables on their common column names, so called <em>natural join</em>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/629">#629</a>. Thanks to David Kulp for request. As before, when <code class="docutils literal notranslate"><span class="pre">on=</span></code> is not provided, <code class="docutils literal notranslate"><span class="pre">X</span></code> must have a key and the key columns are used to join (like rownames, but multi-column and multi-type).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.table</span></code> gains <code class="docutils literal notranslate"><span class="pre">key</span></code> argument mirroring its use in <code class="docutils literal notranslate"><span class="pre">setDT</span></code> and <code class="docutils literal notranslate"><span class="pre">data.table</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/890">#890</a>. As a byproduct, the arguments of <code class="docutils literal notranslate"><span class="pre">as.data.table.array</span></code> have changed order, which could affect code relying on positional arguments to this method. Thanks &#64;cooldome for the suggestion and &#64;MichaelChirico for implementation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">merge.data.table</span></code> is now exported, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2618">#2618</a>. We realize that S3 methods should not ordinarily be exported. Rather, the method should be invoked via S3 dispatch. But users continue to request its export, perhaps because of intricacies relating to the fact that data.table inherits from data.frame, there are two arguments to <code class="docutils literal notranslate"><span class="pre">merge()</span></code> but S3 dispatch applies just to the first, and a desire to explicitly call <code class="docutils literal notranslate"><span class="pre">data.table::merge.data.table</span></code> from package code. Thanks to &#64;AndreMikulec for the most recent request.</p></li>
<li><p>New rolling function to calculate rolling sum has been implemented and exported, see <code class="docutils literal notranslate"><span class="pre">?frollsum</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2778">#2778</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setkey</span></code> to an existing index now uses the index, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2889">#2889</a>. Thanks to &#64;MichaelChirico for suggesting and &#64;saraswatmks for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[order(col)[1:5],</span> <span class="pre">...]</span></code> (i.e. where <code class="docutils literal notranslate"><span class="pre">i</span></code> is a compound expression involving <code class="docutils literal notranslate"><span class="pre">order()</span></code>) is now optimized to use <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s multithreaded <code class="docutils literal notranslate"><span class="pre">forder</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1921">#1921</a>. This example is not a fully optimal top-N query since the full ordering is still computed. The improvement is that the call to <code class="docutils literal notranslate"><span class="pre">order()</span></code> is computed faster for any <code class="docutils literal notranslate"><span class="pre">i</span></code> expression using <code class="docutils literal notranslate"><span class="pre">order</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.table</span></code> now unpacks columns in a <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> which are themselves a <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> or <code class="docutils literal notranslate"><span class="pre">matrix</span></code>. This need arises when parsing JSON, a corollary in <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3369#issuecomment-462662752">#3369</a>. Bug fix 19 in v1.12.2 (see below) added a helpful error (rather than segfault) to detect such invalid <code class="docutils literal notranslate"><span class="pre">data.table</span></code>, and promised that <code class="docutils literal notranslate"><span class="pre">as.data.table()</span></code> would unpack these columns in the next release (i.e. this release) so that the invalid <code class="docutils literal notranslate"><span class="pre">data.table</span></code> is not created in the first place. Further, <code class="docutils literal notranslate"><span class="pre">setDT</span></code> now warns if it observes such columns and suggests using <code class="docutils literal notranslate"><span class="pre">as.data.table</span></code> instead, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3760">#3760</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CJ</span></code> has been ported to C and parallelized, thanks to a PR by Michael Chirico, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3596">#3596</a>. All types benefit, but, as in many <code class="docutils literal notranslate"><span class="pre">data.table</span></code> operations, factors benefit more than character.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># default 4 threads on a laptop with 16GB RAM and 8 logical CPU</span>

<span class="n">ids</span> <span class="o">=</span> <span class="nf">as.vector</span><span class="p">(</span><span class="nf">outer</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">,</span> <span class="kc">LETTERS</span><span class="p">,</span> <span class="n">paste0</span><span class="p">))</span>
<span class="nf">system.time</span><span class="p">(</span> <span class="nf">CJ</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">500000</span><span class="p">)</span> <span class="p">)</span>  <span class="c1"># 3.9GB; 340m rows</span>
<span class="c1">#   user  system elapsed (seconds)</span>
<span class="c1">#  3.000   0.817   3.798  # was</span>
<span class="c1">#  1.800   0.832   2.190  # now</span>

<span class="c1"># ids = as.factor(ids)</span>
<span class="nf">system.time</span><span class="p">(</span> <span class="nf">CJ</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">500000</span><span class="p">)</span> <span class="p">)</span>  <span class="c1"># 2.6GB; 340m rows</span>
<span class="c1">#   user  system elapsed (seconds)</span>
<span class="c1">#  1.779   0.534   2.293  # was</span>
<span class="c1">#  0.357   0.763   0.292  # now</span>
</pre></div>
</div>
</li>
<li><p>New function <code class="docutils literal notranslate"><span class="pre">fcoalesce(...)</span></code> has been written in C, and is multithreaded for <code class="docutils literal notranslate"><span class="pre">numeric</span></code> and <code class="docutils literal notranslate"><span class="pre">factor</span></code>. It replaces missing values according to a prioritized list of candidates (as per SQL COALESCE, <code class="docutils literal notranslate"><span class="pre">dplyr::coalesce</span></code>, and <code class="docutils literal notranslate"><span class="pre">hutils::coalesce</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3424">#3424</a>. It accepts any number of vectors in several forms. For example, given three vectors <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code>, where each <code class="docutils literal notranslate"><span class="pre">NA</span></code> in <code class="docutils literal notranslate"><span class="pre">x</span></code> is to be replaced by the corresponding value in <code class="docutils literal notranslate"><span class="pre">y</span></code> if that is non-NA, else the corresponding value in <code class="docutils literal notranslate"><span class="pre">z</span></code>, the following equivalent forms are all accepted: <code class="docutils literal notranslate"><span class="pre">fcoalesce(x,y,z)</span></code>, <code class="docutils literal notranslate"><span class="pre">fcoalesce(x,list(y,z))</span></code>, and <code class="docutils literal notranslate"><span class="pre">fcoalesce(list(x,y,z))</span></code>. Being a new function, its behaviour is subject to change particularly for type <code class="docutils literal notranslate"><span class="pre">list</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3712">#3712</a>.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># default 4 threads on a laptop with 16GB RAM and 8 logical CPU</span>
<span class="n">N</span> <span class="o">=</span> <span class="m">100e6</span>
<span class="n">x</span> <span class="o">=</span> <span class="nf">replicate</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="p">{</span><span class="n">x</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="n">N</span><span class="p">);</span> <span class="n">x</span><span class="p">[</span><span class="nf">sample</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="o">/</span><span class="m">2</span><span class="p">)]</span><span class="o">=</span><span class="kc">NA</span><span class="p">;</span> <span class="n">x</span><span class="p">},</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>  <span class="c1"># 2GB</span>
<span class="n">y1</span> <span class="o">=</span> <span class="nf">do.call</span><span class="p">(</span><span class="n">dplyr</span><span class="o">::</span><span class="n">coalesce</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">y2</span> <span class="o">=</span> <span class="nf">do.call</span><span class="p">(</span><span class="n">hutils</span><span class="o">::</span><span class="n">coalesce</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">y3</span> <span class="o">=</span> <span class="nf">do.call</span><span class="p">(</span><span class="n">data.table</span><span class="o">::</span><span class="n">fcoalesce</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="c1">#   user  system elapsed (seconds)</span>
<span class="c1">#  4.935   1.876   6.810  # dplyr::coalesce</span>
<span class="c1">#  3.122   0.831   3.956  # hutils::coalesce</span>
<span class="c1">#  0.915   0.099   0.379  # data.table::fcoalesce</span>
<span class="nf">identical</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nf">identical</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="n">y3</span><span class="p">)</span>
<span class="c1"># TRUE</span>
</pre></div>
</div>
</li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">complex</span></code> is now supported by <code class="docutils literal notranslate"><span class="pre">setkey</span></code>, <code class="docutils literal notranslate"><span class="pre">setorder</span></code>, <code class="docutils literal notranslate"><span class="pre">:=</span></code>, <code class="docutils literal notranslate"><span class="pre">by=</span></code>, <code class="docutils literal notranslate"><span class="pre">keyby=</span></code>, <code class="docutils literal notranslate"><span class="pre">shift</span></code>, <code class="docutils literal notranslate"><span class="pre">dcast</span></code>, <code class="docutils literal notranslate"><span class="pre">frank</span></code>, <code class="docutils literal notranslate"><span class="pre">rowid</span></code>, <code class="docutils literal notranslate"><span class="pre">rleid</span></code>, <code class="docutils literal notranslate"><span class="pre">CJ</span></code>, <code class="docutils literal notranslate"><span class="pre">fcoalesce</span></code>, <code class="docutils literal notranslate"><span class="pre">unique</span></code>, and <code class="docutils literal notranslate"><span class="pre">uniqueN</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3690">#3690</a>. Thanks to Gareth Ward and Elio Campitelli for their reports and input. Sorting <code class="docutils literal notranslate"><span class="pre">complex</span></code> is achieved the same way as base R; i.e., first by the real part then by the imaginary part (as if the <code class="docutils literal notranslate"><span class="pre">complex</span></code> column were two separate columns of <code class="docutils literal notranslate"><span class="pre">double</span></code>). There is no plan to support joining/merging on <code class="docutils literal notranslate"><span class="pre">complex</span></code> columns until a user demonstrates a need for that.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setkey</span></code>, <code class="docutils literal notranslate"><span class="pre">[key]by=</span></code> and <code class="docutils literal notranslate"><span class="pre">on=</span></code> in verbose mode (<code class="docutils literal notranslate"><span class="pre">options(datatable.verbose=TRUE)</span></code>) now detect any columns inheriting from <code class="docutils literal notranslate"><span class="pre">Date</span></code> which are stored as 8 byte double, test if any fractions are present, and if not suggest using a 4 byte integer instead (such as <code class="docutils literal notranslate"><span class="pre">data.table::IDate</span></code>) to save space and time, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1738">#1738</a>. In future this could be upgraded to <code class="docutils literal notranslate"><span class="pre">message</span></code> or <code class="docutils literal notranslate"><span class="pre">warning</span></code> depending on feedback.</p></li>
<li><p>New function <code class="docutils literal notranslate"><span class="pre">fifelse(test,</span> <span class="pre">yes,</span> <span class="pre">no,</span> <span class="pre">na)</span></code> has been implemented in C by Morgan Jacob, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3657">#3657</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3753">#3753</a>. It is comparable to <code class="docutils literal notranslate"><span class="pre">base::ifelse</span></code>, <code class="docutils literal notranslate"><span class="pre">dplyr::if_else</span></code>, <code class="docutils literal notranslate"><span class="pre">hutils::if_else</span></code>, and (forthcoming) <a class="reference external" href="https://vctrs.r-lib.org/articles/stability.html#ifelse"><code class="docutils literal notranslate"><span class="pre">vctrs::if_else()</span></code></a>. It returns a vector of the same length as <code class="docutils literal notranslate"><span class="pre">test</span></code> but unlike <code class="docutils literal notranslate"><span class="pre">base::ifelse</span></code> the output type is consistent with those of <code class="docutils literal notranslate"><span class="pre">yes</span></code> and <code class="docutils literal notranslate"><span class="pre">no</span></code>. Please see <code class="docutils literal notranslate"><span class="pre">?data.table::fifelse</span></code> for more details.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># default 4 threads on a laptop with 16GB RAM and 8 logical CPU</span>
<span class="n">x</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">),</span> <span class="m">3e8</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>  <span class="c1"># 1GB</span>
<span class="n">microbenchmark</span><span class="o">::</span><span class="nf">microbenchmark</span><span class="p">(</span>
  <span class="n">base</span><span class="o">::</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">7L</span><span class="p">,</span> <span class="m">11L</span><span class="p">),</span>
  <span class="n">dplyr</span><span class="o">::</span><span class="nf">if_else</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">7L</span><span class="p">,</span> <span class="m">11L</span><span class="p">),</span>
  <span class="n">hutils</span><span class="o">::</span><span class="nf">if_else</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">7L</span><span class="p">,</span> <span class="m">11L</span><span class="p">),</span>
  <span class="n">data.table</span><span class="o">::</span><span class="nf">fifelse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">7L</span><span class="p">,</span> <span class="m">11L</span><span class="p">),</span>
  <span class="n">times</span> <span class="o">=</span> <span class="m">5L</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&quot;s&quot;</span>
<span class="p">)</span>
<span class="c1"># Unit: seconds</span>
<span class="c1">#                            expr  min  med  max neval</span>
<span class="c1">#        base::ifelse(x, 7L, 11L)  8.5  8.6  8.8     5</span>
<span class="c1">#      dplyr::if_else(x, 7L, 11L)  9.4  9.5  9.7     5</span>
<span class="c1">#     hutils::if_else(x, 7L, 11L)  2.6  2.6  2.7     5</span>
<span class="c1"># data.table::fifelse(x, 7L, 11L)  1.5  1.5  1.6     5  # setDTthreads(1)</span>
<span class="c1"># data.table::fifelse(x, 7L, 11L)  0.8  0.8  0.9     5  # setDTthreads(2)</span>
<span class="c1"># data.table::fifelse(x, 7L, 11L)  0.4  0.4  0.5     5  # setDTthreads(4)</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">transpose</span></code> gains <code class="docutils literal notranslate"><span class="pre">keep.names=</span></code> and <code class="docutils literal notranslate"><span class="pre">make.names=</span></code> arguments, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1886">#1886</a>. Previously, column names were dropped and there was no way to keep them. <code class="docutils literal notranslate"><span class="pre">keep.names=&quot;rn&quot;</span></code> keeps the column names and puts them in the <code class="docutils literal notranslate"><span class="pre">&quot;rn&quot;</span></code> column of the result. Similarly, <code class="docutils literal notranslate"><span class="pre">make.names=&quot;rn&quot;</span></code> uses column <code class="docutils literal notranslate"><span class="pre">&quot;rn&quot;</span></code> as the column names of the result. Both arguments are <code class="docutils literal notranslate"><span class="pre">NULL</span></code> by default for backwards compatibility. As these new arguments are new, they are subject to change in future according to community feedback. Thanks to &#64;ghost for the request.</p></li>
<li><p>Added a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> method for <code class="docutils literal notranslate"><span class="pre">utils::edit</span></code> to ensure a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> is returned, for convenience, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/593">#593</a>.</p></li>
<li><p>More efficient optimization of many columns in <code class="docutils literal notranslate"><span class="pre">j</span></code> (e.g. from <code class="docutils literal notranslate"><span class="pre">.SD</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1470">#1470</a>. Thanks &#64;Jorges1000 for the report.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setnames(DT,</span> <span class="pre">old,</span> <span class="pre">new)</span></code> now omits any <code class="docutils literal notranslate"><span class="pre">old==new</span></code> to save redundant key and index name updates, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3783">#3783</a>. <code class="docutils literal notranslate"><span class="pre">setnames(DT,</span> <span class="pre">new)</span></code> (i.e. not providing <code class="docutils literal notranslate"><span class="pre">old</span></code>) already omitted any column name updates where <code class="docutils literal notranslate"><span class="pre">names(DT)==new</span></code>; e.g. <code class="docutils literal notranslate"><span class="pre">setnames(DT,</span> <span class="pre">gsub('^_',</span> <span class="pre">'',</span> <span class="pre">names(DT)))</span></code> exits early if no columns start with <code class="docutils literal notranslate"><span class="pre">_</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[[</span></code> by group is now optimized for regular vectors (not type list), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3209">#3209</a>. Thanks &#64;renkun-ken for the suggestion. <code class="docutils literal notranslate"><span class="pre">[</span></code> by group was already optimized. Please file a feature request if you would like this optimization for list columns.</p></li>
<li><p>New function <code class="docutils literal notranslate"><span class="pre">frollapply</span></code> for rolling computation of arbitrary R functions (caveat: input <code class="docutils literal notranslate"><span class="pre">x</span></code> is coerced to numeric beforehand, and the function must return a scalar numeric value). The API is consistent to extant rolling functions <code class="docutils literal notranslate"><span class="pre">frollmean</span></code> and <code class="docutils literal notranslate"><span class="pre">frollsum</span></code>; note that it will generally be slower than those functions because (1) the known functions use our optimized internal C implementation and (2) there is no thread-safe API to R’s C <code class="docutils literal notranslate"><span class="pre">eval</span></code>. Nevertheless <code class="docutils literal notranslate"><span class="pre">frollapply</span></code> is faster than corresponding <code class="docutils literal notranslate"><span class="pre">base</span></code>-only and <code class="docutils literal notranslate"><span class="pre">zoo</span></code> versions:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">108</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="nf">rnorm</span><span class="p">(</span><span class="m">1e6</span><span class="p">);</span> <span class="n">n</span> <span class="o">=</span> <span class="m">1e3</span>
<span class="n">base_rollapply</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">FUN</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">nx</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">ans</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="kc">NA_real_</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
  <span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="n">n</span><span class="o">:</span><span class="n">nx</span><span class="p">)</span> <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">FUN</span><span class="p">(</span><span class="n">x</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="n">n</span><span class="m">+1</span><span class="p">)</span><span class="o">:</span><span class="n">i</span><span class="p">])</span>
  <span class="n">ans</span>
<span class="p">}</span>
<span class="nf">system.time</span><span class="p">(</span><span class="nf">base_rollapply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">mean</span><span class="p">))</span>
<span class="nf">system.time</span><span class="p">(</span><span class="n">zoo</span><span class="o">::</span><span class="nf">rollapplyr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="kc">NA</span><span class="p">))</span>
<span class="nf">system.time</span><span class="p">(</span><span class="n">zoo</span><span class="o">::</span><span class="nf">rollmeanr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">NA</span><span class="p">))</span>
<span class="nf">system.time</span><span class="p">(</span><span class="nf">frollapply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">mean</span><span class="p">))</span>
<span class="nf">system.time</span><span class="p">(</span><span class="nf">frollmean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

<span class="c1">### fun             mean     sum  median</span>
<span class="c1"># base_rollapply   8.815   5.151  60.175</span>
<span class="c1"># zoo::rollapply  34.373  27.837  88.552</span>
<span class="c1"># zoo::roll[fun]   0.215   0.185      NA   ## median not fully supported</span>
<span class="c1"># frollapply       5.404   1.419  56.475</span>
<span class="c1"># froll[fun]       0.003   0.002      NA   ## median not yet supported</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">setnames()</span></code> now accepts functions in <code class="docutils literal notranslate"><span class="pre">old=</span></code> and <code class="docutils literal notranslate"><span class="pre">new=</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3703">#3703</a>. Thanks &#64;smingerson for the feature request and &#64;shrektan for the PR.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span> <span class="o">=</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="m">7</span><span class="o">:</span><span class="m">9</span><span class="p">)</span>
<span class="nf">setnames</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">toupper</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
<span class="c1"># [1] &quot;A&quot; &quot;B&quot; &quot;C&quot;</span>
<span class="nf">setnames</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">),</span> <span class="n">tolower</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
<span class="c1"># [1] &quot;a&quot; &quot;B&quot; &quot;c&quot;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">:=</span></code> and <code class="docutils literal notranslate"><span class="pre">set()</span></code> now use zero-copy type coercion. Accordingly, <code class="docutils literal notranslate"><span class="pre">DT[...,</span> <span class="pre">integerColumn:=0]</span></code> and <code class="docutils literal notranslate"><span class="pre">set(DT,i,j,0)</span></code> no longer warn about the <code class="docutils literal notranslate"><span class="pre">0</span></code> (‘numeric’) needing to be <code class="docutils literal notranslate"><span class="pre">0L</span></code> (‘integer’) because there is no longer any time or space used for this coercion. The old long warning was off-putting to new users (“what and why L?”), whereas advanced users appreciated the old warning so they could avoid the coercion. Although the time and space for one coercion in a single call is unmeasurably small, when placed in a loop the small overhead of any allocation on R’s heap could start to become noticeable (more so for <code class="docutils literal notranslate"><span class="pre">set()</span></code> whose purpose is low-overhead looping). Further, when assigning a value across columns of varying types, it could be inconvenient to supply the correct type for every column. Hence, zero-copy coercion was introduced to satisfy all these requirements. A warning is still issued, as before, when fractional data is discarded; e.g. when 3.14 is assigned to an integer column. Zero-copy coercion applies to length&gt;1 vectors as well as length-1 vectors.</p></li>
</ol>
</div>
<div class="section" id="id17">
<h2>BUG FIXES<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">first</span></code>, <code class="docutils literal notranslate"><span class="pre">last</span></code>, <code class="docutils literal notranslate"><span class="pre">head</span></code> and <code class="docutils literal notranslate"><span class="pre">tail</span></code> by group no longer error in some cases, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2030">#2030</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3462">#3462</a>. Thanks to &#64;franknarf1 for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyby=colName</span></code> could use the wrong index and return incorrect results if both <code class="docutils literal notranslate"><span class="pre">colName</span></code> and <code class="docutils literal notranslate"><span class="pre">colNameExtra</span></code> (where <code class="docutils literal notranslate"><span class="pre">colName</span></code> is a leading subset of characters of <code class="docutils literal notranslate"><span class="pre">colNameExtra</span></code>) are column names and an index exists on <code class="docutils literal notranslate"><span class="pre">colNameExtra</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3498">#3498</a>. Thanks to Xianying Tan for the detailed report and pinpointing the source line at fault.</p></li>
<li><p>A missing item in <code class="docutils literal notranslate"><span class="pre">j</span></code> such as <code class="docutils literal notranslate"><span class="pre">j=.(colA,</span> <span class="pre">)</span></code> now gives a helpful error (<code class="docutils literal notranslate"><span class="pre">Item</span> <span class="pre">2</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">.()</span> <span class="pre">or</span> <span class="pre">list()</span> <span class="pre">passed</span> <span class="pre">to</span> <span class="pre">j</span> <span class="pre">is</span> <span class="pre">missing</span></code>) rather than the unhelpful error <code class="docutils literal notranslate"><span class="pre">argument</span> <span class="pre">&quot;this_jsub&quot;</span> <span class="pre">is</span> <span class="pre">missing,</span> <span class="pre">with</span> <span class="pre">no</span> <span class="pre">default</span></code> (v1.12.2) or <code class="docutils literal notranslate"><span class="pre">argument</span> <span class="pre">2</span> <span class="pre">is</span> <span class="pre">empty</span></code> (v1.12.0 and before), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3507">#3507</a>. Thanks to &#64;eddelbuettel for the report.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> could crash when writing very long strings such as 30 million characters, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2974">#2974</a>, and could be unstable in memory constrained environments, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2612">#2612</a>. Thanks to &#64;logworthy and &#64;zachokeeffe for reporting and Philippe Chataignon for fixing in PR <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3288">#3288</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> could crash if <code class="docutils literal notranslate"><span class="pre">quote=&quot;&quot;</span></code> (i.e. ignore quotes), the last line is too short, and <code class="docutils literal notranslate"><span class="pre">fill=TRUE</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3524">#3524</a>. Thanks to Jiucang Hao for the report and reproducible example.</p></li>
<li><p>Printing could occur unexpectedly when code is run with <code class="docutils literal notranslate"><span class="pre">source</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2369">#2369</a>. Thanks to &#64;jan-glx for the report and reproducible example.</p></li>
<li><p>Grouping by <code class="docutils literal notranslate"><span class="pre">NULL</span></code> on zero rows <code class="docutils literal notranslate"><span class="pre">data.table</span></code> now behaves consistently to non-zero rows <code class="docutils literal notranslate"><span class="pre">data.table</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3530">#3530</a>. Thanks to &#64;SymbolixAU for the report and reproducible example.</p></li>
<li><p>GForce optimization of <code class="docutils literal notranslate"><span class="pre">median</span></code> did not retain the class; e.g. <code class="docutils literal notranslate"><span class="pre">median</span></code> of <code class="docutils literal notranslate"><span class="pre">Date</span></code> or <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> would return a raw number rather than retain the date class, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3079">#3079</a>. Thanks to &#64;Henrik-P for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">format(mean(date,&quot;&quot;%b-%Y&quot;)),</span> <span class="pre">by=group]</span></code> could fail with <code class="docutils literal notranslate"><span class="pre">invalid</span> <span class="pre">'trim'</span> <span class="pre">argument</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1876">#1876</a>. Thanks to Ross Holmberg for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">externalVar=1:5;</span> <span class="pre">DT[,</span> <span class="pre">mean(externalVar),</span> <span class="pre">by=group]</span></code> could return incorrect results rather than a constant (<code class="docutils literal notranslate"><span class="pre">3</span></code> in this example) for each group, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/875">#875</a>. GForce optimization was being applied incorrectly to the <code class="docutils literal notranslate"><span class="pre">mean</span></code> without realizing <code class="docutils literal notranslate"><span class="pre">externalVar</span></code> was not a column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test.data.table()</span></code> now passes in non-English R sessions, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/630">#630</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3039">#3039</a>. Each test still checks that the number of warnings and/or errors produced is correct. However, a message is displayed suggesting to restart R with <code class="docutils literal notranslate"><span class="pre">LANGUAGE=en</span></code> in order to test that the text of the warning and/or error messages are as expected, too.</p></li>
<li><p>Joining a double column in <code class="docutils literal notranslate"><span class="pre">i</span></code> containing say 1.3, with an integer column in <code class="docutils literal notranslate"><span class="pre">x</span></code> containing say 1, would result in the 1.3 matching to 1, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2592">#2592</a>, and joining a factor column to an integer column would match the factor’s integers rather than error. The type coercion logic has been revised and strengthened. Many thanks to &#64;MarkusBonsch for reporting and fixing. Joining a character column in <code class="docutils literal notranslate"><span class="pre">i</span></code> to a factor column in <code class="docutils literal notranslate"><span class="pre">x</span></code> is now faster and retains the character column in the result rather than coercing it to factor. Joining an integer column in <code class="docutils literal notranslate"><span class="pre">i</span></code> to a double column in <code class="docutils literal notranslate"><span class="pre">x</span></code> now retains the integer type in the result rather than coercing the integers into the double type. Logical columns may now only be joined to logical columns, other than all-NA columns which are coerced to the matching column’s type. All coercions are reported in verbose mode: <code class="docutils literal notranslate"><span class="pre">options(datatable.verbose=TRUE)</span></code>.</p></li>
<li><p>Attempting to recycle 2 or more items into an existing <code class="docutils literal notranslate"><span class="pre">list</span></code> column now gives the intended helpful error rather than <code class="docutils literal notranslate"><span class="pre">Internal</span> <span class="pre">error:</span> <span class="pre">recycle</span> <span class="pre">length</span> <span class="pre">error</span> <span class="pre">not</span> <span class="pre">caught</span> <span class="pre">earlier.</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3543">#3543</a>. Thanks to &#64;MichaelChirico for finding and reporting.</p></li>
<li><p>Subassigning using <code class="docutils literal notranslate"><span class="pre">$&lt;-</span></code> to a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> embedded in a list column of a single-row <code class="docutils literal notranslate"><span class="pre">data.table</span></code> could fail, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3474">#3474</a>. Note that <code class="docutils literal notranslate"><span class="pre">$&lt;-</span></code> is not recommended; please use <code class="docutils literal notranslate"><span class="pre">:=</span></code> instead which already worked in this case. Thanks to Jakob Richter for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbind</span></code> and <code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> of zero-row items now retain (again) the unused levels of any (zero-length) factor columns, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3508">#3508</a>. This was a regression in v1.12.2 just for zero-row items. Unused factor levels were already retained for items having <code class="docutils literal notranslate"><span class="pre">nrow&gt;=1</span></code>. Thanks to Gregory Demin for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbind</span></code> and <code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> of an item containing an ordered factor with levels containing an <code class="docutils literal notranslate"><span class="pre">NA</span></code> (as opposed to an NA integer) could segfault, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3601">#3601</a>. This was a a regression in v1.12.2. Thanks to Damian Betebenner for reporting. Also a related segfault when recycling a length-1 factor column, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3662">#3662</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example(&quot;:=&quot;,</span> <span class="pre">local=TRUE)</span></code> now works rather than error, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2972">#2972</a>. Thanks &#64;vlulla for the report.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbind.data.frame</span></code> on <code class="docutils literal notranslate"><span class="pre">IDate</span></code> columns changed the column from <code class="docutils literal notranslate"><span class="pre">integer</span></code> to <code class="docutils literal notranslate"><span class="pre">double</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2008">#2008</a>. Thanks to &#64;rmcgehee for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">merge.data.table</span></code> now retains any custom classes of the first argument, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1378">#1378</a>. Thanks to &#64;michaelquinn32 for reopening.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">seq</span></code> and <code class="docutils literal notranslate"><span class="pre">mean</span></code> of <code class="docutils literal notranslate"><span class="pre">ITime</span></code> objects now retain the <code class="docutils literal notranslate"><span class="pre">ITime</span></code> class via new <code class="docutils literal notranslate"><span class="pre">ITime</span></code> methods, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3628">#3628</a>. Thanks &#64;UweBlock for reporting. The <code class="docutils literal notranslate"><span class="pre">cut</span></code> and <code class="docutils literal notranslate"><span class="pre">split</span></code> methods for <code class="docutils literal notranslate"><span class="pre">ITime</span></code> have been removed since the default methods work, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3630">#3630</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.table.array</span></code> now handles the case when some of the array’s dimension names are <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3636">#3636</a>.</p></li>
<li><p>Adding a <code class="docutils literal notranslate"><span class="pre">list</span></code> column using <code class="docutils literal notranslate"><span class="pre">cbind</span></code>, <code class="docutils literal notranslate"><span class="pre">as.data.table</span></code>, or <code class="docutils literal notranslate"><span class="pre">data.table</span></code> now works rather than treating the <code class="docutils literal notranslate"><span class="pre">list</span></code> as if it were a set of columns and introducing an invalid NA column name, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3471">#3471</a>. However, please note that using <code class="docutils literal notranslate"><span class="pre">:=</span></code> to add columns is preferred.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">cbind</span><span class="p">(</span> <span class="nf">data.table</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">),</span> <span class="nf">list</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="s">&quot;b&quot;</span><span class="p">),</span><span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="p">)</span>
<span class="c1">#       V1     V2     NA   # v1.12.2 and before</span>
<span class="c1">#    &lt;int&gt; &lt;char&gt; &lt;char&gt;</span>
<span class="c1"># 1:     1      a      a</span>
<span class="c1"># 2:     2      b      a</span>
<span class="c1">#</span>
<span class="c1">#       V1     V2          # v1.12.4+</span>
<span class="c1">#    &lt;int&gt; &lt;list&gt;</span>
<span class="c1"># 1:     1    a,b</span>
<span class="c1"># 2:     2      a</span>
</pre></div>
</div>
</li>
<li><p>Incorrect sorting/grouping results due to a bug in Intel’s <code class="docutils literal notranslate"><span class="pre">icc</span></code> compiler 2019 (Version 19.0.4.243 Build 20190416) has been worked around thanks to a report and fix by Sebastian Freundt, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3647">#3647</a>. Please run <code class="docutils literal notranslate"><span class="pre">data.table::test.data.table()</span></code>. If that passes, your installation does not have the problem.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">column</span> <span class="pre">not</span> <span class="pre">found</span></code> could incorrectly occur in rare non-equi-join cases, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3635">#3635</a>. Thanks to &#64;UweBlock for the report.</p></li>
<li><p>Slight fix to the logic for auto-naming the <code class="docutils literal notranslate"><span class="pre">by</span></code> clause for using a custom function like <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> to now be named <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> instead of the name of the first symbolic argument, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3758">#3758</a>.</p></li>
<li><p>Column binding of zero column <code class="docutils literal notranslate"><span class="pre">data.table</span></code> will now work as expected, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3334">#3334</a>. Thanks to &#64;kzenstratus for the report.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">integer64</span></code> sum-by-group is now properly optimized, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1647">#1647</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3464">#3464</a>. Thanks to &#64;mlandry22-h2o for the report.</p></li>
<li><p>From v1.12.0 <code class="docutils literal notranslate"><span class="pre">between()</span></code> and <code class="docutils literal notranslate"><span class="pre">%between%</span></code> interpret missing values in <code class="docutils literal notranslate"><span class="pre">lower=</span></code> or <code class="docutils literal notranslate"><span class="pre">upper=</span></code> as unlimited bounds. A new parameter <code class="docutils literal notranslate"><span class="pre">NAbounds</span></code> has been added to achieve the old behaviour of returning <code class="docutils literal notranslate"><span class="pre">NA</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3522">#3522</a>. Thanks &#64;cguill95 for reporting. This is now consistent for character input, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3667">#3667</a> (thanks &#64;AnonymousBoba), and class <code class="docutils literal notranslate"><span class="pre">nanotime</span></code> is now supported too.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">integer64</span></code> defined on a subset of a new column would leave “gibberish” on the remaining rows, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3723">#3723</a>. A bug in <code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> with the same root cause was also fixed, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1459">#1459</a>. Thanks &#64;shrektan and &#64;jangorecki for the reports.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groupingsets</span></code> functions now properly handle alone special symbols when using an empty set to group by, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3653">#3653</a>. Thanks to &#64;Henrik-P for the report.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">data.table</span></code> created using <code class="docutils literal notranslate"><span class="pre">setDT()</span></code> on a <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> containing identical columns referencing each other would cause <code class="docutils literal notranslate"><span class="pre">setkey()</span></code> to return incorrect results, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3496">#3496</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3766">#3766</a>. Thanks &#64;kirillmayantsev and &#64;alex46015 for reporting, and &#64;jaapwalhout and &#64;Atrebas for helping to debug and isolate the issue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x[,</span> <span class="pre">round(.SD,</span> <span class="pre">1)]</span></code> and similar operations on the whole of <code class="docutils literal notranslate"><span class="pre">.SD</span></code> could return a locked result, incorrectly preventing <code class="docutils literal notranslate"><span class="pre">:=</span></code> on the result, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2245">#2245</a>. Thanks &#64;grayskripko for raising.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">get</span></code>/<code class="docutils literal notranslate"><span class="pre">mget</span></code> in <code class="docutils literal notranslate"><span class="pre">j</span></code> could cause <code class="docutils literal notranslate"><span class="pre">.SDcols</span></code> to be ignored or reordered, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1744">#1744</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1965">#1965</a>, and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2036">#2036</a>. Thanks &#64;franknarf1, &#64;MichaelChirico, and &#64;TonyBonen, for the reports.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">i-1L,</span> <span class="pre">with=FALSE]</span></code> would misinterpret the minus sign and return an incorrect result, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2109">#2019</a>. Thanks &#64;cguill95 for the report.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[id==1,</span> <span class="pre">DT2[.SD,</span> <span class="pre">on=&quot;id&quot;]]</span></code> (i.e. joining from <code class="docutils literal notranslate"><span class="pre">.SD</span></code> in <code class="docutils literal notranslate"><span class="pre">j</span></code>) could incorrectly fail in some cases due to <code class="docutils literal notranslate"><span class="pre">.SD</span></code> being locked, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1926">#1926</a>, and when updating-on-join with factors <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3559">#3559</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2099">#2099</a>. Thanks &#64;franknarf1 and &#64;Henrik-P for the reports and for diligently tracking use cases for almost 3 years!</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.IDate.POSIXct</span></code> returned <code class="docutils literal notranslate"><span class="pre">NA</span></code> for UTC times before Dec 1901 and after Jan 2038, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3780">#3780</a>. Thanks &#64;gschett for the report.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> now returns correct idcols for lists with different length vectors, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3785">#3785</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3786">#3786</a>. Thanks to &#64;shrektan for the report and fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[</span> <span class="pre">,</span> <span class="pre">!rep(FALSE,</span> <span class="pre">ncol(DT)),</span> <span class="pre">with=FALSE]</span></code> correctly returns the full table, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3013">#3013</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2917">#2917</a>. Thanks &#64;alexnss and &#64;DavidArenburg for the reports.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shift(x,</span> <span class="pre">0:1,</span> <span class="pre">type='lead',</span> <span class="pre">give.names=TRUE)</span></code> uses <code class="docutils literal notranslate"><span class="pre">lead</span></code> in all returned column names, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3832">#3832</a>. Thanks &#64;daynefiler for the report.</p></li>
<li><p>Subtracting two <code class="docutils literal notranslate"><span class="pre">POSIXt</span></code> objects by group could lead to incorrect results because the <code class="docutils literal notranslate"><span class="pre">base</span></code> method internally calls <code class="docutils literal notranslate"><span class="pre">difftime</span></code> with <code class="docutils literal notranslate"><span class="pre">units='auto'</span></code>; <code class="docutils literal notranslate"><span class="pre">data.table</span></code> does not notice if the chosen units differ by group and only the last group’s <code class="docutils literal notranslate"><span class="pre">units</span></code> attribute was retained, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3694">#3694</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/761">#761</a>. To surmount this, we now internally force <code class="docutils literal notranslate"><span class="pre">units='secs'</span></code> on all <code class="docutils literal notranslate"><span class="pre">POSIXt-POSIXt</span></code> calls (reported when <code class="docutils literal notranslate"><span class="pre">verbose=TRUE</span></code>); generally we recommend calling <code class="docutils literal notranslate"><span class="pre">difftime</span></code> directly instead. Thanks &#64;oliver-oliver and &#64;boethian for the reports.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">get</span></code>/<code class="docutils literal notranslate"><span class="pre">mget</span></code> in <code class="docutils literal notranslate"><span class="pre">j</span></code> could cause <code class="docutils literal notranslate"><span class="pre">.SDcols</span></code> to be ignored or reordered, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1744">#1744</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1965">#1965</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2036">#2036</a>, and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2946">#2946</a>. Thanks &#64;franknarf1, &#64;MichaelChirico, &#64;TonyBonen, and Steffen J. (StackOverflow) for the reports.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[...,by={...}]</span></code> now handles expressions in <code class="docutils literal notranslate"><span class="pre">{</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3156">#3156</a>. Thanks to &#64;tdhock for the report.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:=</span></code> could change a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> creation statement in the body of the function calling it, or a variable in calling scope, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3890">#3890</a>. Many thanks to &#64;kirillmayantsev for the detailed reports.</p></li>
<li><p>Grouping could create a <code class="docutils literal notranslate"><span class="pre">malformed</span> <span class="pre">factor</span></code> and/or segfault when the factors returned by each group did not have identical levels, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2199">#2199</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2522">#2522</a>. Thanks to Václav Hausenblas, &#64;franknarf1, &#64;ben519, and &#64;Henrik-P for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> (and printing a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> with over 100 rows because that uses <code class="docutils literal notranslate"><span class="pre">rbindlist(head,</span> <span class="pre">tail)</span></code>) could error with <code class="docutils literal notranslate"><span class="pre">malformed</span> <span class="pre">factor</span></code> for unordered factor columns containing a used <code class="docutils literal notranslate"><span class="pre">NA_character_</span></code> level, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3915">#3915</a>. This is an unusual input for unordered factors because NA_integer_ is recommended by default in R. Thanks to &#64;sindribaldur for reporting.</p></li>
<li><p>Adding a <code class="docutils literal notranslate"><span class="pre">list</span></code> column containing an item of type <code class="docutils literal notranslate"><span class="pre">list</span></code> to a one row <code class="docutils literal notranslate"><span class="pre">data.table</span></code> could fail, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3626">#3626</a>. Thanks to Jakob Richter for reporting.</p></li>
</ol>
</div>
<div class="section" id="id18">
<h2>NOTES<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">rbindlist</span></code>’s <code class="docutils literal notranslate"><span class="pre">use.names=&quot;check&quot;</span></code> now emits its message for automatic column names (<code class="docutils literal notranslate"><span class="pre">&quot;V[0-9]+&quot;</span></code>) too, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3484">#3484</a>. See news item 5 of v1.12.2 below.</p></li>
<li><p>Adding a new column by reference using <code class="docutils literal notranslate"><span class="pre">set()</span></code> on a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> loaded from binary file now give a more helpful error message, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2996">#2996</a>. Thanks to Joseph Burling for reporting.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">data</span><span class="o">.</span><span class="n">table</span> <span class="n">has</span> <span class="n">either</span> <span class="n">been</span> <span class="n">loaded</span> <span class="kn">from</span> <span class="nn">disk</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">using</span> <span class="n">readRDS</span><span class="p">()</span><span class="o">/</span><span class="n">load</span><span class="p">())</span> <span class="ow">or</span> <span class="n">constructed</span>
<span class="n">manually</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">using</span> <span class="n">structure</span><span class="p">())</span><span class="o">.</span> <span class="n">Please</span> <span class="n">run</span> <span class="n">setDT</span><span class="p">()</span> <span class="ow">or</span> <span class="n">alloc</span><span class="o">.</span><span class="n">col</span><span class="p">()</span> <span class="n">on</span> <span class="n">it</span> <span class="n">first</span> <span class="p">(</span><span class="n">to</span> <span class="n">pre</span><span class="o">-</span><span class="n">allocate</span>
<span class="n">space</span> <span class="k">for</span> <span class="n">new</span> <span class="n">columns</span><span class="p">)</span> <span class="n">before</span> <span class="n">adding</span> <span class="n">new</span> <span class="n">columns</span> <span class="n">by</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">it</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">setorder</span></code> on a superset of a keyed <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s key now retains its key, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3456">#3456</a>. For example, if <code class="docutils literal notranslate"><span class="pre">a</span></code> is the key of <code class="docutils literal notranslate"><span class="pre">DT</span></code>, <code class="docutils literal notranslate"><span class="pre">setorder(DT,</span> <span class="pre">a,</span> <span class="pre">-v)</span></code> will leave <code class="docutils literal notranslate"><span class="pre">DT</span></code> keyed by <code class="docutils literal notranslate"><span class="pre">a</span></code>.</p></li>
<li><p>New option <code class="docutils literal notranslate"><span class="pre">options(datatable.quiet</span> <span class="pre">=</span> <span class="pre">TRUE)</span></code> turns off the package startup message, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3489">#3489</a>. <code class="docutils literal notranslate"><span class="pre">suppressPackageStartupMessages()</span></code> continues to work too. Thanks to &#64;leobarlach for the suggestion inspired by <code class="docutils literal notranslate"><span class="pre">options(tidyverse.quiet</span> <span class="pre">=</span> <span class="pre">TRUE)</span></code>. We don’t know of a way to make a package respect the <code class="docutils literal notranslate"><span class="pre">quietly=</span></code> option of <code class="docutils literal notranslate"><span class="pre">library()</span></code> and <code class="docutils literal notranslate"><span class="pre">require()</span></code> because the <code class="docutils literal notranslate"><span class="pre">quietly=</span></code> isn’t passed through for use by the package’s own <code class="docutils literal notranslate"><span class="pre">.onAttach</span></code>. If you can see how to do that, please submit a patch to R.</p></li>
<li><p>When loading a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> from disk (e.g. with <code class="docutils literal notranslate"><span class="pre">readRDS</span></code>), best practice is to run <code class="docutils literal notranslate"><span class="pre">setDT()</span></code> on the new object to assure it is correctly allocated memory for new column pointers. Barring this, unexpected behavior can follow; for example, if you assign a new column to <code class="docutils literal notranslate"><span class="pre">DT</span></code> from a function <code class="docutils literal notranslate"><span class="pre">f</span></code>, the new columns will only be assigned within <code class="docutils literal notranslate"><span class="pre">f</span></code> and <code class="docutils literal notranslate"><span class="pre">DT</span></code> will be unchanged. The <code class="docutils literal notranslate"><span class="pre">verbose</span></code> messaging in this situation is now more helpful, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1729">#1729</a>. Thanks &#64;vspinu for sharing his experience to spur this.</p></li>
<li><p>New vignette <em>Using <code class="docutils literal notranslate"><span class="pre">.SD</span></code> for Data Analysis</em>, a deep dive into use cases for the <code class="docutils literal notranslate"><span class="pre">.SD</span></code> variable to help illuminate this topic which we’ve found to be a sticking point for beginning and intermediate <code class="docutils literal notranslate"><span class="pre">data.table</span></code> users, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3412">#3412</a>.</p></li>
<li><p>Added a note to <code class="docutils literal notranslate"><span class="pre">?frank</span></code> clarifying that ranking is being done according to C sorting (i.e., like <code class="docutils literal notranslate"><span class="pre">forder</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2328">#2328</a>. Thanks to &#64;cguill95 for the request.</p></li>
<li><p>Historically, <code class="docutils literal notranslate"><span class="pre">dcast</span></code> and <code class="docutils literal notranslate"><span class="pre">melt</span></code> were built as enhancements to <code class="docutils literal notranslate"><span class="pre">reshape2</span></code>’s own <code class="docutils literal notranslate"><span class="pre">dcast</span></code>/<code class="docutils literal notranslate"><span class="pre">melt</span></code>. We removed dependency on <code class="docutils literal notranslate"><span class="pre">reshape2</span></code> in v1.9.6 but maintained some backward compatibility. As that package has been deprecated since December 2017, we will begin to formally complete the split from <code class="docutils literal notranslate"><span class="pre">reshape2</span></code> by removing some last vestiges. In particular we now warn when redirecting to <code class="docutils literal notranslate"><span class="pre">reshape2</span></code> methods and will later error before ultimately completing the split; see <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3549">#3549</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3633">#3633</a>. We thank the <code class="docutils literal notranslate"><span class="pre">reshape2</span></code> authors for their original inspiration for these functions, and &#64;ProfFancyPants for testing and reporting regressions in dev which have been fixed before release.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[col]</span></code> where <code class="docutils literal notranslate"><span class="pre">col</span></code> is a column containing row numbers of itself to select, now suggests the correct syntax (<code class="docutils literal notranslate"><span class="pre">DT[(col)]</span></code> or <code class="docutils literal notranslate"><span class="pre">DT[DT$col]</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/697">#697</a>. This expands the message introduced in <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1884">#1884</a> for the case where <code class="docutils literal notranslate"><span class="pre">col</span></code> is type <code class="docutils literal notranslate"><span class="pre">logical</span></code> and <code class="docutils literal notranslate"><span class="pre">DT[col==TRUE]</span></code> is suggested.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">datatable.old.unique.by.key</span></code> option has been warning for 1 year that it is deprecated: <code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">Please</span> <span class="pre">stop</span> <span class="pre">using</span> <span class="pre">it</span> <span class="pre">and</span> <span class="pre">pass</span> <span class="pre">by=key(DT)</span> <span class="pre">instead</span> <span class="pre">for</span> <span class="pre">clarity</span> <span class="pre">...</span></code>. This warning is now upgraded to error as per the schedule in note 10 of v1.11.0 (May 2018), and note 1 of v1.9.8 (Nov 2016). In June 2020 the option will be removed.</p></li>
<li><p>We intend to deprecate the <code class="docutils literal notranslate"><span class="pre">datatable.nomatch</span></code> option, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3578/files">more info</a>. A message is now printed upon use of the option (once per session) as a first step. It asks you to please stop using the option and to pass <code class="docutils literal notranslate"><span class="pre">nomatch=NULL</span></code> explicitly if you require inner join. Outer join (<code class="docutils literal notranslate"><span class="pre">nomatch=NA</span></code>) has always been the default because it is safer; it does not drop missing data silently. The problem is that the option is global; i.e., if a user changes the default using this option for their own use, that can change the behavior of joins inside packages that use <code class="docutils literal notranslate"><span class="pre">data.table</span></code> too. This is the only <code class="docutils literal notranslate"><span class="pre">data.table</span></code> option with this concern.</p></li>
<li><p>The test suite of 9k tests now runs with three R options on: <code class="docutils literal notranslate"><span class="pre">warnPartialMatchArgs</span></code>, <code class="docutils literal notranslate"><span class="pre">warnPartialMatchAttr</span></code>, and <code class="docutils literal notranslate"><span class="pre">warnPartialMatchDollar</span></code>. This ensures that we don’t rely on partial argument matching in internal code, for robustness and efficiency, and so that users can turn these options on for their code in production, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3664">#3664</a>. Thanks to Vijay Lulla for the suggestion, and Michael Chirico for fixing 48 internal calls to <code class="docutils literal notranslate"><span class="pre">attr()</span></code> which were missing <code class="docutils literal notranslate"><span class="pre">exact=TRUE</span></code>, for example. Thanks to R-core for adding these options to R 2.6.0 (Oct 2007).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test.data.table()</span></code> could fail if the <code class="docutils literal notranslate"><span class="pre">datatable.integer64</span></code> user option was set, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3683">#3683</a>. Thanks &#64;xiaguoxin for reporting.</p></li>
<li><p>The warning message when using <code class="docutils literal notranslate"><span class="pre">keyby=</span></code> together with <code class="docutils literal notranslate"><span class="pre">:=</span></code> is clearer, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2763">#2763</a>. Thanks to &#64;eliocamp.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">first</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code> gain an explicit <code class="docutils literal notranslate"><span class="pre">n=1L</span></code> argument so that it’s clear the default is 1, and their almost identical manual pages have been merged into one.</p></li>
<li><p>Rolling functions (<code class="docutils literal notranslate"><span class="pre">?froll</span></code>) coerce <code class="docutils literal notranslate"><span class="pre">logical</span></code> input to <code class="docutils literal notranslate"><span class="pre">numeric</span></code> (instead of failing) to mimic the behavior of <code class="docutils literal notranslate"><span class="pre">integer</span></code> input.</p></li>
<li><p>The warning message when using <code class="docutils literal notranslate"><span class="pre">strptime</span></code> in <code class="docutils literal notranslate"><span class="pre">j</span></code> has been improved, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2068">#2068</a>. Thanks to &#64;tdhock for the report.</p></li>
<li><p>Added a note to <code class="docutils literal notranslate"><span class="pre">?setkey</span></code> clarifying that <code class="docutils literal notranslate"><span class="pre">setkey</span></code> always uses C-locale sorting (as has been noted in <code class="docutils literal notranslate"><span class="pre">?setorder</span></code>). Thanks &#64;JBreidaks for the report in <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2114">#2114</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hour()</span></code>/<code class="docutils literal notranslate"><span class="pre">minute()</span></code>/<code class="docutils literal notranslate"><span class="pre">second()</span></code> are much faster for <code class="docutils literal notranslate"><span class="pre">ITime</span></code> input, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3158">#3518</a>.</p></li>
<li><p>New alias <code class="docutils literal notranslate"><span class="pre">setalloccol</span></code> for <code class="docutils literal notranslate"><span class="pre">alloc.col</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3475">#3475</a>. For consistency with <code class="docutils literal notranslate"><span class="pre">set*</span></code> prefixes for functions that operate in-place (like <code class="docutils literal notranslate"><span class="pre">setkey</span></code>, <code class="docutils literal notranslate"><span class="pre">setorder</span></code>, etc.). <code class="docutils literal notranslate"><span class="pre">alloc.col</span></code> is not going to be deprecated but we recommend using <code class="docutils literal notranslate"><span class="pre">setalloccol</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcast</span></code> no longer emits a message when <code class="docutils literal notranslate"><span class="pre">value.var</span></code> is missing but <code class="docutils literal notranslate"><span class="pre">fun.aggregate</span></code> is explicitly set to <code class="docutils literal notranslate"><span class="pre">length</span></code> (since <code class="docutils literal notranslate"><span class="pre">value.var</span></code> is arbitrary in this case), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2980">#2980</a>.</p></li>
<li><p>Optimized <code class="docutils literal notranslate"><span class="pre">mean</span></code> of <code class="docutils literal notranslate"><span class="pre">integer</span></code> columns no longer warns about a coercion to numeric, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/986">#986</a>. Thanks &#64;dgrtwo for his <a class="reference external" href="https://youtu.be/AmE4LXPQErM?t=175">YouTube tutorial at 3:01</a> where the warning occurs.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">first</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code> function on <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> object no longer loads <code class="docutils literal notranslate"><span class="pre">xts</span></code> namespace, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3857">#3857</a>. <code class="docutils literal notranslate"><span class="pre">first</span></code> on empty <code class="docutils literal notranslate"><span class="pre">data.table</span></code> returns empty <code class="docutils literal notranslate"><span class="pre">data.table</span></code> now <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3858">#3858</a>.</p></li>
<li><p>Added some clarifying details about what happens when a shell command is used in <code class="docutils literal notranslate"><span class="pre">fread</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3877">#3877</a>. Thanks Brian for the StackOverflow question which highlighted the lack of explanation here.</p></li>
<li><p>We continue to encourage packages to <code class="docutils literal notranslate"><span class="pre">Import</span></code> rather than <code class="docutils literal notranslate"><span class="pre">Depend</span></code> on <code class="docutils literal notranslate"><span class="pre">data.table</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3076">#3076</a>. To prevent the growth rate in new packages using <code class="docutils literal notranslate"><span class="pre">Depend</span></code>, we have requested that CRAN apply a small patch we provided to prevent new submissions using <code class="docutils literal notranslate"><span class="pre">Depend</span></code>. If this is accepted, the error under <code class="docutils literal notranslate"><span class="pre">--as-cran</span></code> will be as follows. The existing 73 packages using <code class="docutils literal notranslate"><span class="pre">Depend</span></code> will continue to pass OK until they next update, at which point they will be required to change from <code class="docutils literal notranslate"><span class="pre">Depend</span></code> to <code class="docutils literal notranslate"><span class="pre">Import</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="n">CMD</span> <span class="n">check</span> <span class="o">&lt;</span><span class="n">pkg</span><span class="o">&gt;</span> <span class="o">--</span><span class="k">as</span><span class="o">-</span><span class="n">cran</span>
<span class="o">...</span>
<span class="o">*</span> <span class="n">checking</span> <span class="n">package</span> <span class="n">dependencies</span> <span class="o">...</span> <span class="n">ERROR</span>

<span class="n">data</span><span class="o">.</span><span class="n">table</span> <span class="n">should</span> <span class="n">be</span> <span class="ow">in</span> <span class="n">Imports</span> <span class="ow">not</span> <span class="n">Depends</span><span class="o">.</span> <span class="n">Please</span> <span class="n">contact</span> <span class="n">its</span>
<span class="n">maintainer</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-12-2-07-apr-2019">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/14?closed=1">v1.12.2</a>  (07 Apr 2019)<a class="headerlink" href="#data-table-v1-12-2-07-apr-2019" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id19">
<h2>NEW FEATURES<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">:=</span></code> no longer recycles length&gt;1 RHS vectors. There was a warning when recycling left a remainder but no warning when the LHS length was an exact multiple of the RHS length (the same behaviour as base R). Consistent feedback for several years has been that recycling is more often a bug. In rare cases where you need to recycle a length&gt;1 vector, please use <code class="docutils literal notranslate"><span class="pre">rep()</span></code> explicitly. Single values are still recycled silently as before. Early warning was given in <a class="reference external" href="https://twitter.com/MattDowle/status/1088544083499311104">this tweet</a>. The 774 CRAN and Bioconductor packages using <code class="docutils literal notranslate"><span class="pre">data.table</span></code> were tested and the maintainers of the 16 packages affected (2%) were consulted before going ahead, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3310">#3310</a>. Upon agreement we went ahead. Many thanks to all those maintainers for already updating on CRAN, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3347">#3347</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">foverlaps</span></code> now supports <code class="docutils literal notranslate"><span class="pre">type=&quot;equal&quot;</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3416">#3416</a> and part of <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3002">#3002</a>.</p></li>
<li><p>The number of logical CPUs used by default has been reduced from 100% to 50%. The previous 100% default was reported to cause significant slow downs when other non-trivial processes were also running, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3395">#3395</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3298">#3298</a>. Two new optional environment variables (<code class="docutils literal notranslate"><span class="pre">R_DATATABLE_NUM_PROCS_PERCENT</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">R_DATATABLE_NUM_THREADS</span></code>) control this default. <code class="docutils literal notranslate"><span class="pre">setDTthreads()</span></code> gains <code class="docutils literal notranslate"><span class="pre">percent=</span></code> and <code class="docutils literal notranslate"><span class="pre">?setDTthreads</span></code> has been significantly revised. The output of <code class="docutils literal notranslate"><span class="pre">getDTthreads(verbose=TRUE)</span></code> has been expanded. The environment variable <code class="docutils literal notranslate"><span class="pre">OMP_THREAD_LIMIT</span></code> is now respected (<a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3300">#3300</a>) in addition to <code class="docutils literal notranslate"><span class="pre">OMP_NUM_THREADS</span></code> as before.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbind</span></code> and <code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> now retain the position of duplicate column names rather than grouping them together <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3373">#3373</a>, fill length 0 columns (including NULL) with NA with warning <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1871">#1871</a>, and recycle length-1 columns <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/524">#524</a>. Thanks to Kun Ren for the requests which arose when parsing JSON.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbindlist</span></code>’s <code class="docutils literal notranslate"><span class="pre">use.names=</span></code> default has changed from <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;check&quot;</span></code>. This emits a message if the column names of each item are not identical and then proceeds as if <code class="docutils literal notranslate"><span class="pre">use.names=FALSE</span></code> for backwards compatibility; i.e., bind by column position not by column name. The <code class="docutils literal notranslate"><span class="pre">rbind</span></code> method for <code class="docutils literal notranslate"><span class="pre">data.table</span></code> already sets <code class="docutils literal notranslate"><span class="pre">use.names=TRUE</span></code> so this change affects <code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> only and not <code class="docutils literal notranslate"><span class="pre">rbind.data.table</span></code>. To stack differently named columns together silently (the previous default behavior of <code class="docutils literal notranslate"><span class="pre">rbindlist</span></code>), it is now necessary to specify <code class="docutils literal notranslate"><span class="pre">use.names=FALSE</span></code> for clarity to readers of your code. Thanks to Clayton Stanley who first raised the issue <a class="reference external" href="https://lists.r-forge.r-project.org/pipermail/datatable-help/2014-April/002480.html">here</a>. To aid pinpointing the calls to <code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> that need attention, the message can be turned to error using <code class="docutils literal notranslate"><span class="pre">options(datatable.rbindlist.check=&quot;error&quot;)</span></code>. This option also accepts <code class="docutils literal notranslate"><span class="pre">&quot;warning&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;message&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code>. In this release the message is suppressed for default column names (<code class="docutils literal notranslate"><span class="pre">&quot;V[0-9]+&quot;</span></code>); the next release will emit the message for those too. In 6 months the default will be upgraded from message to warning. There are two slightly different messages. They are helpful, include context and point to this news item :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Column</span> <span class="o">%</span><span class="n">d</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">]</span> <span class="n">of</span> <span class="n">item</span> <span class="o">%</span><span class="n">d</span> <span class="ow">is</span> <span class="n">missing</span> <span class="ow">in</span> <span class="n">item</span> <span class="o">%</span><span class="n">d</span><span class="o">.</span> <span class="n">Use</span> <span class="n">fill</span><span class="o">=</span><span class="n">TRUE</span> <span class="n">to</span> <span class="n">fill</span> <span class="k">with</span>
  <span class="n">NA</span> <span class="p">(</span><span class="n">NULL</span> <span class="k">for</span> <span class="nb">list</span> <span class="n">columns</span><span class="p">),</span> <span class="ow">or</span> <span class="n">use</span><span class="o">.</span><span class="n">names</span><span class="o">=</span><span class="n">FALSE</span> <span class="n">to</span> <span class="n">ignore</span> <span class="n">column</span> <span class="n">names</span><span class="o">.</span>
  <span class="n">See</span> <span class="n">news</span> <span class="n">item</span> <span class="mi">5</span> <span class="ow">in</span> <span class="n">v1</span><span class="mf">.12.2</span> <span class="k">for</span> <span class="n">options</span> <span class="n">to</span> <span class="n">control</span> <span class="n">this</span> <span class="n">message</span><span class="o">.</span>

<span class="n">Column</span> <span class="o">%</span><span class="n">d</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">]</span> <span class="n">of</span> <span class="n">item</span> <span class="o">%</span><span class="n">d</span> <span class="n">appears</span> <span class="ow">in</span> <span class="n">position</span> <span class="o">%</span><span class="n">d</span> <span class="ow">in</span> <span class="n">item</span> <span class="o">%</span><span class="n">d</span><span class="o">.</span> <span class="n">Set</span> <span class="n">use</span><span class="o">.</span><span class="n">names</span><span class="o">=</span><span class="n">TRUE</span>
  <span class="n">to</span> <span class="n">match</span> <span class="n">by</span> <span class="n">column</span> <span class="n">name</span><span class="p">,</span> <span class="ow">or</span> <span class="n">use</span><span class="o">.</span><span class="n">names</span><span class="o">=</span><span class="n">FALSE</span> <span class="n">to</span> <span class="n">ignore</span> <span class="n">column</span> <span class="n">names</span><span class="o">.</span>
  <span class="n">See</span> <span class="n">news</span> <span class="n">item</span> <span class="mi">5</span> <span class="ow">in</span> <span class="n">v1</span><span class="mf">.12.2</span> <span class="k">for</span> <span class="n">options</span> <span class="n">to</span> <span class="n">control</span> <span class="n">this</span> <span class="n">message</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread</span></code> gains <code class="docutils literal notranslate"><span class="pre">keepLeadingZeros</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2999">#2999</a>. By default <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> so that, as before, a field containing <code class="docutils literal notranslate"><span class="pre">001</span></code> is interpreted as the integer 1, otherwise the character string <code class="docutils literal notranslate"><span class="pre">&quot;001&quot;</span></code>. The default may be changed using <code class="docutils literal notranslate"><span class="pre">options(datatable.keepLeadingZeros=TRUE)</span></code>. Many thanks to &#64;marc-outins for the PR.</p></li>
</ol>
</div>
<div class="section" id="id20">
<h2>BUG FIXES<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rbindlist()</span></code> of a malformed factor which is missing a levels attribute is now a helpful error rather than a cryptic error about <code class="docutils literal notranslate"><span class="pre">STRING_ELT</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3315">#3315</a>. Thanks to Michael Chirico for reporting.</p></li>
<li><p>Forgetting <code class="docutils literal notranslate"><span class="pre">type=</span></code> in <code class="docutils literal notranslate"><span class="pre">shift(val,</span> <span class="pre">&quot;lead&quot;)</span></code> would segfault, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3354">#3354</a>. A helpful error is now produced to indicate <code class="docutils literal notranslate"><span class="pre">&quot;lead&quot;</span></code> is being passed to <code class="docutils literal notranslate"><span class="pre">n=</span></code> rather than the intended <code class="docutils literal notranslate"><span class="pre">type=</span></code> argument. Thanks to &#64;SymbolixAU for reporting.</p></li>
<li><p>The default print output (top 5 and bottom 5 rows) when ncol&gt;255 could display the columns in the wrong order, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3306">#3306</a>. Thanks to Kun Ren for reporting.</p></li>
<li><p>Grouping by unusual column names such as <code class="docutils literal notranslate"><span class="pre">by='string_with_\\'</span></code> and <code class="docutils literal notranslate"><span class="pre">keyby=&quot;x</span> <span class="pre">y&quot;</span></code> could fail, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3319">#3319</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3378">#3378</a>. Thanks to &#64;HughParsonage for reporting and &#64;MichaelChirico for the fixes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">foverlaps()</span></code> could return incorrect results for <code class="docutils literal notranslate"><span class="pre">POSIXct</span> <span class="pre">&lt;=</span> <span class="pre">1970-01-01</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3349">#3349</a>. Thanks to &#64;lux5 for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcast.data.table</span></code> now handles functions passed to <code class="docutils literal notranslate"><span class="pre">fun.aggregate=</span></code> via a variable; e.g., <code class="docutils literal notranslate"><span class="pre">funs</span> <span class="pre">&lt;-</span> <span class="pre">list(sum,</span> <span class="pre">mean);</span> <span class="pre">dcast(...,</span> <span class="pre">fun.aggregate=funs</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1974">#1974</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1369">#1369</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2064">#2064</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2949">#2949</a>. Thanks to &#64;sunbee, &#64;Ping2016, &#64;smidelius and &#64;d0rg0ld for reporting.</p></li>
<li><p>Some non-equijoin cases could segfault, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3401">#3401</a>. Thanks to &#64;Gayyam for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcast.data.table</span></code> could sort rows containing <code class="docutils literal notranslate"><span class="pre">NA</span></code> incorrectly, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2202">#2202</a>. Thanks to &#64;Galileo-Galilei for the report.</p></li>
<li><p>Sorting, grouping and finding unique values of a numeric column containing at most one finite value (such as <code class="docutils literal notranslate"><span class="pre">c(Inf,0,-Inf)</span></code>) could return incorrect results, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3372">#3372</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3381">#3381</a>; e.g., <code class="docutils literal notranslate"><span class="pre">data.table(A=c(Inf,0,-Inf),</span> <span class="pre">V=1:3)[,sum(V),by=A]</span></code> would treat the 3 rows as one group. This was a regression in 1.12.0. Thanks to Nicolas Ampuero for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:=</span></code> with quoted expression and dot alias now works as expected, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3425">#3425</a>. Thanks to &#64;franknarf1 for raising and &#64;jangorecki for the PR.</p></li>
<li><p>A join’s result could be incorrectly keyed when a single nomatch occurred at the very beginning while all other values matched, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3441">#3441</a>. The incorrect key would cause incorrect results in subsequent queries. Thanks to &#64;symbalex for reporting and &#64;franknarf1 for pinpointing the root cause.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbind</span></code> and <code class="docutils literal notranslate"><span class="pre">rbindlist(...,</span> <span class="pre">use.names=TRUE)</span></code> with over 255 columns could return the columns in a random order, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3373">#3373</a>. The contents and name of each column was correct but the order that the columns appeared in the result might not have matched the original input.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbind</span></code> and <code class="docutils literal notranslate"><span class="pre">rbindlist</span></code> now combine <code class="docutils literal notranslate"><span class="pre">integer64</span></code> columns together with non-<code class="docutils literal notranslate"><span class="pre">integer64</span></code> columns correctly <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1349">#1349</a>, and support <code class="docutils literal notranslate"><span class="pre">raw</span></code> columns <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2819">#2819</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NULL</span></code> columns are caught and error appropriately rather than segfault in some cases, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2303">#2303</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2305">#2305</a>. Thanks to Hugh Parsonage and &#64;franknarf1 for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">melt</span></code> would error with ‘factor malformed’ or segfault in the presence of duplicate column names, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1754">#1754</a>. Many thanks to &#64;franknarf1, William Marble, wligtenberg and Toby Dylan Hocking for reproducible examples. All examples have been added to the test suite.</p></li>
<li><p>Removing a column from a null (0-column) data.table is now a (standard and simpler) warning rather than error, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2335">#2335</a>. It is no longer an error to add a column to a null (0-column) data.table.</p></li>
<li><p>Non-UTF8 strings were not always sorted correctly on Windows (a regression in v1.12.0), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3397">#3397</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3451">#3451</a>. Many thanks to &#64;shrektan for reporting and fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cbind</span></code> with a null (0-column) <code class="docutils literal notranslate"><span class="pre">data.table</span></code> now works as expected, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3445">#3445</a>. Thanks to &#64;mb706 for reporting.</p></li>
<li><p>Subsetting does a better job of catching a malformed <code class="docutils literal notranslate"><span class="pre">data.table</span></code> with error rather than segfault. A column may not be NULL, nor may a column be an object which has columns (such as a <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> or <code class="docutils literal notranslate"><span class="pre">matrix</span></code>). Thanks to a comment and reproducible example in <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3369">#3369</a> from Drew Abbot which demonstrated the issue which arose from parsing JSON. The next release will enable <code class="docutils literal notranslate"><span class="pre">as.data.table</span></code> to unpack columns which are <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> to support this use case.</p></li>
</ol>
</div>
<div class="section" id="id21">
<h2>NOTES<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>When upgrading to 1.12.0 some Windows users might have seen <code class="docutils literal notranslate"><span class="pre">CdllVersion</span> <span class="pre">not</span> <span class="pre">found</span></code> in some circumstances. We found a way to catch that so the <a class="reference external" href="https://twitter.com/MattDowle/status/1084528873549705217">helpful message</a> now occurs for those upgrading from versions prior to 1.12.0 too, as well as those upgrading from 1.12.0 to a later version. See item 1 in notes section of 1.12.0 below for more background.</p></li>
<li><p>v1.12.0 checked itself on loading using <code class="docutils literal notranslate"><span class="pre">tools::checkMD5sums(&quot;data.table&quot;)</span></code> but this check failed under the <code class="docutils literal notranslate"><span class="pre">packrat</span></code> package manager on Windows because <code class="docutils literal notranslate"><span class="pre">packrat</span></code> appears to modify the DESCRIPTION file of packages it has snapshot, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3329">#3329</a>. This check is now removed. The <code class="docutils literal notranslate"><span class="pre">CdllVersion</span></code> check was introduced after the <code class="docutils literal notranslate"><span class="pre">checkMD5sums()</span></code> attempt and is better; e.g., reliable on all platforms.</p></li>
<li><p>As promised in new feature 6 of v1.11.6 Sep 2018 (see below in this news file), the <code class="docutils literal notranslate"><span class="pre">datatable.CJ.names</span></code> option’s default is now <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>. In v1.13.0 it will be removed.</p></li>
<li><p>Travis CI gains OSX using homebrew llvm for OpenMP support, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3326">#3326</a>. Thanks &#64;marcusklik for the PR.</p></li>
<li><p>Calling <code class="docutils literal notranslate"><span class="pre">data.table:::print.data.table()</span></code> directly (i.e. bypassing method dispatch by using 3 colons) and passing it a 0-column <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> (not <code class="docutils literal notranslate"><span class="pre">data.table</span></code>) now works, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3363">#3363</a>. Thanks &#64;heavywatal for the PR.</p></li>
<li><p>v1.12.0 did not compile on Solaris 10 using Oracle Developer Studio 12.6, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3285">#3285</a>. Many thanks to Prof Ripley for providing and testing a patch. For future reference and other package developers, a <code class="docutils literal notranslate"><span class="pre">const</span></code> variable should not be passed to OpenMP’s <code class="docutils literal notranslate"><span class="pre">num_threads()</span></code> directive otherwise <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">operand</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">modifiable</span> <span class="pre">lvalue</span></code> occurs. This appears to be a compiler bug which is why the specific versions are mentioned in this note.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">foverlaps</span></code> provides clearer error messages w.r.t. factor and POSIXct interval columns, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2645">#2645</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3007">#3007</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1143">#1143</a>. Thanks to &#64;sritchie73, &#64;msummersgill and &#64;DavidArenburg for the reports.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unique(DT)</span></code> checks up-front the types of all the columns and will fail if any column is type <code class="docutils literal notranslate"><span class="pre">list</span></code> even though those <code class="docutils literal notranslate"><span class="pre">list</span></code> columns may not be needed to establish uniqueness. Use <code class="docutils literal notranslate"><span class="pre">unique(DT,</span> <span class="pre">by=...)</span></code> to specify columns that are not type <code class="docutils literal notranslate"><span class="pre">list</span></code>. v1.11.8 and before would also correctly fail with the same error, but not when uniqueness had been established in prior columns: it would stop early, not look at the <code class="docutils literal notranslate"><span class="pre">list</span></code> column and return the correct result. Checking up-front was necessary for some internal optimizations and it’s probably best to be explicit anyway. Thanks to James Lamb for reporting, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3332">#3332</a>. The error message has been embellished :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Column</span> <span class="mi">2</span> <span class="n">of</span> <span class="n">by</span><span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="ow">not</span> <span class="n">yet</span> <span class="n">supported</span><span class="o">.</span> <span class="n">Please</span> <span class="n">use</span> <span class="n">the</span> <span class="n">by</span><span class="o">=</span> <span class="n">argument</span> <span class="n">to</span> <span class="n">specify</span>
<span class="n">columns</span> <span class="k">with</span> <span class="n">types</span> <span class="n">that</span> <span class="n">are</span> <span class="n">supported</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>Reminder that note 11 in v1.11.0 (May 2018) warned that <code class="docutils literal notranslate"><span class="pre">set2key()</span></code> and <code class="docutils literal notranslate"><span class="pre">key2()</span></code> will be removed in May 2019. They have been warning since v1.9.8 (Nov 2016) and their warnings were upgraded to errors in v1.11.0 (May 2018). When they were introduced in version 1.9.4 (Oct 2014) they were marked as ‘experimental’.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">key(DT)&lt;-</span></code> form of <code class="docutils literal notranslate"><span class="pre">setkey()</span></code> has been warning since at least 2012 to use <code class="docutils literal notranslate"><span class="pre">setkey()</span></code>. The warning is now stronger: <code class="docutils literal notranslate"><span class="pre">key(x)&lt;-value</span> <span class="pre">is</span> <span class="pre">deprecated</span> <span class="pre">and</span> <span class="pre">not</span> <span class="pre">supported.</span> <span class="pre">Please</span> <span class="pre">change</span> <span class="pre">to</span> <span class="pre">use</span> <span class="pre">setkey().</span></code>. This warning will be upgraded to error in one year.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-12-0-13-jan-2019">
<h1>data.table v1.12.0  (13 Jan 2019)<a class="headerlink" href="#data-table-v1-12-0-13-jan-2019" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id22">
<h2>NEW FEATURES<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">setDTthreads()</span></code> gains <code class="docutils literal notranslate"><span class="pre">restore_after_fork=</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2885">#2885</a>. The default <code class="docutils literal notranslate"><span class="pre">NULL</span></code> leaves the internal option unchanged which by default is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>. <code class="docutils literal notranslate"><span class="pre">data.table</span></code> has always switched to single-threaded mode on fork. It used to restore multithreading after a fork too but problems were reported on Mac and Intel OpenMP library (see 1.10.4 notes below). We are now trying again thanks to suggestions and success reported by Kun Ren and Mark Klik in package <code class="docutils literal notranslate"><span class="pre">fst</span></code>. If you experience problems with multithreading after a fork, please restart R and call <code class="docutils literal notranslate"><span class="pre">setDTthreads(restore_after_fork=FALSE)</span></code>.</p></li>
<li><p>Subsetting, ordering and grouping now use more parallelism. See benchmarks <a class="reference external" href="https://h2oai.github.io/db-benchmark/">here</a> and Matt Dowle’s presentation in October 2018 on YouTube <a class="reference external" href="https://youtu.be/Ddr8N9STSuI">here</a>. These internal changes gave rise to 4 regressions which were found before release thanks to Kun Ren, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3211">#3211</a>. He kindly volunteers to ‘go-first’ and runs data.table through his production systems before release. We are looking for a ‘go-second’ volunteer please. A request to test before release was tweeted on 17 Dec <a class="reference external" href="https://twitter.com/MattDowle/status/1074746218645938176">here</a>. As usual, all CRAN and Bioconductor packages using data.table (currently 750) have been tested against this release, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3233">#3233</a>. There are now 8,000 tests in 13,000 lines of test code; more lines of test code than there is code. Overall coverage has increased to 94% thanks to Michael Chirico.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">frollmean</span></code> has been added by Jan Gorecki to calculate <em>rolling mean</em>, see <code class="docutils literal notranslate"><span class="pre">?froll</span></code> for documentation. Function name and arguments are experimental. Related to <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2778">#2778</a> (and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/624">#624</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/626">#626</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1855">#1855</a>). Other rolling statistics will follow.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> can now read a remote compressed file in one step; <code class="docutils literal notranslate"><span class="pre">fread(&quot;https://domain.org/file.csv.bz2&quot;)</span></code>. The <code class="docutils literal notranslate"><span class="pre">file=</span></code> argument now supports <code class="docutils literal notranslate"><span class="pre">.gz</span></code> and <code class="docutils literal notranslate"><span class="pre">.bz2</span></code> too; i.e. <code class="docutils literal notranslate"><span class="pre">fread(file=&quot;file.csv.gz&quot;)</span></code> works now where only <code class="docutils literal notranslate"><span class="pre">fread(&quot;file.csv.gz&quot;)</span></code> worked in 1.11.8.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nomatch=NULL</span></code> now does the same as <code class="docutils literal notranslate"><span class="pre">nomatch=0L</span></code> in both <code class="docutils literal notranslate"><span class="pre">DT[...]</span></code> and <code class="docutils literal notranslate"><span class="pre">foverlaps()</span></code>; i.e. discards missing values silently (inner join). The default is still <code class="docutils literal notranslate"><span class="pre">nomatch=NA</span></code> (outer join) for statistical safety so that missing values are retained by default. After several years have elapsed, we will start to deprecate <code class="docutils literal notranslate"><span class="pre">0L</span></code>; please start using <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. In future <code class="docutils literal notranslate"><span class="pre">nomatch=.(0)</span></code> (note that <code class="docutils literal notranslate"><span class="pre">.()</span></code> creates a <code class="docutils literal notranslate"><span class="pre">list</span></code> type and is different to <code class="docutils literal notranslate"><span class="pre">nomatch=0</span></code>) will fill with <code class="docutils literal notranslate"><span class="pre">0</span></code> to save replacing <code class="docutils literal notranslate"><span class="pre">NA</span></code> with <code class="docutils literal notranslate"><span class="pre">0</span></code> afterwards, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/857">#857</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setnames()</span></code> gains <code class="docutils literal notranslate"><span class="pre">skip_absent</span></code> to skip names in <code class="docutils literal notranslate"><span class="pre">old</span></code> that aren’t present, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3030">#3030</a>. By default <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> so that it is still an error, as before, to attempt to change a column name that is not present. Thanks to &#64;MusTheDataGuy for the suggestion and the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NA</span></code> in <code class="docutils literal notranslate"><span class="pre">between()</span></code> and <code class="docutils literal notranslate"><span class="pre">%between%</span></code>’s <code class="docutils literal notranslate"><span class="pre">lower</span></code> and <code class="docutils literal notranslate"><span class="pre">upper</span></code> are now taken as missing bounds and return <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> rather than <code class="docutils literal notranslate"><span class="pre">NA</span></code>. This is now documented.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shift()</span></code> now interprets negative values of <code class="docutils literal notranslate"><span class="pre">n</span></code> to mean the opposite <code class="docutils literal notranslate"><span class="pre">type=</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1708">#1708</a>. When <code class="docutils literal notranslate"><span class="pre">give.names=TRUE</span></code> the result is named using a positive <code class="docutils literal notranslate"><span class="pre">n</span></code> with the appropriate <code class="docutils literal notranslate"><span class="pre">type=</span></code>. Alternatively, a new <code class="docutils literal notranslate"><span class="pre">type=&quot;shift&quot;</span></code> names the result using a signed <code class="docutils literal notranslate"><span class="pre">n</span></code> and constant type.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="m">-5</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="n">give.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>                <span class="o">=&gt;</span>  <span class="s">&quot;_lead_5&quot;</span> <span class="kc">...</span> <span class="s">&quot;_lag_5&quot;</span>
<span class="nf">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="m">-5</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;shift&quot;</span><span class="p">,</span> <span class="n">give.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>  <span class="o">=&gt;</span>  <span class="s">&quot;_shift_-5&quot;</span> <span class="kc">...</span> <span class="s">&quot;_shift_5&quot;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> now accepts <code class="docutils literal notranslate"><span class="pre">matrix</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2613">#2613</a>. Thanks to Michael Chirico for the suggestion and Felipe Parages for implementing. For now matrix input is converted to data.table (which can be costly) before writing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> and <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> can now handle file names in native and UTF-8 encoding, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3078">#3078</a>. Thanks to Daniel Possenriede (&#64;dpprdan) for reporting and fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[i]</span></code> and <code class="docutils literal notranslate"><span class="pre">DT[i,cols]</span></code> now call internal parallel subsetting code, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2951">#2951</a>. Subsetting is significantly faster (as are many other operations) with factor columns rather than character.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="m">2e8</span>                           <span class="c1"># 4GB data on 4-core CPU with 16GB RAM</span>
<span class="n">DT</span> <span class="o">=</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">ID</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">),</span>
                <span class="n">V1</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">),</span>
                <span class="n">V2</span> <span class="o">=</span> <span class="nf">runif</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">w</span> <span class="o">=</span> <span class="nf">which</span><span class="p">(</span><span class="n">DT</span><span class="o">$</span><span class="n">V1</span> <span class="o">&gt;</span> <span class="m">3</span><span class="p">)</span>              <span class="c1">#  select 40% of rows</span>
                                  <span class="c1">#  v1.12.0   v1.11.8</span>
<span class="nf">system.time</span><span class="p">(</span><span class="n">DT</span><span class="p">[</span><span class="n">w</span><span class="p">])</span>                <span class="c1">#     0.8s      2.6s</span>
<span class="n">DT</span><span class="p">[,</span> <span class="n">ID</span> <span class="o">:=</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">ID</span><span class="p">)]</span>
<span class="nf">system.time</span><span class="p">(</span><span class="n">DT</span><span class="p">[</span><span class="n">w</span><span class="p">])</span>                <span class="c1">#     0.4s      2.3s</span>
<span class="nf">system.time</span><span class="p">(</span><span class="n">DT</span><span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="s">&quot;V2&quot;</span><span class="p">)])</span>  <span class="c1">#     0.3s      1.9s</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[...,</span> <span class="pre">.SDcols=]</span></code> now accepts <code class="docutils literal notranslate"><span class="pre">patterns()</span></code>; e.g. <code class="docutils literal notranslate"><span class="pre">DT[...,</span> <span class="pre">.SDcols=patterns(&quot;^V&quot;)]</span></code>, for filtering columns according to a pattern (as in <code class="docutils literal notranslate"><span class="pre">melt.data.table</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1878">#1878</a>. Thanks to many people for pushing for this and &#64;MichaelChirico for ultimately filing the PR. See <code class="docutils literal notranslate"><span class="pre">?data.table</span></code> for full details and examples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split</span></code> data.table method will now preserve attributes, closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2047">#2047</a>. Thanks to &#64;caneff for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[i,j]</span></code> now retains user-defined and inherited attributes, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/995">#995</a>; e.g.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">attr</span><span class="p">(</span><span class="n">datasets</span><span class="o">::</span><span class="n">BOD</span><span class="p">,</span><span class="s">&quot;reference&quot;</span><span class="p">)</span>                     <span class="c1"># &quot;A1.4, p. 270&quot;</span>
<span class="nf">attr</span><span class="p">(</span><span class="nf">as.data.table</span><span class="p">(</span><span class="n">datasets</span><span class="o">::</span><span class="n">BOD</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="s">&quot;reference&quot;</span><span class="p">)</span>   <span class="c1"># was NULL now &quot;A1.4, p. 270&quot;</span>
</pre></div>
</div>
<p>If a superclass defines attributes that may not be valid after a <code class="docutils literal notranslate"><span class="pre">[</span></code> subset then the superclass should implement its own <code class="docutils literal notranslate"><span class="pre">[</span></code> method to manage those after calling <code class="docutils literal notranslate"><span class="pre">NextMethod()</span></code>.</p>
</li>
</ol>
</div>
<div class="section" id="id23">
<h2>BUG FIXES<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Providing an <code class="docutils literal notranslate"><span class="pre">i</span></code> subset expression when attempting to delete a column correctly failed with helpful error, but when the column was missing too created a new column full of <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3089">#3089</a>. Thanks to Michael Chirico for reporting.</p></li>
<li><p>Column names that look like expressions (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;a&lt;=colB&quot;</span></code>) caused an error when used in <code class="docutils literal notranslate"><span class="pre">on=</span></code> even when wrapped with backticks, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3092">#3092</a>. Additionally, <code class="docutils literal notranslate"><span class="pre">on=</span></code> now supports white spaces around operators; e.g. <code class="docutils literal notranslate"><span class="pre">on</span> <span class="pre">=</span> <span class="pre">&quot;colA</span> <span class="pre">==</span> <span class="pre">colB&quot;</span></code>. Thanks to &#64;mt1022 for reporting and to &#64;MarkusBonsch for fixing.</p></li>
<li><p>Unmatched <code class="docutils literal notranslate"><span class="pre">patterns</span></code> in <code class="docutils literal notranslate"><span class="pre">measure.vars</span></code> fail early and with feedback, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3106">#3106</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(...,</span> <span class="pre">skip=)</span></code> now skips non-standard <code class="docutils literal notranslate"><span class="pre">\r</span></code> and <code class="docutils literal notranslate"><span class="pre">\n\r</span></code> line endings properly again, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3006">#3006</a>. Standard line endings (<code class="docutils literal notranslate"><span class="pre">\n</span></code> Linux/Mac and <code class="docutils literal notranslate"><span class="pre">\r\n</span></code> Windows) were skipped ok. Thanks to &#64;brattono and &#64;tbrycekelly for providing reproducible examples, and &#64;st-pasha for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(...,</span> <span class="pre">colClasses=)</span></code> could return a corrupted result when a lower type was requested for one or more columns (e.g. reading “3.14” as integer), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2922">#2922</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2863">#2863</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3143">#3143</a>. It now ignores the request as documented and the helpful message in verbose mode is upgraded to warning. In future, coercing to a lower type might be supported (with warning if any accuracy is lost). <code class="docutils literal notranslate"><span class="pre">&quot;NULL&quot;</span></code> is recognized again in both vector and list mode; e.g. <code class="docutils literal notranslate"><span class="pre">colClasses=c(&quot;integer&quot;,&quot;NULL&quot;,&quot;integer&quot;)</span></code> and <code class="docutils literal notranslate"><span class="pre">colClasses=list(NULL=2,</span> <span class="pre">integer=10:40)</span></code>. Thanks to Arun Srinivasan, Kun Ren, Henri Ståhl and &#64;kszela24 for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cube()</span></code> will now produce expected order of results, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3179">#3179</a>. Thanks to &#64;Henrik-P for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groupingsets()</span></code> groups by empty column set and constant value in <code class="docutils literal notranslate"><span class="pre">j</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3173">#3173</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split.data.table()</span></code> failed if <code class="docutils literal notranslate"><span class="pre">DT</span></code> had a factor column named <code class="docutils literal notranslate"><span class="pre">&quot;x&quot;</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3151">#3151</a>. Thanks to &#64;tdeenes for reporting and fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fsetequal</span></code> now handles properly datasets having last column a character, closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2318">#2318</a>. Thanks to &#64;pschil and &#64;franknarf1 for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[...,</span> <span class="pre">.SDcols=integer(0L)]</span></code> could fail, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3185">#3185</a>. An empty <code class="docutils literal notranslate"><span class="pre">data.table</span></code> is now returned correctly.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.table.default</span></code> method will now always copy its input, closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3230">#3230</a>. Thanks to &#64;NikdAK for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[...,</span> <span class="pre">.SDcols=integer()]</span></code> failed with <code class="docutils literal notranslate"><span class="pre">.SDcols</span> <span class="pre">is</span> <span class="pre">numeric</span> <span class="pre">but</span> <span class="pre">has</span> <span class="pre">both</span> <span class="pre">+ve</span> <span class="pre">and</span> <span class="pre">-ve</span> <span class="pre">indices</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1789">#1789</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3185">#3185</a>. It now functions as <code class="docutils literal notranslate"><span class="pre">.SDcols=character()</span></code> has done and creates an empty <code class="docutils literal notranslate"><span class="pre">.SD</span></code>. Thanks to Gabor Grothendieck and Hugh Parsonage for reporting. A related issue with empty <code class="docutils literal notranslate"><span class="pre">.SDcols</span></code> was fixed in development before release thanks to Kun Ren’s testing, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3211">#3211</a>.</p></li>
<li><p>Multithreaded stability should be much improved with R 3.5+. Many thanks to Luke Tierney for pinpointing a memory issue with package <code class="docutils literal notranslate"><span class="pre">constellation</span></code> caused by <code class="docutils literal notranslate"><span class="pre">data.table</span></code> and his advice, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3165">#3165</a>. Luke also added an extra check to R-devel when compiled with <code class="docutils literal notranslate"><span class="pre">--enable-strict-barrier</span></code>. The test suite is run through latest daily R-devel after every commit as usual, but now with <code class="docutils literal notranslate"><span class="pre">--enable-strict-barrier</span></code> on too via GitLab CI (“Extra” badge on the <code class="docutils literal notranslate"><span class="pre">data.table</span></code> homepage) thanks to Jan Gorecki.</p></li>
<li><p>Fixed an edge-case bug of platform-dependent output of <code class="docutils literal notranslate"><span class="pre">strtoi(&quot;&quot;,</span> <span class="pre">base</span> <span class="pre">=</span> <span class="pre">2L)</span></code> on which <code class="docutils literal notranslate"><span class="pre">groupingsets</span></code> had relied, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3267">#3267</a>.</p></li>
</ol>
</div>
<div class="section" id="id24">
<h2>NOTES<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>When data.table loads it now checks its DLL version against the version of its R level code. This is to detect installation issues on Windows when i) the DLL is in use by another R session and ii) the CRAN source version &gt; CRAN binary binary which happens just after a new release (R prompts users to install from source until the CRAN binary is available). This situation can lead to a state where the package’s new R code calls old C code in the old DLL; <a class="reference external" href="https://bugs.r-project.org/show_bug.cgi?id=17478">R#17478</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3056">#3056</a>. This broken state can persist until, hopefully, you experience a strange error caused by the mismatch. Otherwise, wrong results may occur silently. This situation applies to any R package with compiled code not just data.table, is Windows-only, and is long-standing. It has only recently been understood as it typically only occurs during the few days after each new release until binaries are available on CRAN.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">on=</span></code> is provided but not <code class="docutils literal notranslate"><span class="pre">i=</span></code>, a helpful error is now produced rather than silently ignoring <code class="docutils literal notranslate"><span class="pre">on=</span></code>. Thanks to Dirk Eddelbuettel for the idea.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.SDcols=</span></code> is more helpful when passed non-existent columns, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3116">#3116</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3118">#3118</a>. Thanks to Michael Chirico for the investigation and PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update.dev.pkg()</span></code> gains <code class="docutils literal notranslate"><span class="pre">type=</span></code> to specify if update should be made from binaries, sources or both. <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3148">#3148</a>. Thanks to Reino Bruner for the detailed suggestions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setDT()</span></code> improves feedback when passed a ragged list (i.e. where all columns in the list are not the same length), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3121">#3121</a>. Thanks &#64;chuk-yong for highlighting.</p></li>
<li><p>The one and only usage of <code class="docutils literal notranslate"><span class="pre">UNPROTECT_PTR()</span></code> has been removed, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3232">#3232</a>. Thanks to Tomas Kalibera’s investigation and advice here: <a class="reference external" href="https://developer.r-project.org/Blog/public/2018/12/10/unprotecting-by-value/index.html">https://developer.r-project.org/Blog/public/2018/12/10/unprotecting-by-value/index.html</a></p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-11-8-30-sep-2018">
<h1>data.table v1.11.8  (30 Sep 2018)<a class="headerlink" href="#data-table-v1-11-8-30-sep-2018" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id25">
<h2>NEW FEATURES<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> can now read <code class="docutils literal notranslate"><span class="pre">.gz</span></code> and <code class="docutils literal notranslate"><span class="pre">.bz2</span></code> files directly: <code class="docutils literal notranslate"><span class="pre">fread(&quot;file.csv.gz&quot;)</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/717">#717</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3058">#3058</a>. It uses <code class="docutils literal notranslate"><span class="pre">R.utils::decompressFile</span></code> to decompress to a <code class="docutils literal notranslate"><span class="pre">tempfile()</span></code> which is then read by <code class="docutils literal notranslate"><span class="pre">fread()</span></code> in the usual way. For greater speed on large-RAM servers, it is recommended to use ramdisk for temporary files by setting <code class="docutils literal notranslate"><span class="pre">TMPDIR</span></code> to <code class="docutils literal notranslate"><span class="pre">/dev/shm</span></code> before starting R; see <code class="docutils literal notranslate"><span class="pre">?tempdir</span></code>. The decompressed temporary file is removed as soon as <code class="docutils literal notranslate"><span class="pre">fread</span></code> completes even if there is an error reading the file. Reading a remote compressed file in one step will be supported in the next version; e.g. <code class="docutils literal notranslate"><span class="pre">fread(&quot;https://domain.org/file.csv.bz2&quot;)</span></code>.</p></li>
</ol>
</div>
<div class="section" id="id26">
<h2>BUG FIXES<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Joining two keyed tables using <code class="docutils literal notranslate"><span class="pre">on=</span></code> to columns not forming a leading subset of <code class="docutils literal notranslate"><span class="pre">key(i)</span></code> could result in an invalidly keyed result, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3061">#3061</a>. Subsequent queries on the result could then return incorrect results. A warning <code class="docutils literal notranslate"><span class="pre">longer</span> <span class="pre">object</span> <span class="pre">length</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">a</span> <span class="pre">multiple</span> <span class="pre">of</span> <span class="pre">shorter</span> <span class="pre">object</span> <span class="pre">length</span></code> could also occur. Thanks to &#64;renkun-ken for reporting and the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyby=</span></code> on columns for which an index exists now uses the index (new feature 7 in v1.11.6 below) but if an <code class="docutils literal notranslate"><span class="pre">i</span></code> subset is present in the same query then it could segfault, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3062">#3062</a>. Again thanks to &#64;renkun-ken for reporting.</p></li>
<li><p>Assigning an out-of-range integer to an item in a factor column (a rare operation) correctly created an <code class="docutils literal notranslate"><span class="pre">NA</span></code> in that spot with warning, but now no longer also corrupts the variable being assigned, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2984">#2984</a>. Thanks to &#64;radfordneal for reporting and &#64;MarkusBonsch for fixing. Assigning a string which is missing from the factor levels continues to automatically append the string to the factor levels.</p></li>
<li><p>Assigning a sequence to a column using base R methods (e.g. <code class="docutils literal notranslate"><span class="pre">DT[[&quot;foo&quot;]]</span> <span class="pre">=</span> <span class="pre">1:10</span></code>) could cause subsetting to fail with <code class="docutils literal notranslate"><span class="pre">Internal</span> <span class="pre">error</span> <span class="pre">in</span> <span class="pre">subset.c:</span> <span class="pre">column</span> <span class="pre">&lt;n&gt;</span> <span class="pre">is</span> <span class="pre">an</span> <span class="pre">ALTREP</span> <span class="pre">vector</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3051">#3051</a>. Thanks to Michel Lang for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.table</span></code> <code class="docutils literal notranslate"><span class="pre">matrix</span></code> method now properly handles rownames for 0 column data.table output. Thanks &#64;mllg for reporting. Closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3149">#3149</a>.</p></li>
</ol>
</div>
<div class="section" id="id27">
<h2>NOTES<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>The test suite now turns on R’s new <em>R_CHECK_LENGTH_1_LOGIC2</em> to catch when internal use of <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> or <code class="docutils literal notranslate"><span class="pre">||</span></code> encounter arguments of length more than one. Thanks to Hugh Parsonage for implementing and fixing the problems caught by this.</p></li>
<li><p>Some namespace changes have been made with respect to melt, dcast and xts. No change is expected but if you do have any trouble, please file an issue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split.data.table</span></code> was exported in v1.11.6 in addition to being registered using <code class="docutils literal notranslate"><span class="pre">S3method(split,</span> <span class="pre">data.table)</span></code>. The export has been removed again. It had been added because a user said they found it difficult to find, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2920">#2920</a>. But S3 methods are not normally exported explicitly by packages. The proper way to access the <code class="docutils literal notranslate"><span class="pre">split.data.table</span></code> method is to call <code class="docutils literal notranslate"><span class="pre">split(DT)</span></code> where <code class="docutils literal notranslate"><span class="pre">DT</span></code> is a <code class="docutils literal notranslate"><span class="pre">data.table</span></code>. The generic (<code class="docutils literal notranslate"><span class="pre">base::split</span></code> in this case) then dispatches to the <code class="docutils literal notranslate"><span class="pre">split.data.table</span></code> method. v1.11.6 was not on CRAN very long (1 week) so we think it’s better to revert this change quickly. To know what methods exist, R provides the <code class="docutils literal notranslate"><span class="pre">methods()</span></code> function.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">methods</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>               <span class="c1"># all the methods for the split generic</span>
<span class="nf">methods</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="s">&quot;data.table&quot;</span><span class="p">)</span>  <span class="c1"># all the generics that data.table has a method for (47 currently)</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-11-6-19-sep-2018">
<h1>data.table v1.11.6  (19 Sep 2018)<a class="headerlink" href="#data-table-v1-11-6-19-sep-2018" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id28">
<h2>NEW FEATURES<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>For convenience when some of the files in <code class="docutils literal notranslate"><span class="pre">fnams</span></code> are empty in <code class="docutils literal notranslate"><span class="pre">rbindlist(lapply(fnams,fread))</span></code>, <code class="docutils literal notranslate"><span class="pre">fread</span></code> now reads empty input as a null-data.table with warning rather than error, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2898">#2898</a>. For consistency, <code class="docutils literal notranslate"><span class="pre">fwrite(data.table(NULL))</span></code> now creates an empty file and warns instead of error, too.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setcolorder(DT)</span></code> without further arguments now defaults to moving the key columns to be first, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2895">#2895</a>. Thanks to &#64;jsams for the PR.</p></li>
<li><p>Attempting to subset on <code class="docutils literal notranslate"><span class="pre">col</span></code> when the column is actually called <code class="docutils literal notranslate"><span class="pre">Col</span></code> will still error, but the error message will helpfully suggest similarly-spelled columns, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2887">#2887</a>. This is experimental, applies just to <code class="docutils literal notranslate"><span class="pre">i</span></code> currently, and we look forward to feedback. Thanks to Michael Chirico for the suggestion and PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> has always accepted literal data; e.g. <code class="docutils literal notranslate"><span class="pre">fread(&quot;A,B\n1,2\n3,4&quot;)</span></code>. It now gains explicit <code class="docutils literal notranslate"><span class="pre">text=</span></code>; e.g. <code class="docutils literal notranslate"><span class="pre">fread(text=&quot;A,B\n1,2\n3,4&quot;)</span></code>. Unlike the first general purpose <code class="docutils literal notranslate"><span class="pre">input=</span></code> argument, the <code class="docutils literal notranslate"><span class="pre">text=</span></code> argument accepts multi-line input; e.g. <code class="docutils literal notranslate"><span class="pre">fread(text=c(&quot;A,B&quot;,&quot;1,2&quot;,&quot;3,4&quot;))</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1423">#1423</a>. Thanks to Douglas Clark for the request and Hugh Parsonage for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> has always accepted system commands; e.g. <code class="docutils literal notranslate"><span class="pre">fread(&quot;grep</span> <span class="pre">blah</span> <span class="pre">file.txt&quot;)</span></code>. It now gains explicit <code class="docutils literal notranslate"><span class="pre">cmd=</span></code>; e.g. <code class="docutils literal notranslate"><span class="pre">fread(cmd=&quot;grep</span> <span class="pre">blah</span> <span class="pre">file.txt&quot;)</span></code>. Further, if and only if <code class="docutils literal notranslate"><span class="pre">input=</span></code> is a system command and a variable was used to hold that command (<code class="docutils literal notranslate"><span class="pre">fread(someCommand)</span></code> not <code class="docutils literal notranslate"><span class="pre">fread(&quot;grep</span> <span class="pre">blah</span> <span class="pre">file.txt&quot;)</span></code>) or a variable is used to construct it (<code class="docutils literal notranslate"><span class="pre">fread(paste(&quot;grep&quot;,variable,&quot;file.txt&quot;))</span></code>), a message is now printed suggesting <code class="docutils literal notranslate"><span class="pre">cmd=</span></code>. This is to inform all users that there is a potential security concern if you are i) creating apps, and ii) your app takes input from a public user who could be malicious, and iii) input from the malicious user (such as a filename) is passed by your app to <code class="docutils literal notranslate"><span class="pre">fread()</span></code>, and iv) your app in not running in a protected environment. If all 4 conditions hold then the malicious user could provide a system command instead of a filename which <code class="docutils literal notranslate"><span class="pre">fread()</span></code> would run, and that would be a problem too. If the app is not running in a protected environment (e.g. app is running as root) then this could do damage or obtain data you did not intend. Public facing apps should be running with limited operating system permission so that any breach from any source is contained. We agree with <a class="reference external" href="https://lkml.org/lkml/2017/11/21/356">Linus Torvald’s advice</a> on this which boils down to: “when addressing security concerns the first step is do no harm, just inform”. If you aren’t creating apps or apis that could have a malicious user then there is no risk but we can’t distinguish you so we have to inform everyone. Please change to <code class="docutils literal notranslate"><span class="pre">fread(cmd=...)</span></code> at your leisure. The new message can be suppressed with <code class="docutils literal notranslate"><span class="pre">options(datatable.fread.input.cmd.message=FALSE)</span></code>. Passing system commands to <code class="docutils literal notranslate"><span class="pre">fread()</span></code> continues to be recommended and encouraged and is widely used; e.g. via the techniques gathered together in the book <a class="reference external" href="https://www.datascienceatthecommandline.com/">Data Science at the Command Line</a>. A <code class="docutils literal notranslate"><span class="pre">warning()</span></code> is too strong because best-practice for production systems is to set <code class="docutils literal notranslate"><span class="pre">options(warn=2)</span></code> to tolerate no warnings. Such production systems have no user input and so there is no security risk; we don’t want to do harm by breaking production systems via a <code class="docutils literal notranslate"><span class="pre">warning()</span></code> which gets turned into an error by <code class="docutils literal notranslate"><span class="pre">options(warn=2)</span></code>. Now that we have informed all users, we request feedback. There are 3 options for future releases: i) remove the message, ii) leave the message in place, iii) upgrade the message to warning and then eventually error. The default choice is the middle one: leave the message in place.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">options(datatable.CJ.names=TRUE)</span></code> changes <code class="docutils literal notranslate"><span class="pre">CJ()</span></code> to auto-name its inputs exactly as <code class="docutils literal notranslate"><span class="pre">data.table()</span></code> does, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1596">#1596</a>. Thanks &#64;franknarf1 for the suggestion. Current default is <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>; i.e. no change. The option’s default will be changed to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> in v1.12.0 and then eventually the option will be removed. Any code that depends on <code class="docutils literal notranslate"><span class="pre">CJ(x,y)$V1</span></code> will need to be changed to <code class="docutils literal notranslate"><span class="pre">CJ(x,y)$x</span></code> and is more akin to a bug fix due to the inconsistency with <code class="docutils literal notranslate"><span class="pre">data.table()</span></code>.</p></li>
<li><p>If an appropriate index exists, <code class="docutils literal notranslate"><span class="pre">keyby=</span></code> will now use it. For example, given <code class="docutils literal notranslate"><span class="pre">setindex(DT,colA,colB)</span></code>, both <code class="docutils literal notranslate"><span class="pre">DT[,j,keyby=colA]</span></code> (a leading subset of the index columns) and <code class="docutils literal notranslate"><span class="pre">DT[,j,keyby=.(colA,colB)]</span></code> will use the index, but not <code class="docutils literal notranslate"><span class="pre">DT[,j,keyby=.(colB,colA)]</span></code>. The option <code class="docutils literal notranslate"><span class="pre">options(datatable.use.index=FALSE)</span></code> will turn this feature off. Please always use <code class="docutils literal notranslate"><span class="pre">keyby=</span></code> unless you wish to retain the order of groups by first-appearance order (in which case use <code class="docutils literal notranslate"><span class="pre">by=</span></code>). Also, both <code class="docutils literal notranslate"><span class="pre">keyby=</span></code> and <code class="docutils literal notranslate"><span class="pre">by=</span></code> already used the key where possible but are now faster when using just the first column of the key. As usual, setting <code class="docutils literal notranslate"><span class="pre">verbose=TRUE</span></code> either per-query or globally using <code class="docutils literal notranslate"><span class="pre">options(datatable.verbose=TRUE)</span></code> will report what’s being done internally.</p></li>
</ol>
</div>
<div class="section" id="id29">
<h2>BUG FIXES<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fread</span></code> now respects the order of columns passed to <code class="docutils literal notranslate"><span class="pre">select=</span></code> when column numbers are used, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2986">#2986</a>. It already respected the order when column names are used. Thanks &#64;privefl for raising the issue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gmin</span></code> and <code class="docutils literal notranslate"><span class="pre">gmax</span></code> no longer fail on <em>ordered</em> factors, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1947">#1947</a>. Thanks to &#64;mcieslik-mctp for identifying and &#64;mbacou for the nudge.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.ITime.character</span></code> now properly handles NA when attempting to detect the format of non-NA values in vector. Thanks &#64;polyjian for reporting, closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2940">#2940</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.matrix(DT,</span> <span class="pre">rownames=&quot;id&quot;)</span></code> now works when <code class="docutils literal notranslate"><span class="pre">DT</span></code> has a single row, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2930">#2930</a>. Thanks to &#64;malcook for reporting and &#64;sritchie73 for fixing. The root cause was the dual meaning of the <code class="docutils literal notranslate"><span class="pre">rownames=</span></code> argument: i) a single column name/number (most common), or ii) rowname values length 1 for the single row. For clarity and safety, <code class="docutils literal notranslate"><span class="pre">rownames.value=</span></code> has been added. Old usage (i.e. <code class="docutils literal notranslate"><span class="pre">length(rownames)&gt;1</span></code>) continues to work for now but will issue a warning in a future release, and then error in a release after that.</p></li>
<li><p>Fixed regression in v1.11.0 (May 2018) caused by PR <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2389">#2389</a> which introduced partial key retainment on <code class="docutils literal notranslate"><span class="pre">:=</span></code> assigns. This broke the joining logic that assumed implicitly that assigning always drops keys completely. Consequently, join and subset results could be wrong when matching character to factor columns with existing keys, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2881">#2881</a>. Thanks to &#64;ddong63 for reporting and to &#64;MarkusBonsch for fixing. Missing test added to ensure this doesn’t arise again.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.IDate.numeric</span></code> no longer ignores “origin”, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2880">#2880</a>. Thanks to David Arenburg for reporting and fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.ITime.times</span></code> was rounding fractional seconds while other methods were truncating, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2870">#2870</a>. The <code class="docutils literal notranslate"><span class="pre">as.ITime</span></code> method gains <code class="docutils literal notranslate"><span class="pre">ms=</span></code> taking <code class="docutils literal notranslate"><span class="pre">&quot;truncate&quot;</span></code> (default), <code class="docutils literal notranslate"><span class="pre">&quot;nearest&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;ceil&quot;</span></code>. Thanks to &#64;rossholmberg for reporting and Michael Chirico for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> now writes POSIXct dates after 2038 correctly, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2995">#2995</a>. Thanks to Manfred Zorn for reporting and Philippe Chataignon for the PR fixing it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fsetequal</span></code> gains the <code class="docutils literal notranslate"><span class="pre">all</span></code> argument to make it consistent with the other set operator functions <code class="docutils literal notranslate"><span class="pre">funion</span></code>, <code class="docutils literal notranslate"><span class="pre">fsetdiff</span></code> and <code class="docutils literal notranslate"><span class="pre">fintersect</span></code> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2968">#2968</a>. When <code class="docutils literal notranslate"><span class="pre">all</span> <span class="pre">=</span> <span class="pre">FALSE</span></code> <code class="docutils literal notranslate"><span class="pre">fsetequal</span></code> will treat rows as elements in a set when checking whether two <code class="docutils literal notranslate"><span class="pre">data.tables</span></code> are equal (i.e. duplicate rows will be ignored). For now the default value is <code class="docutils literal notranslate"><span class="pre">all</span> <span class="pre">=</span> <span class="pre">TRUE</span></code> for backwards compatibility, but this will be changed to <code class="docutils literal notranslate"><span class="pre">all</span> <span class="pre">=</span> <span class="pre">FALSE</span></code> in a future release to make it consistent with the other set operation functions. Thanks to &#64;franknarf1 for reporting and &#64;sritchie73 for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fintersect</span></code> failed on tables with a column called <code class="docutils literal notranslate"><span class="pre">y</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3034">#3034</a>. Thanks to Maxim Nazarov for reporting.</p></li>
<li><p>Compilation fails in AIX because NAN and INFINITY macros definition in AIX make them not constant literals, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3043">#3043</a>. Thanks to Ayappan for reporting and fixing.</p></li>
<li><p>The introduction of altrep in R 3.5.0 caused some performance regressions of about 20% in some cases, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2962">#2962</a>. Investigating this led to some improvements to grouping which are faster than before R 3.5.0 in some cases. Thanks to Nikolay S. for reporting. The work to accomodate altrep is not complete but it is better and it is highly recommended to upgrade to this update.</p></li>
<li><p>Fixed 7 memory faults thanks to CRAN’s <a class="reference external" href="https://github.com/kalibera/rchk"><code class="docutils literal notranslate"><span class="pre">rchk</span></code></a> tool by Tomas Kalibera, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/3033">#3033</a>.</p></li>
</ol>
</div>
<div class="section" id="id30">
<h2>NOTES<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>The type coercion warning message has been improved, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2989">#2989</a>. Thanks to &#64;sarahbeeysian on Twitter for highlighting. For example, given the follow statements:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span> <span class="o">=</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>
<span class="n">DT</span><span class="p">[</span><span class="m">2</span><span class="p">,</span> <span class="n">id</span><span class="o">:=</span><span class="s">&quot;foo&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>the warning message has changed from :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Coerced</span> <span class="n">character</span> <span class="n">RHS</span> <span class="n">to</span> <span class="n">integer</span> <span class="n">to</span> <span class="n">match</span> <span class="n">the</span> <span class="n">column</span><span class="s1">&#39;s type. Either change the target column</span>
<span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="n">to</span> <span class="n">character</span> <span class="n">first</span> <span class="p">(</span><span class="n">by</span> <span class="n">creating</span> <span class="n">a</span> <span class="n">new</span> <span class="n">character</span> <span class="n">vector</span> <span class="n">length</span> <span class="mi">3</span> <span class="p">(</span><span class="n">nrows</span> <span class="n">of</span> <span class="n">entire</span> <span class="n">table</span><span class="p">)</span> <span class="ow">and</span>
<span class="n">assign</span> <span class="n">that</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span> <span class="s1">&#39;replace&#39;</span> <span class="n">column</span><span class="p">),</span> <span class="ow">or</span> <span class="n">coerce</span> <span class="n">RHS</span> <span class="n">to</span> <span class="n">integer</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="mi">1</span><span class="n">L</span><span class="p">,</span> <span class="n">NA_</span><span class="p">[</span><span class="n">real</span><span class="o">|</span><span class="n">integer</span><span class="p">]</span><span class="n">_</span><span class="p">,</span> <span class="k">as</span><span class="o">.*</span><span class="p">,</span>
<span class="n">etc</span><span class="p">)</span> <span class="n">to</span> <span class="n">make</span> <span class="n">your</span> <span class="n">intent</span> <span class="n">clear</span> <span class="ow">and</span> <span class="k">for</span> <span class="n">speed</span><span class="o">.</span> <span class="n">Or</span><span class="p">,</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">column</span> <span class="nb">type</span> <span class="n">correctly</span> <span class="n">up</span> <span class="n">front</span> <span class="n">when</span> <span class="n">you</span>
<span class="n">create</span> <span class="n">the</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">stick</span> <span class="n">to</span> <span class="n">it</span><span class="p">,</span> <span class="n">please</span><span class="o">.</span>
</pre></div>
</div>
<p>to :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Coerced character RHS to integer to match the type of the target column (column 1 named &#39;id&#39;). If
the target column&#39;s type integer is correct, it&#39;s best for efficiency to avoid the coercion and
create the RHS as type integer. To achieve that consider the L postfix: typeof(0L) vs typeof(0),
and typeof(NA) vs typeof(NA_integer_) vs typeof(NA_real_). Wrapping the RHS with as.integer() will
avoid this warning but still perform the coercion. If the target column&#39;s type is not correct, it
is best to revisit where the DT was created and fix the column type there; e.g., by using
colClasses= in fread(). Otherwise, you can change the column type now by plonking a new column (of
the desired type) over the top of it; e.g. DT[, `id`:=as.character(`id`)]. If the RHS of := has
nrow(DT) elements then the assignment is called a column plonk and is the way to change a column&#39;s
type. Column types can be observed with sapply(DT,typeof).
</pre></div>
</div>
<p>Further, if a coercion from double to integer is performed, fractional data such as 3.14 is now detected and the truncation to 3 is warned about if and only if truncation has occurred.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span> <span class="o">=</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>
<span class="n">DT</span><span class="p">[</span><span class="m">2</span><span class="p">,</span> <span class="n">v</span><span class="o">:=</span><span class="m">3.14</span><span class="p">]</span>
<span class="n">Warning</span> <span class="n">message</span><span class="o">:</span>
  <span class="n">Coerced</span> <span class="n">double</span> <span class="n">RHS</span> <span class="n">to</span> <span class="n">integer</span> <span class="n">to</span> <span class="n">match</span> <span class="n">the</span> <span class="n">type</span> <span class="n">of</span> <span class="n">the</span> <span class="n">target</span> <span class="nf">column </span><span class="p">(</span><span class="n">column</span> <span class="m">1</span> <span class="n">named</span> <span class="s">&#39;v&#39;</span><span class="p">)</span><span class="n">.</span> <span class="n">One</span>
  <span class="n">or</span> <span class="n">more</span> <span class="n">RHS</span> <span class="n">values</span> <span class="n">contain</span> <span class="n">fractions</span> <span class="n">which</span> <span class="n">have</span> <span class="n">been</span> <span class="n">lost</span><span class="p">;</span> <span class="n">e.g.</span> <span class="n">item</span> <span class="m">1</span> <span class="n">with</span> <span class="n">value</span> <span class="m">3.140000</span> <span class="n">has</span>
  <span class="n">been</span> <span class="n">truncated</span> <span class="n">to</span> <span class="m">3</span><span class="n">.</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">split.data.table</span></code> method is now properly exported, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2920">#2920</a>. But we don’t recommend it because <code class="docutils literal notranslate"><span class="pre">split</span></code> copies all the pieces into new memory.</p></li>
<li><p>Setting indices on columns which are part of the key will now create those indices.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hour</span></code>, <code class="docutils literal notranslate"><span class="pre">minute</span></code>, and <code class="docutils literal notranslate"><span class="pre">second</span></code> utility functions use integer arithmetic when the input is already (explicitly) UTC-based <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> for 4-10x speedup vs. using <code class="docutils literal notranslate"><span class="pre">as.POSIXlt</span></code>.</p></li>
<li><p>Error added for incorrect usage of <code class="docutils literal notranslate"><span class="pre">%between%</span></code>, with some helpful diagnostic hints, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3014">#3014</a>. Thanks &#64;peterlittlejohn for offering his user experience and providing the impetus.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-11-4-27-may-2018">
<h1>data.table v1.11.4  (27 May 2018)<a class="headerlink" href="#data-table-v1-11-4-27-may-2018" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>Empty RHS of <code class="docutils literal notranslate"><span class="pre">:=</span></code> is no longer an error when the <code class="docutils literal notranslate"><span class="pre">i</span></code> clause returns no rows to assign to anyway, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2829">#2829</a>. Thanks to &#64;cguill95 for reporting and to &#64;MarkusBonsch for fixing.</p></li>
<li><p>Fixed runaway memory usage with R-devel (R &gt; 3.5.0), <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2882">#2882</a>. Thanks to many people but in particular to Trang Nguyen for making the breakthrough reproducible example, Paul Bailey for liaising, and Luke Tierney for then pinpointing the issue. It was caused by an interaction of two or more data.table threads operating on new compact vectors in the ALTREP framework, such as the sequence <code class="docutils literal notranslate"><span class="pre">1:n</span></code>. This interaction could result in R’s garbage collector turning off, and hence the memory explosion. Problems may occur in R 3.5.0 too but we were only able to reproduce in R &gt; 3.5.0. The R code in data.table’s implementation benefits from ALTREP (<code class="docutils literal notranslate"><span class="pre">for</span></code> loops in R no longer allocate their range vector input, for example) but are not so appropriate as data.table columns. Sequences such as <code class="docutils literal notranslate"><span class="pre">1:n</span></code> are common in test data but not very common in real-world datasets. Therefore, there is no need for data.table to support columns which are ALTREP compact sequences. The <code class="docutils literal notranslate"><span class="pre">data.table()</span></code> function already expanded compact vectors (by happy accident) but <code class="docutils literal notranslate"><span class="pre">setDT()</span></code> did not (it now does). If, somehow, a compact vector still reaches the internal parallel regions, a helpful error will now be generated. If this happens, please report it as a bug.</p></li>
<li><p>Tests 1590.3 &amp; 1590.4 now pass when users run <code class="docutils literal notranslate"><span class="pre">test.data.table()</span></code> on Windows, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2856">#2856</a>. Thanks to Avraham Adler for reporting. Those tests were passing on AppVeyor, win-builder and CRAN’s Windows because <code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">check</span></code> sets <code class="docutils literal notranslate"><span class="pre">LC_COLLATE=C</span></code> as documented in R-exts$1.3.1, whereas by default on Windows <code class="docutils literal notranslate"><span class="pre">LC_COLLATE</span></code> is usually a regional Windows-1252 dialect such as <code class="docutils literal notranslate"><span class="pre">English_United</span> <span class="pre">States.1252</span></code>.</p></li>
<li><p>Around 1 billion very small groups (of size 1 or 2 rows) could result in <code class="docutils literal notranslate"><span class="pre">&quot;Failed</span> <span class="pre">to</span> <span class="pre">realloc</span> <span class="pre">working</span> <span class="pre">memory&quot;</span></code> even when plenty of memory is available, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2777">#2777</a>. Thanks once again to &#64;jsams for the detailed report as a follow up to bug fix 40 in v1.11.0.</p></li>
</ol>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-11-2-08-may-2018">
<h1>data.table v1.11.2  (08 May 2018)<a class="headerlink" href="#data-table-v1-11-2-08-may-2018" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">test.data.table()</span></code> created/overwrote variable <code class="docutils literal notranslate"><span class="pre">x</span></code> in <code class="docutils literal notranslate"><span class="pre">.GlobalEnv</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2828">#2828</a>; i.e. a modification of user’s workspace which is not allowed. Thanks to &#64;etienne-s for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.chron</span></code> methods for <code class="docutils literal notranslate"><span class="pre">IDate</span></code> and <code class="docutils literal notranslate"><span class="pre">ITime</span></code> have been removed, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2825">#2825</a>. <code class="docutils literal notranslate"><span class="pre">as.chron</span></code> still works since <code class="docutils literal notranslate"><span class="pre">IDate</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">Date</span></code>. We are not sure why we had specific methods in the first place. It may have been from a time when <code class="docutils literal notranslate"><span class="pre">IDate</span></code> did not inherit from <code class="docutils literal notranslate"><span class="pre">Date</span></code>, perhaps. Note that we don’t use <code class="docutils literal notranslate"><span class="pre">chron</span></code> ourselves in our own work.</p></li>
<li><p>Fixed <code class="docutils literal notranslate"><span class="pre">SETLENGTH()</span> <span class="pre">cannot</span> <span class="pre">be</span> <span class="pre">applied</span> <span class="pre">to</span> <span class="pre">an</span> <span class="pre">ALTVEC</span> <span class="pre">object</span></code> starting in R-devel (R 3.6.0) on 1 May 2018, a few hours after 1.11.0 was accepted on CRAN, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2820">#2820</a>. Many thanks to Luke Tierney for pinpointing the problem.</p></li>
<li><p>Fixed some rare memory faults in <code class="docutils literal notranslate"><span class="pre">fread()</span></code> and <code class="docutils literal notranslate"><span class="pre">rbindlist()</span></code> found with <code class="docutils literal notranslate"><span class="pre">gctorture2()</span></code> and <a class="reference external" href="https://github.com/kalibera/rchk"><code class="docutils literal notranslate"><span class="pre">rchk</span></code></a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2841">#2841</a>.</p></li>
</ol>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-11-0-01-may-2018">
<h1>data.table v1.11.0  (01 May 2018)<a class="headerlink" href="#data-table-v1-11-0-01-may-2018" title="Permalink to this headline">¶</a></h1>
<div class="section" id="notice-of-intended-future-potential-breaking-changes">
<h2>NOTICE OF INTENDED FUTURE POTENTIAL BREAKING CHANGES<a class="headerlink" href="#notice-of-intended-future-potential-breaking-changes" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code>’s <code class="docutils literal notranslate"><span class="pre">na.strings=</span></code> argument :</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;NA&quot;</span>                                      <span class="c1"># old default</span>
<span class="nf">getOption</span><span class="p">(</span><span class="s">&quot;datatable.na.strings&quot;</span><span class="p">,</span> <span class="s">&quot;NA&quot;</span><span class="p">)</span>   <span class="c1"># this release; i.e. the same; no change yet</span>
<span class="nf">getOption</span><span class="p">(</span><span class="s">&quot;datatable.na.strings&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>     <span class="c1"># future release</span>
</pre></div>
</div>
<p>This option controls how <code class="docutils literal notranslate"><span class="pre">,,</span></code> is read in character columns. It does not affect numeric columns which read <code class="docutils literal notranslate"><span class="pre">,,</span></code> as <code class="docutils literal notranslate"><span class="pre">NA</span></code> regardless. We would like <code class="docutils literal notranslate"><span class="pre">,,</span></code>=&gt;<code class="docutils literal notranslate"><span class="pre">NA</span></code> for consistency with numeric types, and <code class="docutils literal notranslate"><span class="pre">,&quot;&quot;,</span></code>=&gt;empty string to be the standard default for <code class="docutils literal notranslate"><span class="pre">fwrite/fread</span></code> character columns so that <code class="docutils literal notranslate"><span class="pre">fread(fwrite(DT))==DT</span></code> without needing any change to any parameters. <code class="docutils literal notranslate"><span class="pre">fwrite</span></code> has never written <code class="docutils literal notranslate"><span class="pre">NA</span></code> as <code class="docutils literal notranslate"><span class="pre">&quot;NA&quot;</span></code> in case <code class="docutils literal notranslate"><span class="pre">&quot;NA&quot;</span></code> is a valid string in the data; e.g., 2 character id columns sometimes do. Instead, <code class="docutils literal notranslate"><span class="pre">fwrite</span></code> has always written <code class="docutils literal notranslate"><span class="pre">,,</span></code> by default for an <code class="docutils literal notranslate"><span class="pre">&lt;NA&gt;</span></code> in a character columns. The use of R’s <code class="docutils literal notranslate"><span class="pre">getOption()</span></code> allows users to move forward now, using <code class="docutils literal notranslate"><span class="pre">options(datatable.fread.na.strings=&quot;&quot;)</span></code>, or restore old behaviour when the default’s default is changed in future, using <code class="docutils literal notranslate"><span class="pre">options(datatable.fread.na.strings=&quot;NA&quot;)</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> and <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code>’s <code class="docutils literal notranslate"><span class="pre">logical01=</span></code> argument :</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">logical01</span> <span class="o">=</span> <span class="kc">FALSE</span>                         <span class="c1"># old default</span>
<span class="nf">getOption</span><span class="p">(</span><span class="s">&quot;datatable.logical01&quot;</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">)</span>   <span class="c1"># this release; i.e. the same; no change yet</span>
<span class="nf">getOption</span><span class="p">(</span><span class="s">&quot;datatable.logical01&quot;</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">)</span>    <span class="c1"># future release</span>
</pre></div>
</div>
<p>This option controls whether a column of all 0’s and 1’s is read as <code class="docutils literal notranslate"><span class="pre">integer</span></code>, or <code class="docutils literal notranslate"><span class="pre">logical</span></code> directly to avoid needing to change the type afterwards to <code class="docutils literal notranslate"><span class="pre">logical</span></code> or use <code class="docutils literal notranslate"><span class="pre">colClasses</span></code>. <code class="docutils literal notranslate"><span class="pre">0/1</span></code> is smaller and faster than <code class="docutils literal notranslate"><span class="pre">&quot;TRUE&quot;/&quot;FALSE&quot;</span></code>, which can make a significant difference to space and time the more <code class="docutils literal notranslate"><span class="pre">logical</span></code> columns there are. When the default’s default changes to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> for <code class="docutils literal notranslate"><span class="pre">fread</span></code> we do not expect much impact since all arithmetic operators that are currently receiving 0’s and 1’s as type <code class="docutils literal notranslate"><span class="pre">integer</span></code> (think <code class="docutils literal notranslate"><span class="pre">sum()</span></code>) but instead could receive <code class="docutils literal notranslate"><span class="pre">logical</span></code>, would return exactly the same result on the 0’s and 1’s as <code class="docutils literal notranslate"><span class="pre">logical</span></code> type. However, code that is manipulating column types using <code class="docutils literal notranslate"><span class="pre">is.integer</span></code> or <code class="docutils literal notranslate"><span class="pre">is.logical</span></code> on <code class="docutils literal notranslate"><span class="pre">fread</span></code>’s result, could require change. It could be painful if <code class="docutils literal notranslate"><span class="pre">DT[(logical_column)]</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">DT[logical_column==TRUE]</span></code>) changed behaviour due to <code class="docutils literal notranslate"><span class="pre">logical_column</span></code> no longer being type <code class="docutils literal notranslate"><span class="pre">logical</span></code> but <code class="docutils literal notranslate"><span class="pre">integer</span></code>. But that is not the change proposed. The change is the other way around; i.e., a previously <code class="docutils literal notranslate"><span class="pre">integer</span></code> column holding only 0’s and 1’s would now be type <code class="docutils literal notranslate"><span class="pre">logical</span></code>. Since it’s that way around, we believe the scope for breakage is limited. We think a lot of code is converting 0/1 integer columns to logical anyway, either using <code class="docutils literal notranslate"><span class="pre">colClasses=</span></code> or afterwards with an assign. For <code class="docutils literal notranslate"><span class="pre">fwrite</span></code>, the level of breakage depends on the consumer of the output file. We believe <code class="docutils literal notranslate"><span class="pre">0/1</span></code> is a better more standard default choice to move to. See notes below about improvements to <code class="docutils literal notranslate"><span class="pre">fread</span></code>’s sampling for type guessing, and automatic rereading in the rare cases of out-of-sample type surprises.</p>
</li>
</ol>
<p>These options are meant for temporary use to aid your migration, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2652">#2652</a>. You are not meant to set them to the old default and then not migrate your code that is dependent on the default. Either set the argument explicitly so your code is not dependent on the default, or change the code to cope with the new default. Over the next few years we will slowly start to remove these options, warning you if you are using them, and return to a simple default. See the history of NEWS and NEWS.0 for past migrations that have, generally speaking, been successfully managed in this way. For example, at the end of NOTES for this version (below in this file) is a note about the usage of <code class="docutils literal notranslate"><span class="pre">datatable.old.unique.by.key</span></code> now warning, as you were warned it would do over a year ago. When that change was introduced, the default was changed and that option provided an option to restore the old behaviour. These <code class="docutils literal notranslate"><span class="pre">fread</span></code>/<code class="docutils literal notranslate"><span class="pre">fwrite</span></code> changes are even more cautious and not even changing the default’s default yet. Giving you extra warning by way of this notice to move forward. And giving you a chance to object.</p>
</div>
<div class="section" id="id31">
<h2>NEW FEATURES<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code>:</p>
<ul class="simple">
<li><p>Efficiency savings at C level including <strong>parallelization</strong> announced <a class="reference external" href="https://github.com/Rdatatable/data.table/wiki/talks/BARUG_201704_ParallelFread.pdf">here</a>; e.g. a 9GB 2 column integer csv input is <strong>50s down to 12s</strong> to cold load on a 4 core laptop with 16GB RAM and SSD. Run <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">3</span> <span class="pre">&gt;/proc/sys/vm/drop_caches</span></code> first to measure cold load time. Subsequent load time (after file has been cached by OS on the first run) <strong>40s down to 6s</strong>.</p></li>
<li><p>The <a class="reference external" href="https://github.com/Rdatatable/data.table/wiki/Convenience-features-of-fread">fread for small data</a> page has been revised.</p></li>
<li><p>Memory maps lazily; e.g. reading just the first 10 rows with <code class="docutils literal notranslate"><span class="pre">nrow=10</span></code> is <strong>12s down to 0.01s</strong> from cold for the 9GB file. Large files close to your RAM limit may work more reliably too. The progress meter will commence sooner and more consistently.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread</span></code> has always jumped to the middle and to the end of the file for a much improved column type guess. The sample size is increased from 100 rows at 10 jump jump points (1,000 rows) to 100 rows at 100 jumps points (10,000 row sample). In the rare case of there still being out-of-sample type exceptions, those columns are now <em>automatically reread</em> so you don’t have to use <code class="docutils literal notranslate"><span class="pre">colClasses</span></code> yourself.</p></li>
<li><p>Large number of columns support; e.g. <strong>12,000 columns</strong> tested.</p></li>
<li><p><strong>Quoting rules</strong> are more robust and flexible. See point 10 on the wiki page <a class="reference external" href="https://github.com/Rdatatable/data.table/wiki/Convenience-features-of-fread#10-automatic-quote-escape-method-detection-including-no-escape">here</a>.</p></li>
<li><p>Numeric data that has been quoted is now detected and read as numeric.</p></li>
<li><p>The ability to position <code class="docutils literal notranslate"><span class="pre">autostart</span></code> anywhere inside one of multiple tables in a single file is removed with warning. It used to search upwards from that line to find the start of the table based on a consistent number of columns. People appear to be using <code class="docutils literal notranslate"><span class="pre">skip=&quot;string&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">skip=nrow</span></code> to find the header row exactly, which is retained and simpler. It was too difficult to retain search-upwards-autostart together with skipping/filling blank lines, filling incomplete rows and parallelization too. If there is any header info above the column names, it is still auto detected and auto skipped (particularly useful when loading a set of files where the column names start on different lines due to a varying height messy header).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dec=','</span></code> is now implemented directly so there is no dependency on locale. The options <code class="docutils literal notranslate"><span class="pre">datatable.fread.dec.experiment</span></code> and <code class="docutils literal notranslate"><span class="pre">datatable.fread.dec.locale</span></code> have been removed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\\r\\r\\n</span></code> line endings are now handled such as produced by <code class="docutils literal notranslate"><span class="pre">base::download.file()</span></code> when it doubles up <code class="docutils literal notranslate"><span class="pre">\\r</span></code>. Other rare line endings (<code class="docutils literal notranslate"><span class="pre">\\r</span></code> and <code class="docutils literal notranslate"><span class="pre">\\n\\r</span></code>) are now more robust.</p></li>
<li><p>Mixed line endings are now handled; e.g. a file formed by concatenating a Unix file and a Windows file so that some lines end with <code class="docutils literal notranslate"><span class="pre">\\n</span></code> while others end with <code class="docutils literal notranslate"><span class="pre">\\r\\n</span></code>.</p></li>
<li><p>Improved automatic detection of whether the first row is column names by comparing the types of the fields on the first row against the column types ascertained by the 10,000 rows sample (or <code class="docutils literal notranslate"><span class="pre">colClasses</span></code> if provided). If a numeric column has a string value at the top, then column names are deemed present.</p></li>
<li><p>Detects GB-18030 and UTF-16 encodings and in verbose mode prints a message about BOM detection.</p></li>
<li><p>Detects and ignores trailing ^Z end-of-file control character sometimes created on MS DOS/Windows, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1612">#1612</a>. Thanks to Gergely Daróczi for reporting and providing a file.</p></li>
<li><p>Added ability to recognize and parse hexadecimal floating point numbers, as used for example in Java. Thanks for &#64;scottstanfield <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2316">#2316</a> for the report.</p></li>
<li><p>Now handles floating-point NaN values in a wide variety of formats, including <code class="docutils literal notranslate"><span class="pre">NaN</span></code>, <code class="docutils literal notranslate"><span class="pre">sNaN</span></code>, <code class="docutils literal notranslate"><span class="pre">1.#QNAN</span></code>, <code class="docutils literal notranslate"><span class="pre">NaN1234</span></code>, <code class="docutils literal notranslate"><span class="pre">#NUM!</span></code> and others, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1800">#1800</a>. Thanks to Jori Liesenborgs for highlighting and the PR.</p></li>
<li><p>If negative numbers are passed to <code class="docutils literal notranslate"><span class="pre">select=</span></code> the out-of-range error now suggests <code class="docutils literal notranslate"><span class="pre">drop=</span></code> instead, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2423">#2423</a>. Thanks to Michael Chirico for the suggestion.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep=NULL</span></code> or <code class="docutils literal notranslate"><span class="pre">sep=&quot;&quot;</span></code> (i.e., no column separator) can now be used to specify single column input reliably like <code class="docutils literal notranslate"><span class="pre">base::readLines</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1616">#1616</a>. <code class="docutils literal notranslate"><span class="pre">sep='\\n'</span></code> still works (even on Windows where line ending is actually <code class="docutils literal notranslate"><span class="pre">\\r\\n</span></code>) but <code class="docutils literal notranslate"><span class="pre">NULL</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> are now documented and recommended. Thanks to Dmitriy Selivanov for the pull request and many others for comments. As before, <code class="docutils literal notranslate"><span class="pre">sep=NA</span></code> is not valid; use the default <code class="docutils literal notranslate"><span class="pre">&quot;auto&quot;</span></code> for automatic separator detection. <code class="docutils literal notranslate"><span class="pre">sep='\\n'</span></code> is now deprecated and in future will start to warn when used.</p></li>
<li><p>Single-column input with blank lines is now valid and the blank lines are significant (representing <code class="docutils literal notranslate"><span class="pre">NA</span></code>). The blank lines are significant even at the very end, which may be surprising on first glance. The change is so that <code class="docutils literal notranslate"><span class="pre">fread(fwrite(DT))==DT</span></code> for single-column inputs containing <code class="docutils literal notranslate"><span class="pre">NA</span></code> which are written as blank. There is no change when <code class="docutils literal notranslate"><span class="pre">ncol&gt;1</span></code>; i.e., input stops with detailed warning at the first blank line, because a blank line when <code class="docutils literal notranslate"><span class="pre">ncol&gt;1</span></code> is invalid input due to no separators being present. Thanks to &#64;skanskan, Michael Chirico, &#64;franknarf1 and Pasha for the testing and discussions, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2106">#2106</a>.</p></li>
<li><p>Too few column names are now auto filled with default column names, with warning, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1625">#1625</a>. If there is just one missing column name it is guessed to be for the first column (row names or an index), otherwise the column names are filled at the end. Similarly, too many column names now automatically sets <code class="docutils literal notranslate"><span class="pre">fill=TRUE</span></code>, with warning.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skip=</span></code> and <code class="docutils literal notranslate"><span class="pre">nrow=</span></code> are more reliable and are no longer affected by invalid lines outside the range specified. Thanks to Ziyad Saeed and Kyle Chung for reporting, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1267">#1267</a>.</p></li>
<li><p>Ram disk (<code class="docutils literal notranslate"><span class="pre">/dev/shm</span></code>) is no longer used for the output of system command input. Although faster when it worked, it was causing too many device full errors; e.g., <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1139">#1139</a> and <a class="reference external" href="https://github.com/sdparekh/zUMIs/issues/19">zUMIs/19</a>. Thanks to Kyle Chung for reporting. Standard <code class="docutils literal notranslate"><span class="pre">tempdir()</span></code> is now used. If you wish to use ram disk, set TEMPDIR to <code class="docutils literal notranslate"><span class="pre">/dev/shm</span></code>; see <code class="docutils literal notranslate"><span class="pre">?tempdir</span></code>.</p></li>
<li><p>Detecting whether a very long input string is a file name or data is now much faster, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2531">#2531</a>. Many thanks to &#64;javrucebo for the detailed report, benchmarks and suggestions.</p></li>
<li><p>A column of <code class="docutils literal notranslate"><span class="pre">TRUE/FALSE</span></code>s is ok, as well as <code class="docutils literal notranslate"><span class="pre">True/False</span></code>s and <code class="docutils literal notranslate"><span class="pre">true/false</span></code>s, but mixing styles (e.g. <code class="docutils literal notranslate"><span class="pre">TRUE/false</span></code>) is not and will be read as type <code class="docutils literal notranslate"><span class="pre">character</span></code>.</p></li>
<li><p>New argument <code class="docutils literal notranslate"><span class="pre">index</span></code> to compliment the existing <code class="docutils literal notranslate"><span class="pre">key</span></code> argument for applying secondary orderings out of the box for convenience, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2633">#2633</a>.</p></li>
<li><p>A warning is now issued whenever incorrectly quoted fields have been detected and fixed using a non-standard quote rule. <code class="docutils literal notranslate"><span class="pre">fread</span></code> has always used these advanced rules but now it warns that it is using them. Most file writers correctly quote fields if the field contains the field separator, but a common error is not to also quote fields that contain a quote and then escape those quotes, particularly if that quote occurs at the start of the field. The ability to detect and fix such files is referred to as self-healing. Ambiguities are resolved using the knowledge that the number of columns is constant, and therefore this ability is not available when <code class="docutils literal notranslate"><span class="pre">fill=TRUE</span></code>. This feature can be improved in future by using column type consistency as well as the number of fields. For example:</p></li>
</ul>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">txt</span> <span class="o">=</span> <span class="s">&#39;A,B\n1,hello\n2,&quot;howdy&quot; said Joe\n3,bonjour\n&#39;</span>
<span class="nf">cat</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
<span class="c1"># A,B</span>
<span class="c1"># 1,hello</span>
<span class="c1"># 2,&quot;howdy&quot; said Joe</span>
<span class="c1"># 3,bonjour</span>
<span class="nf">fread</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
       <span class="n">A</span>                <span class="n">B</span>
   <span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">char</span><span class="o">&gt;</span>
<span class="m">1</span><span class="o">:</span>     <span class="m">1</span>            <span class="n">hello</span>
<span class="m">2</span><span class="o">:</span>     <span class="m">2</span> <span class="s">&quot;howdy&quot;</span> <span class="n">said</span> <span class="n">Joe</span>
<span class="m">3</span><span class="o">:</span>     <span class="m">3</span>          <span class="n">bonjour</span>
<span class="n">Warning</span> <span class="n">message</span><span class="o">:</span>
<span class="n">In</span> <span class="nf">fread</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="o">:</span> <span class="n">Found</span> <span class="n">and</span> <span class="n">resolved</span> <span class="n">improper</span> <span class="n">quoting</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Many thanks to &#64;yaakovfeldman, Guillermo Ponce, Arun Srinivasan, Hugh Parsonage, Mark Klik, Pasha Stetsenko, Mahyar K, Tom Crockett, &#64;cnoelke, &#64;qinjs, &#64;etienne-s, Mark Danese, Avraham Adler, &#64;franknarf1, &#64;MichaelChirico, &#64;tdhock, Luke Tierney, Ananda Mahto, &#64;memoryfull, &#64;brandenkmurray for testing dev and reporting these regressions before release to CRAN: #1464, #1671, #1888, #1895, #2070, #2073, #2087, #2091, #2092, #2107, #2118, #2123, #2167, #2194, #2196, #2201, #2222, #2228, #2238, #2246, #2251, #2265, #2267, #2285, #2287, #2299, #2322, #2347, #2352, #2370, #2371, #2395, #2404, #2446, #2453, #2457, #2464, #2481, #2499, #2512, #2515, #2516, #2518, #2520, #2523, #2526, #2535, #2542, #2548, #2561, #2600, #2625, #2666, #2697, #2735, #2744.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code>:</p>
<ul class="simple">
<li><p>empty strings are now always quoted (<code class="docutils literal notranslate"><span class="pre">,&quot;&quot;,</span></code>) to distinguish them from <code class="docutils literal notranslate"><span class="pre">NA</span></code> which by default is still empty (<code class="docutils literal notranslate"><span class="pre">,,</span></code>) but can be changed using <code class="docutils literal notranslate"><span class="pre">na=</span></code> as before. If <code class="docutils literal notranslate"><span class="pre">na=</span></code> is provided and <code class="docutils literal notranslate"><span class="pre">quote=</span></code> is the default <code class="docutils literal notranslate"><span class="pre">'auto'</span></code> then <code class="docutils literal notranslate"><span class="pre">quote=</span></code> is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> so that if the <code class="docutils literal notranslate"><span class="pre">na=</span></code> value occurs in the data, it can be distinguished from <code class="docutils literal notranslate"><span class="pre">NA</span></code>. Thanks to Ethan Welty for the request <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2214">#2214</a> and Pasha for the code change and tests, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2215">#2215</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logical01</span></code> has been added and the old name <code class="docutils literal notranslate"><span class="pre">logicalAsInt</span></code> retained. Pease move to the new name when convenient for you. The old argument name (<code class="docutils literal notranslate"><span class="pre">logicalAsInt</span></code>) will slowly be deprecated over the next few years. The default is unchanged: <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, so <code class="docutils literal notranslate"><span class="pre">logical</span></code> is still written as <code class="docutils literal notranslate"><span class="pre">&quot;TRUE&quot;</span></code>/<code class="docutils literal notranslate"><span class="pre">&quot;FALSE&quot;</span></code> in full by default. We intend to change the default’s default in future to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>; see the notice at the top of these release notes.</p></li>
</ul>
</li>
<li><p>Added helpful message when subsetting by a logical column without wrapping it in parentheses, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1844">#1844</a>. Thanks &#64;dracodoc for the suggestion and &#64;MichaelChirico for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tables</span></code> gains <code class="docutils literal notranslate"><span class="pre">index</span></code> argument for supplementary metadata about <code class="docutils literal notranslate"><span class="pre">data.table</span></code>s in memory (or any optionally specified environment), part of <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1648">#1648</a>. Thanks due variously to &#64;jangorecki, &#64;rsaporta, &#64;MichaelChirico for ideas and work towards PR.</p></li>
<li><p>Improved auto-detection of <code class="docutils literal notranslate"><span class="pre">character</span></code> inputs’ formats to <code class="docutils literal notranslate"><span class="pre">as.ITime</span></code> to mirror the logic in <code class="docutils literal notranslate"><span class="pre">as.POSIXlt.character</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1383">#1383</a> Thanks &#64;franknarf1 for identifying a discrepancy and &#64;MichaelChirico for investigating.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setcolorder()</span></code> now accepts less than <code class="docutils literal notranslate"><span class="pre">ncol(DT)</span></code> columns to be moved to the front, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/592">#592</a>. Thanks &#64;MichaelChirico for the PR. This also incidentally fixed <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2007">#2007</a> whereby explicitly setting <code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">=</span> <span class="pre">NULL</span></code> in <code class="docutils literal notranslate"><span class="pre">fread</span></code> errored; thanks to &#64;rcapell for reporting that and &#64;dselivanov and &#64;MichaelChirico for investigating and providing a new test.</p></li>
<li><p>Three new <em>Grouping Sets</em> functions: <code class="docutils literal notranslate"><span class="pre">rollup</span></code>, <code class="docutils literal notranslate"><span class="pre">cube</span></code> and <code class="docutils literal notranslate"><span class="pre">groupingsets</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1377">#1377</a>. Allows to aggregation on various grouping levels at once producing sub-totals and grand total.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.table()</span></code> gains new method for <code class="docutils literal notranslate"><span class="pre">array</span></code>s to return a useful data.table, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1418">#1418</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">print.data.table()</span></code> (all via master issue  <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1523">#1523</a>):</p>
<ul class="simple">
<li><p>gains <code class="docutils literal notranslate"><span class="pre">print.keys</span></code> argument, <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> by default, which displays the keys and/or indices (secondary keys) of a <code class="docutils literal notranslate"><span class="pre">data.table</span></code>. Thanks &#64;MichaelChirico for the PR, Yike Lu for the suggestion and Arun for honing that idea to its present form.</p></li>
<li><p>gains <code class="docutils literal notranslate"><span class="pre">col.names</span></code> argument, <code class="docutils literal notranslate"><span class="pre">&quot;auto&quot;</span></code> by default, which toggles which registers of column names to include in printed output. <code class="docutils literal notranslate"><span class="pre">&quot;top&quot;</span></code> forces <code class="docutils literal notranslate"><span class="pre">data.frame</span></code>-like behavior where column names are only ever included at the top of the output, as opposed to the default behavior which appends the column names below the output as well for longer (&gt;20 rows) tables. <code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code> shuts down column name printing altogether. Thanks &#64;MichaelChirico for the PR, Oleg Bondar for the suggestion, and Arun for guiding commentary.</p></li>
<li><p>list columns would print the first 6 items in each cell followed by a comma if there are more than 6 in that cell. Now it ends “,…” to make it clearer, part of <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1523">#1523</a>. Thanks to &#64;franknarf1 for drawing attention to an issue raised on Stack Overflow by &#64;TMOTTM <a class="reference external" href="https://stackoverflow.com/q/47679701">here</a>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">setkeyv</span></code> accelerated if key already exists <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2331">#2331</a>. Thanks to &#64;MarkusBonsch for the PR.</p></li>
<li><p>Keys and indexes are now partially retained up to the key column assigned to with ‘:=’ <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2372">#2372</a>. They used to be dropped completely if any one of the columns was affected by <code class="docutils literal notranslate"><span class="pre">:=</span></code>. Tanks to &#64;MarkusBonsch for the PR.</p></li>
<li><p>Faster <code class="docutils literal notranslate"><span class="pre">as.IDate</span></code> and <code class="docutils literal notranslate"><span class="pre">as.ITime</span></code> methods for <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> and <code class="docutils literal notranslate"><span class="pre">numeric</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1392">#1392</a>. Thanks to Jan Gorecki for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unique(DT)</span></code> now returns <code class="docutils literal notranslate"><span class="pre">DT</span></code> early when there are no duplicates to save RAM, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2013">#2013</a>. Thanks to Michael Chirico for the PR, and thanks to &#64;mgahan for pointing out a reversion in <code class="docutils literal notranslate"><span class="pre">na.omit.data.table</span></code> before release, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2660#issuecomment-371027948">#2660</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uniqueN()</span></code> is now faster on logical vectors. Thanks to Hugh Parsonage for <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2648">PR#2648</a>.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="m">1e9</span>
                                   <span class="c1">#   was      now</span>
<span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="nf">rep</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>   <span class="c1">#</span>
<span class="nf">uniqueN</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="m">3</span>                    <span class="c1">#  5.4s    0.00s</span>
<span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="nf">rep</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="kc">NA</span><span class="p">)</span>       <span class="c1">#</span>
<span class="nf">uniqueN</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> <span class="o">==</span> <span class="m">2</span>         <span class="c1">#  5.4s    0.00s</span>
<span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">N</span><span class="p">),</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">NA</span><span class="p">)</span>        <span class="c1">#</span>
<span class="nf">uniqueN</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="m">3</span>                    <span class="c1">#  6.7s    0.38s</span>
</pre></div>
</div>
</li>
<li><p>Subsetting optimization with keys and indices is now possible for compound queries like <code class="docutils literal notranslate"><span class="pre">DT[a==1</span> <span class="pre">&amp;</span> <span class="pre">b==2]</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2472">#2472</a>.
Thanks to &#64;MichaelChirico for reporting and to &#64;MarkusBonsch for the implementation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">melt.data.table</span></code> now offers friendlier functionality for providing <code class="docutils literal notranslate"><span class="pre">value.name</span></code> for <code class="docutils literal notranslate"><span class="pre">list</span></code> input to <code class="docutils literal notranslate"><span class="pre">measure.vars</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1547">#1547</a>. Thanks &#64;MichaelChirico and &#64;franknarf1 for the suggestion and use cases, &#64;jangorecki and &#64;mrdwab for implementation feedback, and &#64;MichaelChirico for ultimate implementation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update.dev.pkg</span></code> is new function to update package from development repository, it will download package sources only when newer commit is available in repository. <code class="docutils literal notranslate"><span class="pre">data.table::update.dev.pkg()</span></code> defaults updates <code class="docutils literal notranslate"><span class="pre">data.table</span></code>, but any package can be used.</p></li>
<li><p>Item 1 in NEWS for <a class="reference external" href="https://github.com/Rdatatable/data.table/blob/master/NEWS.md#changes-in-v1102--on-cran-31-jan-2017">v1.10.2</a> on CRAN in Jan 2017 included :</p>
<blockquote>
<div><p>When j is a symbol prefixed with <code class="docutils literal notranslate"><span class="pre">..</span></code> it will be looked up in calling scope and its value taken to be column names or numbers.
When you see the <code class="docutils literal notranslate"><span class="pre">..</span></code> prefix think one-level-up, like the directory <code class="docutils literal notranslate"><span class="pre">..</span></code> in all operating systems means the parent directory.
In future the <code class="docutils literal notranslate"><span class="pre">..</span></code> prefix could be made to work on all symbols apearing anywhere inside <code class="docutils literal notranslate"><span class="pre">DT[...]</span></code>.</p>
</div></blockquote>
<p>The response has been positive (<a class="reference external" href="https://twitter.com/MattDowle/status/967290562725359617">this tweet</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2655">FR#2655</a>) and so this prefix is now expanded to all symbols appearing in <code class="docutils literal notranslate"><span class="pre">j=</span></code> as a first step; e.g.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="s">&quot;colB&quot;</span>
<span class="n">DT</span><span class="p">[,</span> <span class="nf">c</span><span class="p">(</span><span class="n">..cols</span><span class="p">,</span> <span class="s">&quot;colC&quot;</span><span class="p">)]</span>   <span class="c1"># same as DT[, .(colB,colC)]</span>
<span class="n">DT</span><span class="p">[,</span> <span class="m">-.</span><span class="n">.cols</span><span class="p">]</span>             <span class="c1"># all columns other than colB</span>
</pre></div>
</div>
<p>Thus, <code class="docutils literal notranslate"><span class="pre">with=</span></code> should no longer be needed in any cases. Please change to using the <code class="docutils literal notranslate"><span class="pre">..</span></code> prefix and over the next few years we will start to formally deprecate and remove the <code class="docutils literal notranslate"><span class="pre">with=</span></code> parameter.  If this is well received, the <code class="docutils literal notranslate"><span class="pre">..</span></code> prefix could be expanded to symbols appearing in <code class="docutils literal notranslate"><span class="pre">i=</span></code> and <code class="docutils literal notranslate"><span class="pre">by=</span></code>, too. Note that column names should not now start with <code class="docutils literal notranslate"><span class="pre">..</span></code>. If a symbol <code class="docutils literal notranslate"><span class="pre">..var</span></code> is used in <code class="docutils literal notranslate"><span class="pre">j=</span></code> but <code class="docutils literal notranslate"><span class="pre">..var</span></code> exists as a column name, the column still takes precedence, for backwards compatibility. Over the next few years, data.table will start issuing warnings/errors when it sees column names starting with <code class="docutils literal notranslate"><span class="pre">..</span></code>. This affects one CRAN package out of 475 using data.table, so we do not believe this restriction to be unreasonable. Our main focus here which we believe <code class="docutils literal notranslate"><span class="pre">..</span></code> achieves is to resolve the more common ambiguity when <code class="docutils literal notranslate"><span class="pre">var</span></code> is in calling scope and <code class="docutils literal notranslate"><span class="pre">var</span></code> is a column name too. Further, we have not forgotten that in the past we recommended prefixing the variable in calling scope with <code class="docutils literal notranslate"><span class="pre">..</span></code> yourself. If you did that and <code class="docutils literal notranslate"><span class="pre">..var</span></code> exists in calling scope, that still works, provided neither <code class="docutils literal notranslate"><span class="pre">var</span></code> exists in calling scope nor <code class="docutils literal notranslate"><span class="pre">..var</span></code> exists as a column name. Please now remove the <code class="docutils literal notranslate"><span class="pre">..</span></code> prefix on <code class="docutils literal notranslate"><span class="pre">..var</span></code> in calling scope to tidy this up. In future data.table will start to warn/error on such usage.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">setindexv</span></code> can now assign multiple (separate) indices by accepting a <code class="docutils literal notranslate"><span class="pre">list</span></code> in the <code class="docutils literal notranslate"><span class="pre">cols</span></code> argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.matrix.data.table</span></code> method now has an additional <code class="docutils literal notranslate"><span class="pre">rownames</span></code> argument allowing for a single column to be used as the <code class="docutils literal notranslate"><span class="pre">rownames</span></code> after conversion to a <code class="docutils literal notranslate"><span class="pre">matrix</span></code>. Thanks to &#64;sritchie73 for the suggestion, use cases, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2692">#2692</a> and implementation <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2702">PR#2702</a> and &#64;MichaelChirico for additional use cases.</p></li>
</ol>
</div>
<div class="section" id="id32">
<h2>BUG FIXES<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>The new quote rules handles this single field <code class="docutils literal notranslate"><span class="pre">&quot;Our</span> <span class="pre">Stock</span> <span class="pre">Screen</span> <span class="pre">Delivers</span> <span class="pre">an</span> <span class="pre">Israeli</span> <span class="pre">Software</span> <span class="pre">Company</span> <span class="pre">(MNDO,</span> <span class="pre">CTCH)&lt;\/a&gt;</span> <span class="pre">SmallCapInvestor.com</span> <span class="pre">-</span> <span class="pre">Thu,</span> <span class="pre">May</span> <span class="pre">19,</span> <span class="pre">2011</span> <span class="pre">10:02</span> <span class="pre">AM</span> <span class="pre">EDT&lt;\/cite&gt;&lt;\/div&gt;Yesterday</span> <span class="pre">in</span> <span class="pre">\&quot;&quot;Google,</span> <span class="pre">But</span> <span class="pre">for</span> <span class="pre">Finding</span> <span class="pre">Great</span> <span class="pre">Stocks\&quot;&quot;,</span> <span class="pre">I</span> <span class="pre">discussed</span> <span class="pre">the</span> <span class="pre">value</span> <span class="pre">of</span> <span class="pre">stock</span> <span class="pre">screeners</span> <span class="pre">as</span> <span class="pre">a</span> <span class="pre">powerful</span> <span class="pre">tool&quot;</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2051">#2051</a>. Thanks to &#64;scarrascoso for reporting. Example file added to test suite.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> creates a file with permissions that now play correctly with <code class="docutils literal notranslate"><span class="pre">Sys.umask()</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2049">#2049</a>. Thanks to &#64;gnguy for reporting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> no longer holds an open lock on the file when a line outside the large sample has too many fields and generates an error, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2044">#2044</a>. Thanks to Hugh Parsonage for reporting.</p></li>
<li><p>Setting <code class="docutils literal notranslate"><span class="pre">j</span> <span class="pre">=</span> <span class="pre">{}</span></code> no longer results in an error, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2142">#2142</a>. Thanks Michael Chirico for the pull request.</p></li>
<li><p>Segfault in <code class="docutils literal notranslate"><span class="pre">rbindlist()</span></code> when one or more items are empty, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2019">#2019</a>. Thanks Michael Lang for the pull request. Another segfault if the result would be more than 2bn rows, thanks to &#64;jsams’s comment in <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2340#issuecomment-331505494">#2340</a>.</p></li>
<li><p>Error printing 0-length <code class="docutils literal notranslate"><span class="pre">ITime</span></code> and <code class="docutils literal notranslate"><span class="pre">NA</span></code> objects, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2032">#2032</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2171">#2171</a>. Thanks Michael Chirico for the pull requests and &#64;franknarf1 for pointing out a shortcoming of the initial fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.IDate.POSIXct</span></code> error with <code class="docutils literal notranslate"><span class="pre">NULL</span></code> timezone, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1973">#1973</a>. Thanks &#64;lbilli for reporting and Michael Chirico for the pull request.</p></li>
<li><p>Printing a null <code class="docutils literal notranslate"><span class="pre">data.table</span></code> with <code class="docutils literal notranslate"><span class="pre">print</span></code> no longer visibly outputs <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1852">#1852</a>. Thanks &#64;aaronmcdaid for spotting and &#64;MichaelChirico for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.table</span></code> now works with Shiny Reactivity / Flexdashboard. The error was typically something like <code class="docutils literal notranslate"><span class="pre">col</span> <span class="pre">not</span> <span class="pre">found</span></code> in <code class="docutils literal notranslate"><span class="pre">DT[col==val]</span></code>. Thanks to Dirk Eddelbuettel leading Matt through reproducible steps and &#64;sergeganakou and Richard White for reporting. Closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2001">#2001</a> and <a class="reference external" href="https://github.com/rstudio/shiny/issues/1696">shiny/#1696</a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">as.IDate.POSIXct</span></code> method passed <code class="docutils literal notranslate"><span class="pre">tzone</span></code> along but was not exported. So <code class="docutils literal notranslate"><span class="pre">tzone</span></code> is now taken into account by <code class="docutils literal notranslate"><span class="pre">as.IDate</span></code> too as well as <code class="docutils literal notranslate"><span class="pre">IDateTime</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/977">#977</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1498">#1498</a>. Tests added.</p></li>
<li><p>Named logical vector now select rows as expected from single row data.table. Thanks to &#64;skranz for reporting. Closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2152">#2152</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code>’s rare <code class="docutils literal notranslate"><span class="pre">Internal</span> <span class="pre">error:</span> <span class="pre">Sampling</span> <span class="pre">jump</span> <span class="pre">point</span> <span class="pre">10</span> <span class="pre">is</span> <span class="pre">before</span> <span class="pre">the</span> <span class="pre">last</span> <span class="pre">jump</span> <span class="pre">ended</span></code> has been fixed, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2157">#2157</a>. Thanks to Frank Erickson and Artem Klevtsov for reporting with example files which are now added to the test suite.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CJ()</span></code> no longer loses attribute information, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2029">#2029</a>. Thanks to &#64;MarkusBonsch and &#64;royalts for the pull request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split.data.table</span></code> respects <code class="docutils literal notranslate"><span class="pre">factor</span></code> ordering in <code class="docutils literal notranslate"><span class="pre">by</span></code> argument, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2082">#2082</a>. Thanks to &#64;MichaelChirico for identifying and fixing the issue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.SD</span></code> would incorrectly include symbol on lhs of <code class="docutils literal notranslate"><span class="pre">:=</span></code> when <code class="docutils literal notranslate"><span class="pre">.SDcols</span></code> is specified and <code class="docutils literal notranslate"><span class="pre">get()</span></code> appears in <code class="docutils literal notranslate"><span class="pre">j</span></code>. Thanks &#64;renkun-ken for reporting and the PR, and &#64;ProfFancyPants for reporing a regression introduced in the PR. Closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2326">#2326</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2338">#2338</a>.</p></li>
<li><p>Integer values that are too large to fit in <code class="docutils literal notranslate"><span class="pre">int64</span></code> will now be read as strings <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2250">#2250</a>.</p></li>
<li><p>Internal-only <code class="docutils literal notranslate"><span class="pre">.shallow</span></code> now retains keys correctly, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2336">#2336</a>. Thanks to &#64;MarkusBonsch for reporting, fixing (<a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2337">PR #2337</a>) and adding 37 tests. This much advances the journey towards exporting <code class="docutils literal notranslate"><span class="pre">shallow()</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2323">#2323</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isoweek</span></code> calculation is correct regardless of local timezone setting (<code class="docutils literal notranslate"><span class="pre">Sys.timezone()</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2407">#2407</a>. Thanks to &#64;MoebiusAV and &#64;SimonCoulombe for reporting and &#64;MichaelChirico for fixing.</p></li>
<li><p>Fixed <code class="docutils literal notranslate"><span class="pre">as.xts.data.table</span></code> to support all xts supported time based index clasess <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2408">#2408</a>. Thanks to &#64;ebs238 for reporting and for the PR.</p></li>
<li><p>A memory leak when a very small number such as <code class="docutils literal notranslate"><span class="pre">0.58E-2141</span></code> is bumped to type <code class="docutils literal notranslate"><span class="pre">character</span></code> is resolved, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/918">#918</a>.</p></li>
<li><p>The edge case <code class="docutils literal notranslate"><span class="pre">setnames(data.table(),</span> <span class="pre">character(0))</span></code> now works rather than error, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2452">#2452</a>.</p></li>
<li><p>Order of rows returned in non-equi joins were incorrect in certain scenarios as reported under <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1991">#1991</a>. This is now fixed. Thanks to &#64;Henrik-P for reporting.</p></li>
<li><p>Non-equi joins work as expected when <code class="docutils literal notranslate"><span class="pre">x</span></code> in <code class="docutils literal notranslate"><span class="pre">x[i,</span> <span class="pre">on=...]</span></code> is a 0-row data.table. Closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1986">#1986</a>.</p></li>
<li><p>Non-equi joins along with <code class="docutils literal notranslate"><span class="pre">by=.EACHI</span></code> returned incorrect result in some rare cases as reported under <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2360">#2360</a>. This is fixed now. This fix also takes care of <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2275">#2275</a>. Thanks to &#64;ebs238 for the nice minimal reproducible report, &#64;Mihael for asking on SO and to &#64;Frank for following up on SO and filing an issue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">by=.EACHI</span></code> works now when <code class="docutils literal notranslate"><span class="pre">list</span></code> columns are being returned and some join values are missing, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2300">#2300</a>. Thanks to &#64;jangorecki and &#64;franknarf1 for the reproducible examples which have been added to the test suite.</p></li>
<li><p>Indices are now retrieved by exact name, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2465">#2465</a>. This prevents usage of wrong indices as well as unexpected row reordering in join results. Thanks to &#64;pannnda for reporting and providing a reproducible example and to &#64;MarkusBonsch for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setnames</span></code> of whole table when original table had <code class="docutils literal notranslate"><span class="pre">NA</span></code> names skipped replacing those, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2475">#2475</a>. Thanks to &#64;franknarf1 and <a class="reference external" href="https://stackoverflow.com/questions/47228836/">BenoitLondon on StackOverflow</a> for the report and &#64;MichaelChirico for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CJ()</span></code> works with multiple empty vectors now <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2511">#2511</a>. Thanks to &#64;MarkusBonsch for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:=</span></code> assignment of one vector to two or more columns, e.g. <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">c(&quot;x&quot;,</span> <span class="pre">&quot;y&quot;)</span> <span class="pre">:=</span> <span class="pre">1:10]</span></code>, failed to copy the <code class="docutils literal notranslate"><span class="pre">1:10</span></code> data causing errors later if and when those columns were updated by reference, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2540">#2540</a>. This is an old issue (<a class="reference external" href="https://github.com/Rdatatable/data.table/issues/185">#185</a>) that had been fixed but reappeared when code was refactored. Thanks to &#64;patrickhowerter for the detailed report with reproducible example and to &#64;MarkusBonsch for fixing and strengthening tests so it doesn’t reappear again.</p></li>
<li><p>“Negative length vectors not allowed” error when grouping <code class="docutils literal notranslate"><span class="pre">median</span></code> and <code class="docutils literal notranslate"><span class="pre">var</span></code> fixed, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2046">#2046</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2111">#2111</a>. Thanks to &#64;caneff and &#64;osofr for reporting and to &#64;kmillar for debugging and explaining the cause.</p></li>
<li><p>Fixed a bug on Windows where <code class="docutils literal notranslate"><span class="pre">data.table</span></code>s containing non-UTF8 strings in <code class="docutils literal notranslate"><span class="pre">key</span></code>s were not properly sorted, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2462">#2462</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1826">#1826</a>  and <a class="reference external" href="https://stackoverflow.com/questions/47599934/why-doesnt-r-data-table-support-well-for-non-ascii-keys-on-windows">StackOverflow</a>. Thanks to &#64;shrektan for reporting and fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x.</span></code> prefixes during joins sometimes resulted in a “column not found” error. This is now fixed. Closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2313">#2313</a>. Thanks to &#64;franknarf1 for the MRE.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setattr()</span></code> no longer segfaults when setting ‘class’ to empty character vector, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2386">#2386</a>. Thanks to &#64;hatal175 for reporting and to &#64;MarkusBonsch for fixing.</p></li>
<li><p>Fixed cases where the result of <code class="docutils literal notranslate"><span class="pre">merge.data.table()</span></code> would contain duplicate column names if <code class="docutils literal notranslate"><span class="pre">by.x</span></code> was also in <code class="docutils literal notranslate"><span class="pre">names(y)</span></code>.
<code class="docutils literal notranslate"><span class="pre">merge.data.table()</span></code> gains the <code class="docutils literal notranslate"><span class="pre">no.dups</span></code> argument (default TRUE) to match the correpsonding patched behaviour in <code class="docutils literal notranslate"><span class="pre">base:::merge.data.frame()</span></code>. Now, when <code class="docutils literal notranslate"><span class="pre">by.x</span></code> is also in <code class="docutils literal notranslate"><span class="pre">names(y)</span></code> the column name from <code class="docutils literal notranslate"><span class="pre">y</span></code> has the corresponding <code class="docutils literal notranslate"><span class="pre">suffixes</span></code> added to it. <code class="docutils literal notranslate"><span class="pre">by.x</span></code> remains unchanged for backwards compatibility reasons.
In addition, where duplicate column names arise anyway (i.e. <code class="docutils literal notranslate"><span class="pre">suffixes</span> <span class="pre">=</span> <span class="pre">c(&quot;&quot;,</span> <span class="pre">&quot;&quot;)</span></code>) <code class="docutils literal notranslate"><span class="pre">merge.data.table()</span></code> will now throw a warning to match the behaviour of <code class="docutils literal notranslate"><span class="pre">base:::merge.data.frame()</span></code>.
Thanks to &#64;sritchie73 for reporting and fixing <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2631">PR#2631</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2653">PR#2653</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CJ()</span></code> now fails with proper error message when results would exceed max integer, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2636">#2636</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NA</span></code> in character columns now display as <code class="docutils literal notranslate"><span class="pre">&lt;NA&gt;</span></code> just like base R to distinguish from <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;NA&quot;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getDTthreads()</span></code> could return INT_MAX (2 billion) after an explicit call to <code class="docutils literal notranslate"><span class="pre">setDTthreads(0)</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2708">PR#2708</a>.</p></li>
<li><p>Fixed a bug on Windows that <code class="docutils literal notranslate"><span class="pre">data.table</span></code> may break if the garbage collecting was triggered when sorting a large number of non-ASCII characters. Thanks to &#64;shrektan for reporting and fixing <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2678">PR#2678</a>,  <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2674">#2674</a>.</p></li>
<li><p>Internal aliasing of <code class="docutils literal notranslate"><span class="pre">.</span></code> to <code class="docutils literal notranslate"><span class="pre">list</span></code> was over-aggressive in applying <code class="docutils literal notranslate"><span class="pre">list</span></code> even when <code class="docutils literal notranslate"><span class="pre">.</span></code> was intended within <code class="docutils literal notranslate"><span class="pre">bquote</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1912">#1912</a>. Thanks &#64;MichaelChirico for reporting/filing and &#64;ecoRoland for suggesting and testing a fix.</p></li>
<li><p>Attempt to allocate a wildly large amount of RAM (16EB) when grouping by key and there are close to 2 billion 1-row groups, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2777">#2777</a>. Thanks to &#64;jsams for the detailed report.</p></li>
<li><p>Fix a bug that <code class="docutils literal notranslate"><span class="pre">print(dt,</span> <span class="pre">class=TRUE)</span></code> shows only <code class="docutils literal notranslate"><span class="pre">topn</span> <span class="pre">-</span> <span class="pre">1</span></code> rows. Thanks to &#64;heavywatal for reporting <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2803">#2803</a> and filing <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2804">PR#2804</a>.</p></li>
</ol>
</div>
<div class="section" id="id33">
<h2>NOTES<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>The license has been changed from GPL to MPL (Mozilla Public License). All contributors were consulted and approved. <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2456">PR#2456</a> details the reasons for the change.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">?data.table</span></code> makes explicit the option of using a <code class="docutils literal notranslate"><span class="pre">logical</span></code> vector in <code class="docutils literal notranslate"><span class="pre">j</span></code> to select columns, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1978">#1978</a>. Thanks &#64;Henrik-P for the note and &#64;MichaelChirico for filing.</p></li>
<li><p>Test 1675.1 updated to cope with a change in R-devel in June 2017 related to <code class="docutils literal notranslate"><span class="pre">factor()</span></code> and <code class="docutils literal notranslate"><span class="pre">NA</span></code> levels.</p></li>
<li><p>Package <code class="docutils literal notranslate"><span class="pre">ezknitr</span></code> has been added to the whitelist of packages that run user code and should be consider data.table-aware, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2266">#2266</a>. Thanks to Matt Mills for testing and reporting.</p></li>
<li><p>Printing with <code class="docutils literal notranslate"><span class="pre">quote</span> <span class="pre">=</span> <span class="pre">TRUE</span></code> now quotes column names as well, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1319">#1319</a>. Thanks &#64;jan-glx for the suggestion and &#64;MichaelChirico for the PR.</p></li>
<li><p>Added a blurb to <code class="docutils literal notranslate"><span class="pre">?melt.data.table</span></code> explicating the subtle difference in behavior of the <code class="docutils literal notranslate"><span class="pre">id.vars</span></code> argument vis-a-vis its analog in <code class="docutils literal notranslate"><span class="pre">reshape2::melt</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1699">#1699</a>. Thanks &#64;MichaelChirico for uncovering and filing.</p></li>
<li><p>Added some clarification about the usage of <code class="docutils literal notranslate"><span class="pre">on</span></code> to <code class="docutils literal notranslate"><span class="pre">?data.table</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2383">#2383</a>. Thanks to &#64;peterlittlejohn for volunteering his confusion and &#64;MichaelChirico for brushing things up.</p></li>
<li><p>Clarified that “data.table always sorts in <code class="docutils literal notranslate"><span class="pre">C-locale</span></code>” means that upper-case letters are sorted before lower-case letters by ordering in data.table (e.g. <code class="docutils literal notranslate"><span class="pre">setorder</span></code>, <code class="docutils literal notranslate"><span class="pre">setkey</span></code>, <code class="docutils literal notranslate"><span class="pre">DT[order(...)]</span></code>). Thanks to &#64;hughparsonage for the pull request editing the documentation. Note this makes no difference in most cases of data; e.g. ids where only uppercase or lowercase letters are used (<code class="docutils literal notranslate"><span class="pre">&quot;AB123&quot;&lt;&quot;AC234&quot;</span></code> is always true, regardless), or country names and words which are consistently capitalized. For example, <code class="docutils literal notranslate"><span class="pre">&quot;America&quot;</span> <span class="pre">&lt;</span> <span class="pre">&quot;Brazil&quot;</span></code> is not affected (it’s always true), and neither is <code class="docutils literal notranslate"><span class="pre">&quot;america&quot;</span> <span class="pre">&lt;</span> <span class="pre">&quot;brazil&quot;</span></code> (always true too); since the first letter is consistently capitalized. But, whether <code class="docutils literal notranslate"><span class="pre">&quot;america&quot;</span> <span class="pre">&lt;</span> <span class="pre">&quot;Brazil&quot;</span></code> (the words are not consistently capitalized) is true or false in base R depends on the locale of your R session. In America it is true by default and false if you i) type <code class="docutils literal notranslate"><span class="pre">Sys.setlocale(locale=&quot;C&quot;)</span></code>, ii) the R session has been started in a C locale for you which can happen on servers/services (the locale comes from the environment the R session is started in). However, <code class="docutils literal notranslate"><span class="pre">&quot;america&quot;</span> <span class="pre">&lt;</span> <span class="pre">&quot;Brazil&quot;</span></code> is always, consistently false in data.table which can be a surprise because it differs to base R by default in most regions. It is false because <code class="docutils literal notranslate"><span class="pre">&quot;B&quot;&lt;&quot;a&quot;</span></code> is true because all upper-case letters come first, followed by all lower case letters (the ascii number of each letter determines the order, which is what is meant by <code class="docutils literal notranslate"><span class="pre">C-locale</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s dependency has been moved forward from R 3.0.0 (Apr 2013) to R 3.1.0 (Apr 2014; i.e. 3.5 years old). We keep this dependency as old as possible for as long as possible as requested by users in managed environments. Thanks to Jan Gorecki, the test suite from latest dev now runs on R 3.1.0 continously, as well as R-release (currently 3.4.2) and latest R-devel snapshot. The primary motivation for the bump to R 3.1.0 was allowing one new test which relies on better non-copying behaviour in that version, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2484">#2484</a>. It also allows further internal simplifications. Thanks to &#64;MichaelChirico for fixing another test that failed on R 3.1.0 due to slightly different behaviour of <code class="docutils literal notranslate"><span class="pre">base::read.csv</span></code> in R 3.1.0-only which the test was comparing to, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2489">#2489</a>.</p></li>
<li><p>New vignette added: <em>Importing data.table</em> - focused on using data.table as a dependency in R packages. Answers most commonly asked questions and promote good practices.</p></li>
<li><p>As warned in v1.9.8 release notes below in this file (25 Nov 2016) it has been 1 year since then and so use of <code class="docutils literal notranslate"><span class="pre">options(datatable.old.unique.by.key=TRUE)</span></code> to restore the old default is now deprecated with warning. The new warning states that this option still works and repeats the request to pass <code class="docutils literal notranslate"><span class="pre">by=key(DT)</span></code> explicitly to <code class="docutils literal notranslate"><span class="pre">unique()</span></code>, <code class="docutils literal notranslate"><span class="pre">duplicated()</span></code>, <code class="docutils literal notranslate"><span class="pre">uniqueN()</span></code> and <code class="docutils literal notranslate"><span class="pre">anyDuplicated()</span></code> and to stop using this option. In another year, this warning will become error. Another year after that the option will be removed.</p></li>
<li><p>As <code class="docutils literal notranslate"><span class="pre">set2key()</span></code> and <code class="docutils literal notranslate"><span class="pre">key2()</span></code> have been warning since v1.9.8 (Nov 2016), their warnings have now been upgraded to errors. Note that when they were introduced in version 1.9.4 (Oct 2014) they were marked as ‘experimental’ in NEWS item 4. They will be removed in one year.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Was</span> <span class="n">warning</span><span class="p">:</span> <span class="n">set2key</span><span class="p">()</span> <span class="n">will</span> <span class="n">be</span> <span class="n">deprecated</span> <span class="ow">in</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">relase</span><span class="o">.</span> <span class="n">Please</span> <span class="n">use</span> <span class="n">setindex</span><span class="p">()</span> <span class="n">instead</span><span class="o">.</span>
<span class="n">Now</span> <span class="n">error</span><span class="p">:</span> <span class="n">set2key</span><span class="p">()</span> <span class="ow">is</span> <span class="n">now</span> <span class="n">deprecated</span><span class="o">.</span> <span class="n">Please</span> <span class="n">use</span> <span class="n">setindex</span><span class="p">()</span> <span class="n">instead</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>The option <code class="docutils literal notranslate"><span class="pre">datatable.showProgress</span></code> is no longer set to a default value when the package is loaded. Instead, the <code class="docutils literal notranslate"><span class="pre">default=</span></code> argument of <code class="docutils literal notranslate"><span class="pre">getOption</span></code> is used by both <code class="docutils literal notranslate"><span class="pre">fwrite</span></code> and <code class="docutils literal notranslate"><span class="pre">fread</span></code>. The default is the result of <code class="docutils literal notranslate"><span class="pre">interactive()</span></code> at the time of the call. Using <code class="docutils literal notranslate"><span class="pre">getOption</span></code> in this way is intended to be more helpful to users looking at <code class="docutils literal notranslate"><span class="pre">args(fread)</span></code> and <code class="docutils literal notranslate"><span class="pre">?fread</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">print.data.table()</span></code> invisibly returns its first argument instead of <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. This behavior is compatible with the standard <code class="docutils literal notranslate"><span class="pre">print.data.frame()</span></code> and tibble’s <code class="docutils literal notranslate"><span class="pre">print.tbl_df()</span></code>. Thanks to &#64;heavywatal for <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2807">PR#2807</a></p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-10-4-3-20-oct-2017">
<h1>data.table v1.10.4-3  (20 Oct 2017)<a class="headerlink" href="#data-table-v1-10-4-3-20-oct-2017" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>Fixed crash/hang on MacOS when <code class="docutils literal notranslate"><span class="pre">parallel::mclapply</span></code> is used and data.table is merely loaded, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2418">#2418</a>. Oddly, all tests including test 1705 (which tests <code class="docutils literal notranslate"><span class="pre">mclapply</span></code> with data.table) passed fine on CRAN. It appears to be some versions of MacOS or some versions of libraries on MacOS, perhaps. Many thanks to Martin Morgan for reporting and confirming this fix works. Thanks also to &#64;asenabouth, Joe Thorley and Danton Noriega for testing, debugging and confirming that automatic parallelism inside data.table (such as <code class="docutils literal notranslate"><span class="pre">fwrite</span></code>) works well even on these MacOS installations. See also news items below for 1.10.4-1 and 1.10.4-2.</p></li>
</ol>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-10-4-2-12-oct-2017">
<h1>data.table v1.10.4-2  (12 Oct 2017)<a class="headerlink" href="#data-table-v1-10-4-2-12-oct-2017" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>OpenMP on MacOS is now supported by CRAN and included in CRAN’s package binaries for Mac. But installing v1.10.4-1 from source on MacOS failed when OpenMP was not enabled at compile time, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2409">#2409</a>. Thanks to Liz Macfie and &#64;fupangpangpang for reporting. The startup message when OpenMP is not enabled has been updated.</p></li>
<li><p>Two rare potential memory faults fixed, thanks to CRAN’s automated use of latest compiler tools; e.g. clang-5 and gcc-7</p></li>
</ol>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-10-4-1-09-oct-2017">
<h1>data.table v1.10.4-1  (09 Oct 2017)<a class="headerlink" href="#data-table-v1-10-4-1-09-oct-2017" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">nanotime</span></code> v0.2.0 update (June 2017) changed from <code class="docutils literal notranslate"><span class="pre">integer64</span></code> to <code class="docutils literal notranslate"><span class="pre">S4</span></code> and broke <code class="docutils literal notranslate"><span class="pre">fwrite</span></code> of <code class="docutils literal notranslate"><span class="pre">nanotime</span></code> columns. Fixed to work with <code class="docutils literal notranslate"><span class="pre">nanotime</span></code> both before and after v0.2.0.</p></li>
<li><p>Pass R-devel changes related to <code class="docutils literal notranslate"><span class="pre">deparse(,backtick=)</span></code> and <code class="docutils literal notranslate"><span class="pre">factor()</span></code>.</p></li>
<li><p>Internal <code class="docutils literal notranslate"><span class="pre">NAMED()==2</span></code> now <code class="docutils literal notranslate"><span class="pre">MAYBE_SHARED()</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2330">#2330</a>. Back-ported to pass under the stated dependency, R 3.0.0.</p></li>
<li><p>Attempted improvement on Mac-only when the <code class="docutils literal notranslate"><span class="pre">parallel</span></code> package is used too (which forks), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2137">#2137</a>. Intel’s OpenMP implementation appears to leave threads running after the OpenMP parallel region (inside data.table) has finished unlike GNU libgomp. So, if and when <code class="docutils literal notranslate"><span class="pre">parallel</span></code>’s <code class="docutils literal notranslate"><span class="pre">fork</span></code> is invoked by the user after data.table has run in parallel already, instability occurs. The problem only occurs with Mac package binaries from CRAN because they are built by CRAN with Intel’s OpenMP library. No known problems on Windows or Linux and no known problems on any platform when <code class="docutils literal notranslate"><span class="pre">parallel</span></code> is not used. If this Mac-only fix still doesn’t work, call <code class="docutils literal notranslate"><span class="pre">setDTthreads(1)</span></code> immediately after <code class="docutils literal notranslate"><span class="pre">library(data.table)</span></code> which has been reported to fix the problem by putting <code class="docutils literal notranslate"><span class="pre">data.table</span></code> into single threaded mode earlier.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">fread()</span></code> and <code class="docutils literal notranslate"><span class="pre">print()</span></code> see <code class="docutils literal notranslate"><span class="pre">integer64</span></code> columns are present but package <code class="docutils literal notranslate"><span class="pre">bit64</span></code> is not installed, the warning is now displayed as intended. Thanks to a question by Santosh on r-help and forwarded by Bill Dunlap.</p></li>
</ol>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-10-4-01-feb-2017">
<h1>data.table v1.10.4  (01 Feb 2017)<a class="headerlink" href="#data-table-v1-10-4-01-feb-2017" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id34">
<h2>BUG FIXES<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>The new specialized <code class="docutils literal notranslate"><span class="pre">nanotime</span></code> writer in <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> type punned using <code class="docutils literal notranslate"><span class="pre">*(long</span> <span class="pre">long</span> <span class="pre">*)&amp;REAL(column)[i]</span></code> which, strictly, is undefined behavour under C standards. It passed a plethora of tests on linux (gcc 5.4 and clang 3.8), win-builder and 6 out 10 CRAN flavours using gcc. But failed (wrong data written) with the newest version of clang (3.9.1) as used by CRAN on the failing flavors, and solaris-sparc. Replaced with the union method and added a grep to CRAN_Release.cmd.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-10-2-31-jan-2017">
<h1>data.table v1.10.2  (31 Jan 2017)<a class="headerlink" href="#data-table-v1-10-2-31-jan-2017" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id35">
<h2>NEW FEATURES<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>When <code class="docutils literal notranslate"><span class="pre">j</span></code> is a symbol prefixed with <code class="docutils literal notranslate"><span class="pre">..</span></code> it will be looked up in calling scope and its value taken to be column names or numbers.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">myCols</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;colA&quot;</span><span class="p">,</span><span class="s">&quot;colB&quot;</span><span class="p">)</span>
<span class="n">DT</span><span class="p">[,</span> <span class="n">myCols</span><span class="p">,</span> <span class="n">with</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span>
<span class="n">DT</span><span class="p">[,</span> <span class="n">..myCols</span><span class="p">]</span>              <span class="c1"># same</span>
</pre></div>
</div>
<p>When you see the <code class="docutils literal notranslate"><span class="pre">..</span></code> prefix think <em>one-level-up</em> like the directory <code class="docutils literal notranslate"><span class="pre">..</span></code> in all operating systems meaning the parent directory. In future the <code class="docutils literal notranslate"><span class="pre">..</span></code> prefix could be made to work on all symbols apearing anywhere inside <code class="docutils literal notranslate"><span class="pre">DT[...]</span></code>. It is intended to be a convenient way to protect your code from accidentally picking up a column name. Similar to how <code class="docutils literal notranslate"><span class="pre">x.</span></code> and <code class="docutils literal notranslate"><span class="pre">i.</span></code> prefixes (analogous to SQL table aliases) can already be used to disambiguate the same column name present in both <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">i</span></code>. A symbol prefix rather than a <code class="docutils literal notranslate"><span class="pre">..()</span></code> <em>function</em> will be easier for us to optimize internally and more convenient if you have many variables in calling scope that you wish to use in your expressions safely. This feature was first raised in 2012 and long wished for, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/633">#633</a>. It is experimental.</p>
</li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">fread()</span></code> or <code class="docutils literal notranslate"><span class="pre">print()</span></code> see <code class="docutils literal notranslate"><span class="pre">integer64</span></code> columns are present, <code class="docutils literal notranslate"><span class="pre">bit64</span></code>’s namespace is now automatically loaded for convenience.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> now supports the new <a class="reference external" href="https://cran.r-project.org/package=nanotime"><code class="docutils literal notranslate"><span class="pre">nanotime</span></code></a> type by Dirk Eddelbuettel, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1982">#1982</a>. Aside: <code class="docutils literal notranslate"><span class="pre">data.table</span></code> already automatically supported <code class="docutils literal notranslate"><span class="pre">nanotime</span></code> in grouping and joining operations via longstanding support of its underlying <code class="docutils literal notranslate"><span class="pre">integer64</span></code> type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">indices()</span></code> gains a new argument <code class="docutils literal notranslate"><span class="pre">vectors</span></code>, default <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>. This strsplits the index names by <code class="docutils literal notranslate"><span class="pre">__</span></code> for you, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1589">#1589</a>.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span> <span class="o">=</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="m">6</span><span class="o">:</span><span class="m">4</span><span class="p">)</span>
<span class="nf">setindex</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="nf">setindex</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
<span class="nf">indices</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;B&quot;</span>    <span class="s">&quot;B__A&quot;</span>
<span class="nf">indices</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">vectors</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;B&quot;</span>
<span class="p">[[</span><span class="m">2</span><span class="p">]]</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;B&quot;</span> <span class="s">&quot;A&quot;</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id36">
<h2>BUG FIXES<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Some long-standing potential instability has been discovered and resolved many thanks to a detailed report from Bill Dunlap and Michael Sannella. At C level any call of the form <code class="docutils literal notranslate"><span class="pre">setAttrib(x,</span> <span class="pre">install(),</span> <span class="pre">allocVector())</span></code> can be unstable in any R package. Despite <code class="docutils literal notranslate"><span class="pre">setAttrib()</span></code> PROTECTing its inputs, the 3rd argument (<code class="docutils literal notranslate"><span class="pre">allocVector</span></code>) can be executed first only for its result to to be released by <code class="docutils literal notranslate"><span class="pre">install()</span></code>’s potential GC before reaching <code class="docutils literal notranslate"><span class="pre">setAttrib</span></code>’s PROTECTion of its inputs. Fixed by either PROTECTing or pre-<code class="docutils literal notranslate"><span class="pre">install()</span></code>ing. Added to CRAN_Release.cmd procedures: i) <code class="docutils literal notranslate"><span class="pre">grep</span></code>s to prevent usage of this idiom in future and ii) running data.table’s test suite with <code class="docutils literal notranslate"><span class="pre">gctorture(TRUE)</span></code>.</p></li>
<li><p>A new potential instability introduced in the last release (v1.10.0) in GForce optimized grouping has been fixed by reverting one change from malloc to R_alloc. Thanks again to Michael Sannella for the detailed report.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> could write floating point values incorrectly, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1968">#1968</a>. A thread-local variable was incorrectly thread-global. This variable’s usage lifetime is only a few clock cycles so it needed large data and many threads for several threads to overlap their usage of it and cause the problem. Many thanks to &#64;mgahan and &#64;jmosser for finding and reporting.</p></li>
</ol>
</div>
<div class="section" id="id37">
<h2>NOTES<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code>’s <code class="docutils literal notranslate"><span class="pre">..turbo</span></code> option has been removed as the warning message warned. If you’ve found a problem, please <a class="reference external" href="https://github.com/Rdatatable/data.table/issues">report it</a>.</p></li>
<li><p>No known issues have arisen due to <code class="docutils literal notranslate"><span class="pre">DT[,1]</span></code> and <code class="docutils literal notranslate"><span class="pre">DT[,c(&quot;colA&quot;,&quot;colB&quot;)]</span></code> now returning columns as introduced in v1.9.8. However, as we’ve moved forward by setting <code class="docutils literal notranslate"><span class="pre">options('datatable.WhenJisSymbolThenCallingScope'=TRUE)</span></code> introduced then too, it has become clear a better solution is needed. All 340 CRAN and Bioconductor packages that use data.table have been checked with this option on. 331 lines would need to be changed in 59 packages. Their usage is elegant, correct and recommended, though. Examples are <code class="docutils literal notranslate"><span class="pre">DT[1,</span> <span class="pre">encoding]</span></code> in quanteda and <code class="docutils literal notranslate"><span class="pre">DT[winner==&quot;first&quot;,</span> <span class="pre">freq]</span></code> in xgboost. These are looking up the columns <code class="docutils literal notranslate"><span class="pre">encoding</span></code> and <code class="docutils literal notranslate"><span class="pre">freq</span></code> respectively and returning them as vectors. But if, for some reason, those columns are removed from <code class="docutils literal notranslate"><span class="pre">DT</span></code> and <code class="docutils literal notranslate"><span class="pre">encoding</span></code> or <code class="docutils literal notranslate"><span class="pre">freq</span></code> are still variables in calling scope, their values in calling scope would be returned. Which cannot be what was intended and could lead to silent bugs. That was the risk we were trying to avoid. <br>
<code class="docutils literal notranslate"><span class="pre">options('datatable.WhenJisSymbolThenCallingScope')</span></code> is now removed. A migration timeline is no longer needed. The new strategy needs no code changes and has no breakage. It was proposed and discussed in point 2 <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1188#issuecomment-127824969">here</a>, as follows.<br>
When <code class="docutils literal notranslate"><span class="pre">j</span></code> is a symbol (as in the quanteda and xgboost examples above) it will continue to be looked up as a column name and returned as a vector, as has always been the case.  If it’s not a column name however, it is now a helpful error explaining that data.table is different to data.frame and what to do instead (use <code class="docutils literal notranslate"><span class="pre">..</span></code> prefix or <code class="docutils literal notranslate"><span class="pre">with=FALSE</span></code>).  The old behaviour of returning the symbol’s value in calling scope can never have been useful to anybody and therefore not depended on. Just as the <code class="docutils literal notranslate"><span class="pre">DT[,1]</span></code> change could be made in v1.9.8, this change can be made now. This change increases robustness with no downside. Rerunning all 340 CRAN and Bioconductor package checks reveal 2 packages throwing the new error: partools and simcausal. Their maintainers have been informed that there is a likely bug on those lines due to data.table’s (now remedied) weakness. This is exactly what we wanted to reveal and improve.</p></li>
<li><p>As before, and as we can see is in common use in CRAN and Bioconductor packages using data.table, <code class="docutils literal notranslate"><span class="pre">DT[,myCols,with=FALSE]</span></code> continues to lookup <code class="docutils literal notranslate"><span class="pre">myCols</span></code> in calling scope and take its value as column names or numbers.  You can move to the new experimental convenience feature <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">..myCols]</span></code> if you wish at leisure.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-10-0-03-dec-2016">
<h1>data.table v1.10.0  (03 Dec 2016)<a class="headerlink" href="#data-table-v1-10-0-03-dec-2016" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id38">
<h2>BUG FIXES<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite(...,</span> <span class="pre">quote='auto')</span></code> already quoted a field if it contained a <code class="docutils literal notranslate"><span class="pre">sep</span></code> or <code class="docutils literal notranslate"><span class="pre">\n</span></code>, or <code class="docutils literal notranslate"><span class="pre">sep2[2]</span></code> when <code class="docutils literal notranslate"><span class="pre">list</span></code> columns are present. Now it also quotes a field if it contains a double quote (<code class="docutils literal notranslate"><span class="pre">&quot;</span></code>) as documented, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1925">#1925</a>. Thanks to Aki Matsuo for reporting. Tests added. The <code class="docutils literal notranslate"><span class="pre">qmethod</span></code> tests did test escaping embedded double quotes, but only when <code class="docutils literal notranslate"><span class="pre">sep</span></code> or <code class="docutils literal notranslate"><span class="pre">\n</span></code> was present in the field as well to trigger the quoting of the field.</p></li>
<li><p>Fixed 3 test failures on Solaris only, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1934">#1934</a>. Two were on both sparc and x86 and related to a <code class="docutils literal notranslate"><span class="pre">tzone</span></code> attribute difference between <code class="docutils literal notranslate"><span class="pre">as.POSIXct</span></code> and <code class="docutils literal notranslate"><span class="pre">as.POSIXlt</span></code> even when passed the default <code class="docutils literal notranslate"><span class="pre">tz=&quot;&quot;</span></code>. The third was on sparc only: a minor rounding issue in <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> of 1e-305.</p></li>
<li><p>Regression crash fixed when 0’s occur at the end of a non-empty subset of an empty table, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1937">#1937</a>. Thanks Arun for tracking down. Tests added. For example, subsetting the empty <code class="docutils literal notranslate"><span class="pre">DT=data.table(a=character())</span></code> with <code class="docutils literal notranslate"><span class="pre">DT[c(1,0)]</span></code> should return a 1 row result with one <code class="docutils literal notranslate"><span class="pre">NA</span></code> since 1 is past the end of <code class="docutils literal notranslate"><span class="pre">nrow(DT)==0</span></code>, the same result as <code class="docutils literal notranslate"><span class="pre">DT[1]</span></code>.</p></li>
<li><p>Fixed newly reported crash that also occurred in old v1.9.6 when <code class="docutils literal notranslate"><span class="pre">by=.EACHI</span></code>, <code class="docutils literal notranslate"><span class="pre">nomatch=0</span></code>, the first item in <code class="docutils literal notranslate"><span class="pre">i</span></code> has no match AND <code class="docutils literal notranslate"><span class="pre">j</span></code> has a function call that is passed a key column, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1933">#1933</a>. Many thanks to Reino Bruner for finding and reporting with a reproducible example. Tests added.</p></li>
<li><p>Fixed <code class="docutils literal notranslate"><span class="pre">fread()</span></code> error occurring for a subset of Windows users: <code class="docutils literal notranslate"><span class="pre">showProgress</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">type</span> <span class="pre">integer</span> <span class="pre">but</span> <span class="pre">type</span> <span class="pre">'logical'.</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1944">#1944</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1111">#1111</a>. Our tests cover this usage (it is just default usage), pass on AppVeyor (Windows), win-builder (Windows) and CRAN’s Windows so perhaps it only occurs on a specific and different version of Windows to all those. Thanks to &#64;demydd for reporting. Fixed by using strictly <code class="docutils literal notranslate"><span class="pre">logical</span></code> type at R level and <code class="docutils literal notranslate"><span class="pre">Rboolean</span></code> at C level, consistently throughout.</p></li>
<li><p>Combining <code class="docutils literal notranslate"><span class="pre">on=</span></code> (new in v1.9.6) with <code class="docutils literal notranslate"><span class="pre">by=</span></code> or <code class="docutils literal notranslate"><span class="pre">keyby=</span></code> gave incorrect results, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1943">#1943</a>. Many thanks to Henrik-P for the detailed and reproducible report. Tests added.</p></li>
<li><p>New function <code class="docutils literal notranslate"><span class="pre">rleidv</span></code> was ignoring its <code class="docutils literal notranslate"><span class="pre">cols</span></code> argument, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1942">#1942</a>. Thanks Josh O’Brien for reporting. Tests added.</p></li>
</ol>
</div>
<div class="section" id="id39">
<h2>NOTES<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>It seems OpenMP is not available on CRAN’s Mac platform; NOTEs appeared in <a class="reference external" href="https://cran.r-project.org/web/checks/check_results_data.table.html">CRAN checks</a> for v1.9.8. Moved <code class="docutils literal notranslate"><span class="pre">Rprintf</span></code> from <code class="docutils literal notranslate"><span class="pre">init.c</span></code> to <code class="docutils literal notranslate"><span class="pre">packageStartupMessage</span></code> to avoid the NOTE as requested urgently by Professor Ripley. Also fixed the bad grammar of the message: ‘single threaded’ now ‘single-threaded’. If you have a Mac and run macOS or OS X on it (I run Ubuntu on mine) please contact CRAN maintainers and/or Apple if you’d like CRAN’s Mac binary to support OpenMP. Otherwise, please follow <a class="reference external" href="https://github.com/Rdatatable/data.table/wiki/Installation">these instructions for OpenMP on Mac</a> which people have reported success with.</p></li>
<li><p>Just to state explicitly: data.table does not now depend on or require OpenMP. If you don’t have it (as on CRAN’s Mac it appears but not in general on Mac) then data.table should build, run and pass all tests just fine.</p></li>
<li><p>There are now 5,910 raw tests as reported by <code class="docutils literal notranslate"><span class="pre">test.data.table()</span></code>. Tests cover 91% of the 4k lines of R and 89% of the 7k lines of C. These stats are now known thanks to Jim Hester’s <a class="reference external" href="https://CRAN.R-project.org/package=covr">Covr</a> package and <a class="reference external" href="https://about.codecov.io/">Codecov.io</a>. If anyone is looking for something to help with, creating tests to hit the missed lines shown by clicking the <code class="docutils literal notranslate"><span class="pre">R</span></code> and <code class="docutils literal notranslate"><span class="pre">src</span></code> folders at the bottom <a class="reference external" href="https://codecov.io/github/Rdatatable/data.table?branch=master">here</a> would be very much appreciated.</p></li>
<li><p>The FAQ vignette has been revised given the changes in v1.9.8. In particular, the very first FAQ.</p></li>
<li><p>With hindsight, the last release v1.9.8 should have been named v1.10.0 to convey it wasn’t just a patch release from .6 to .8 owing to the ‘potentially breaking changes’ items. Thanks to &#64;neomantic for correctly pointing out. The best we can do now is now bump to 1.10.0.</p></li>
</ol>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-table-v1-9-8-nov-2016-back-to-v1-2-aug-2008-has-been-moved-to-news-0-md">
<h1>data.table v1.9.8 (Nov 2016) back to v1.2 (Aug 2008) has been moved to <a class="reference external" href="https://github.com/Rdatatable/data.table/blob/master/NEWS.0.md">NEWS.0.md</a><a class="headerlink" href="#data-table-v1-9-8-nov-2016-back-to-v1-2-aug-2008-has-been-moved-to-news-0-md" title="Permalink to this headline">¶</a></h1>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./temporal/renv/library/R-4.1/aarch64-apple-darwin20/data.table"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Quan Nguyen<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../../../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>